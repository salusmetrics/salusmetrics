(()=>{"use strict";var e={};let t;e.m={},e.u=e=>e+".bundle.js",e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(t=r.currentScript.src),!t)){var s=r.getElementsByTagName("script");if(s.length)for(var i=s.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=s[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.b=document.baseURI||self.location.href;const r=new Uint8Array(16);function s(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(r)}const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));const n={};function o(e,t,r,s,i=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(s){if(i<0||i+16>s.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`)}else s=new Uint8Array(16),i=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],s[i++]=t/1099511627776&255,s[i++]=t/4294967296&255,s[i++]=t/16777216&255,s[i++]=t/65536&255,s[i++]=t/256&255,s[i++]=255&t,s[i++]=112|r>>>28&15,s[i++]=r>>>20&255,s[i++]=128|r>>>14&63,s[i++]=r>>>6&255,s[i++]=r<<2&255|3&e[10],s[i++]=e[11],s[i++]=e[12],s[i++]=e[13],s[i++]=e[14],s[i++]=e[15],s}const u=function(e,t,r){let u;if(e)u=o(e.random??e.rng?.()??s(),e.msecs,e.seq,t,r);else{const e=Date.now(),i=s();!function(e,t,r){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(n,e,i),u=o(i,n.msecs,n.seq,t,r)}return t?u:function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(u)};var l,a,h,c;!function(e){e[e.Visitor=1]="Visitor",e[e.Session=2]="Session",e[e.Section=3]="Section",e[e.Click=4]="Click"}(l||(l={})),function(e){e[e.BadRequest=0]="BadRequest",e[e.ConfigurationError=1]="ConfigurationError",e[e.InternalServerError=2]="InternalServerError",e[e.Timeout=3]="Timeout"}(a||(a={})),function(e){e[e.Invalid=0]="Invalid",e[e.InvalidApiKey=1]="InvalidApiKey",e[e.InvalidHost=2]="InvalidHost",e[e.Success=3]="Success"}(h||(h={})),function(e){e[e.ConfigureRequest=0]="ConfigureRequest",e[e.ConfigureResult=1]="ConfigureResult",e[e.PublishError=2]="PublishError",e[e.PublishRequest=3]="PublishRequest",e[e.PublishResult=4]="PublishResult"}(c||(c={}));let g=new class{constructor(){this.event_type=l.Visitor,this.id=u()}toPublishEvent(){return{t:this.event_type,i:this.id,a:void 0}}};new class{constructor(t,r){if(this.errorHandler=r,this.configurationState=void 0,function(e){if(e.api_key.trim().length<1)return h.InvalidApiKey;const t=URL.parse(e.host);return null==t||t.pathname.length>1||t.search.length>0||t.hash.length>0?h.InvalidHost:h.Success}(t)!=h.Success)throw null!=this.errorHandler&&this.errorHandler("Error constructing WorkerPublisherGateway - Invalid Configuration"),new Error("Invalid Event Publisher Configuration");this.promiseRegistry={},this.workerPublisher=new Worker(new URL(e.p+e.u(552),e.b)),this.workerPublisher.addEventListener("message",(e=>this.routeMessage(e))),this.workerPublisher.addEventListener("error",(e=>{null!=this.errorHandler&&this.errorHandler(e.message)})),this.postConfigRequest(t)}publish(e){const t=this.createPublishMessage(e);return new Promise(((e,r)=>{this.registerPublishPromise(t,{resolve:e,reject:r}),this.postPublishRequest(t)}))}routeMessage(e){const t=e.data;t.messageType==c.ConfigureResult?(this.configurationState=t.configurationState,this.configurationState!=h.Success&&null!=this.errorHandler&&this.errorHandler("Worker event publisher failed")):this.resolvePublish(t)}resolvePublish(e){const t=this.promiseRegistry[e.id];if(null==t){if(null!=this.errorHandler)return void this.errorHandler("Event Publish Result had no matching handlers in registry")}else e.messageType==c.PublishResult?t.resolve(e.result):t.reject(e.errorMessage),delete this.promiseRegistry[e.id]}createPublishMessage(e){return{id:u(),messageType:c.PublishRequest,events:e}}registerPublishPromise(e,t){this.promiseRegistry[e.id]=t}postPublishRequest(e){this.workerPublisher.postMessage(e)}postConfigRequest(e){const t={config:e,id:u(),messageType:c.ConfigureRequest};this.workerPublisher.postMessage(t)}}({api_key:"abc-xyz",host:"http://localhost:3000"},(e=>console.log(e))).publish([g.toPublishEvent()])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3BELEdBQWdCSSxNQUFacUMsR0FDRixHQUF5QnJDLE1BQXJCdEUsS0FBS3dFLGFBSVAsWUFIQXhFLEtBQUt3RSxhQUNILGtFQUtBa0MsRUFBY0gsYUFBZTFDLEVBQWtCK0MsY0FDakRELEVBQVNWLFFBQVFTLEVBQWNHLFFBRS9CRixFQUFTVCxPQUFPUSxFQUFjSSxxQkFFekI5RyxLQUFLc0YsZ0JBQWdCb0IsRUFBY3hDLEdBRTlDLENBRVEsb0JBQUE2QixDQUNORCxHQUdBLE1BQU8sQ0FDTDVCLEdBRlMsSUFHVHFDLFlBQWExQyxFQUFrQmtELGVBQy9CakIsT0FBUUEsRUFFWixDQUVRLHNCQUFBSyxDQUNOUixFQUNBZ0IsR0FFQTNHLEtBQUtzRixnQkFBZ0JLLEVBQVF6QixJQUFNeUMsQ0FDckMsQ0FFUSxrQkFBQVAsQ0FDTlksR0FFQWhILEtBQUt1RixnQkFBZ0IwQixZQUFZRCxFQUNuQyxDQUVRLGlCQUFBcEIsQ0FBa0JyQixHQUN4QixNQUFNMkMsRUFBbUQsQ0FDdkQzQyxTQUNBTCxHQUFJLElBQ0pxQyxZQUFhMUMsRUFBa0JzRCxrQkFFakNuSCxLQUFLdUYsZ0JBQWdCMEIsWUFBWUMsRUFDbkMsR0QvSHVDLENBQUV4QyxRQWQ3QixVQWNzQ0csS0FiekMsMEJBYWtEM0UsR0FDM0RrSCxRQUFRQyxJQUFJbkgsS0FHTjJGLFFBQVEsQ0FBQy9CLEVBQVFLLGtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9ybmcuanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50L3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvd2VicGFjay9ydW50aW1lL2pzb25wIGNodW5rIGxvYWRpbmciLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvc3RyaW5naWZ5LmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y3LmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvRXZlbnQvRXZlbnQudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlci50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL1dvcmtlck1lc3NhZ2UudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL1dvcmtlclB1Ymxpc2hlckdhdGV3YXkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbi8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBfX3dlYnBhY2tfbW9kdWxlc19fO1xuXG4iLCJsZXQgZ2V0UmFuZG9tVmFsdWVzO1xuY29uc3Qgcm5kczggPSBuZXcgVWludDhBcnJheSgxNik7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBybmcoKSB7XG4gICAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjcnlwdG8gPT09ICd1bmRlZmluZWQnIHx8ICFjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0UmFuZG9tVmFsdWVzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcy5iaW5kKGNyeXB0byk7XG4gICAgfVxuICAgIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufVxuIiwiLy8gVGhpcyBmdW5jdGlvbiBhbGxvdyB0byByZWZlcmVuY2UgYXN5bmMgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnUgPSAoY2h1bmtJZCkgPT4ge1xuXHQvLyByZXR1cm4gdXJsIGZvciBmaWxlbmFtZXMgYmFzZWQgb24gdGVtcGxhdGVcblx0cmV0dXJuIFwiXCIgKyBjaHVua0lkICsgXCIuYnVuZGxlLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PT0gJ1NDUklQVCcpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICghc2NyaXB0VXJsIHx8ICEvXmh0dHAocz8pOi8udGVzdChzY3JpcHRVcmwpKSkgc2NyaXB0VXJsID0gc2NyaXB0c1tpLS1dLnNyYztcblx0XHR9XG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsOyIsIl9fd2VicGFja19yZXF1aXJlX18uYiA9IGRvY3VtZW50LmJhc2VVUkkgfHwgc2VsZi5sb2NhdGlvbi5ocmVmO1xuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDc5MjogMFxufTtcblxuLy8gbm8gY2h1bmsgb24gZGVtYW5kIGxvYWRpbmdcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuLy8gbm8gb24gY2h1bmtzIGxvYWRlZFxuXG4vLyBubyBqc29ucCBmdW5jdGlvbiIsImltcG9ydCB2YWxpZGF0ZSBmcm9tICcuL3ZhbGlkYXRlLmpzJztcbmNvbnN0IGJ5dGVUb0hleCA9IFtdO1xuZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkge1xuICAgIGJ5dGVUb0hleC5wdXNoKChpICsgMHgxMDApLnRvU3RyaW5nKDE2KS5zbGljZSgxKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5zYWZlU3RyaW5naWZ5KGFyciwgb2Zmc2V0ID0gMCkge1xuICAgIHJldHVybiAoYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAwXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDFdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMl1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAzXV0gK1xuICAgICAgICAnLScgK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDRdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNV1dICtcbiAgICAgICAgJy0nICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA2XV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDddXSArXG4gICAgICAgICctJyArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOF1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA5XV0gK1xuICAgICAgICAnLScgK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDEwXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDExXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDEyXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDEzXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDE0XV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDE1XV0pLnRvTG93ZXJDYXNlKCk7XG59XG5mdW5jdGlvbiBzdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7XG4gICAgY29uc3QgdXVpZCA9IHVuc2FmZVN0cmluZ2lmeShhcnIsIG9mZnNldCk7XG4gICAgaWYgKCF2YWxpZGF0ZSh1dWlkKSkge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1N0cmluZ2lmaWVkIFVVSUQgaXMgaW52YWxpZCcpO1xuICAgIH1cbiAgICByZXR1cm4gdXVpZDtcbn1cbmV4cG9ydCBkZWZhdWx0IHN0cmluZ2lmeTtcbiIsImltcG9ydCBybmcgZnJvbSAnLi9ybmcuanMnO1xuaW1wb3J0IHsgdW5zYWZlU3RyaW5naWZ5IH0gZnJvbSAnLi9zdHJpbmdpZnkuanMnO1xuY29uc3QgX3N0YXRlID0ge307XG5mdW5jdGlvbiB2NyhvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICAgIGxldCBieXRlcztcbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgICBieXRlcyA9IHY3Qnl0ZXMob3B0aW9ucy5yYW5kb20gPz8gb3B0aW9ucy5ybmc/LigpID8/IHJuZygpLCBvcHRpb25zLm1zZWNzLCBvcHRpb25zLnNlcSwgYnVmLCBvZmZzZXQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3Qgcm5kcyA9IHJuZygpO1xuICAgICAgICB1cGRhdGVWN1N0YXRlKF9zdGF0ZSwgbm93LCBybmRzKTtcbiAgICAgICAgYnl0ZXMgPSB2N0J5dGVzKHJuZHMsIF9zdGF0ZS5tc2VjcywgX3N0YXRlLnNlcSwgYnVmLCBvZmZzZXQpO1xuICAgIH1cbiAgICByZXR1cm4gYnVmID8gYnl0ZXMgOiB1bnNhZmVTdHJpbmdpZnkoYnl0ZXMpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVY3U3RhdGUoc3RhdGUsIG5vdywgcm5kcykge1xuICAgIHN0YXRlLm1zZWNzID8/PSAtSW5maW5pdHk7XG4gICAgc3RhdGUuc2VxID8/PSAwO1xuICAgIGlmIChub3cgPiBzdGF0ZS5tc2Vjcykge1xuICAgICAgICBzdGF0ZS5zZXEgPSAocm5kc1s2XSA8PCAyMykgfCAocm5kc1s3XSA8PCAxNikgfCAocm5kc1s4XSA8PCA4KSB8IHJuZHNbOV07XG4gICAgICAgIHN0YXRlLm1zZWNzID0gbm93O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc3RhdGUuc2VxID0gKHN0YXRlLnNlcSArIDEpIHwgMDtcbiAgICAgICAgaWYgKHN0YXRlLnNlcSA9PT0gMCkge1xuICAgICAgICAgICAgc3RhdGUubXNlY3MrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RhdGU7XG59XG5mdW5jdGlvbiB2N0J5dGVzKHJuZHMsIG1zZWNzLCBzZXEsIGJ1Ziwgb2Zmc2V0ID0gMCkge1xuICAgIGlmIChybmRzLmxlbmd0aCA8IDE2KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmFuZG9tIGJ5dGVzIGxlbmd0aCBtdXN0IGJlID49IDE2Jyk7XG4gICAgfVxuICAgIGlmICghYnVmKSB7XG4gICAgICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KDE2KTtcbiAgICAgICAgb2Zmc2V0ID0gMDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChvZmZzZXQgPCAwIHx8IG9mZnNldCArIDE2ID4gYnVmLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoYFVVSUQgYnl0ZSByYW5nZSAke29mZnNldH06JHtvZmZzZXQgKyAxNX0gaXMgb3V0IG9mIGJ1ZmZlciBib3VuZHNgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBtc2VjcyA/Pz0gRGF0ZS5ub3coKTtcbiAgICBzZXEgPz89ICgocm5kc1s2XSAqIDB4N2YpIDw8IDI0KSB8IChybmRzWzddIDw8IDE2KSB8IChybmRzWzhdIDw8IDgpIHwgcm5kc1s5XTtcbiAgICBidWZbb2Zmc2V0KytdID0gKG1zZWNzIC8gMHgxMDAwMDAwMDAwMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAobXNlY3MgLyAweDEwMDAwMDAwMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAobXNlY3MgLyAweDEwMDAwMDApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gKG1zZWNzIC8gMHgxMDAwMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAobXNlY3MgLyAweDEwMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBtc2VjcyAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IDB4NzAgfCAoKHNlcSA+Pj4gMjgpICYgMHgwZik7XG4gICAgYnVmW29mZnNldCsrXSA9IChzZXEgPj4+IDIwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IDB4ODAgfCAoKHNlcSA+Pj4gMTQpICYgMHgzZik7XG4gICAgYnVmW29mZnNldCsrXSA9IChzZXEgPj4+IDYpICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gKChzZXEgPDwgMikgJiAweGZmKSB8IChybmRzWzEwXSAmIDB4MDMpO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBybmRzWzExXTtcbiAgICBidWZbb2Zmc2V0KytdID0gcm5kc1sxMl07XG4gICAgYnVmW29mZnNldCsrXSA9IHJuZHNbMTNdO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBybmRzWzE0XTtcbiAgICBidWZbb2Zmc2V0KytdID0gcm5kc1sxNV07XG4gICAgcmV0dXJuIGJ1Zjtcbn1cbmV4cG9ydCBkZWZhdWx0IHY3O1xuIiwiaW1wb3J0IHsgUHVibGlzaEV2ZW50IH0gZnJvbSBcIi4uL0V2ZW50UHVibGlzaGVyL1B1Ymxpc2hFdmVudFwiO1xuaW1wb3J0IHtcbiAgdjcgYXMgdXVpZHY3LFxuICB2YWxpZGF0ZSBhcyB1dWlkVmFsaWRhdGUsXG4gIHZlcnNpb24gYXMgdXVpZFZlcnNpb24sXG59IGZyb20gXCJ1dWlkXCI7XG5cbmV4cG9ydCBjb25zdCBlbnVtIEV2ZW50VHlwZSB7XG4gIFZpc2l0b3IgPSAxLFxuICBTZXNzaW9uID0gMixcbiAgU2VjdGlvbiA9IDMsXG4gIENsaWNrID0gNCxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFJlZmVyZW5jZSB7XG4gIHJlYWRvbmx5IGV2ZW50X3R5cGU6IEV2ZW50VHlwZTtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRXZlbnRSZWZlcmVuY2UodmFsdWU6IGFueSk6IHZhbHVlIGlzIEV2ZW50UmVmZXJlbmNlIHtcbiAgcmV0dXJuICEoXG4gICAgdHlwZW9mIHZhbHVlID09IFwidW5kZWZpbmVkXCIgfHxcbiAgICB0eXBlb2YgdmFsdWUuZXZlbnRfdHlwZSAhPSBcIm51bWJlclwiIHx8XG4gICAgdHlwZW9mIHZhbHVlLmlkICE9IFwic3RyaW5nXCIgfHxcbiAgICAhdXVpZFZhbGlkYXRlKHZhbHVlLmlkKSB8fFxuICAgIHV1aWRWZXJzaW9uKHZhbHVlLmlkKSAhPSA3XG4gICk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnQgZXh0ZW5kcyBFdmVudFJlZmVyZW5jZSB7XG4gIHRvUHVibGlzaEV2ZW50KCk6IFB1Ymxpc2hFdmVudDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWaXNpdG9yRXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5WaXNpdG9yO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpc2l0b3JSZWZlcmVuY2UgZXh0ZW5kcyBFdmVudFJlZmVyZW5jZSB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5WaXNpdG9yO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25FdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgcGFyZW50OiBWaXNpdG9yUmVmZXJlbmNlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25SZWZlcmVuY2UgZXh0ZW5kcyBFdmVudFJlZmVyZW5jZSB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5TZXNzaW9uO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3Rpb25FdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlY3Rpb247XG4gIHBhcmVudDogU2Vzc2lvblJlZmVyZW5jZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN0aW9uUmVmZXJlbmNlIGV4dGVuZHMgRXZlbnRSZWZlcmVuY2Uge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuU2VjdGlvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDbGlja0V2ZW50IGV4dGVuZHMgRXZlbnQge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuQ2xpY2s7XG4gIHBhcmVudDogU2VjdGlvblJlZmVyZW5jZTtcbn1cblxuZXhwb3J0IGNsYXNzIFZpc2l0b3IgaW1wbGVtZW50cyBWaXNpdG9yRXZlbnQsIFZpc2l0b3JSZWZlcmVuY2Uge1xuICByZWFkb25seSBldmVudF90eXBlOiBFdmVudFR5cGUuVmlzaXRvcjtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmV2ZW50X3R5cGUgPSBFdmVudFR5cGUuVmlzaXRvcjtcbiAgICB0aGlzLmlkID0gdXVpZHY3KCk7XG4gIH1cblxuICB0b1B1Ymxpc2hFdmVudCgpOiBQdWJsaXNoRXZlbnQge1xuICAgIHJldHVybiB7XG4gICAgICB0OiB0aGlzLmV2ZW50X3R5cGUsXG4gICAgICBpOiB0aGlzLmlkLFxuICAgICAgYTogdW5kZWZpbmVkLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlc3Npb24gaW1wbGVtZW50cyBTZXNzaW9uRXZlbnQsIFNlc3Npb25SZWZlcmVuY2Uge1xuICByZWFkb25seSBldmVudF90eXBlOiBFdmVudFR5cGUuU2Vzc2lvbjtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcmVhZG9ubHkgcGFyZW50OiBWaXNpdG9yUmVmZXJlbmNlO1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogVmlzaXRvclJlZmVyZW5jZSkge1xuICAgIHRoaXMuZXZlbnRfdHlwZSA9IEV2ZW50VHlwZS5TZXNzaW9uO1xuICAgIHRoaXMuaWQgPSB1dWlkdjcoKTtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgfVxuXG4gIHRvUHVibGlzaEV2ZW50KCk6IFB1Ymxpc2hFdmVudCB7XG4gICAgY29uc3QgYXR0cnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7IHBhcmVudDogdGhpcy5wYXJlbnQuaWQgfTtcbiAgICByZXR1cm4ge1xuICAgICAgdDogdGhpcy5ldmVudF90eXBlLFxuICAgICAgaTogdGhpcy5pZCxcbiAgICAgIGE6IGF0dHJzLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlY3Rpb24gaW1wbGVtZW50cyBTZWN0aW9uRXZlbnQsIFNlY3Rpb25SZWZlcmVuY2Uge1xuICByZWFkb25seSBldmVudF90eXBlOiBFdmVudFR5cGUuU2VjdGlvbjtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcmVhZG9ubHkgcGFyZW50OiBTZXNzaW9uUmVmZXJlbmNlO1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogU2Vzc2lvblJlZmVyZW5jZSkge1xuICAgIHRoaXMuZXZlbnRfdHlwZSA9IEV2ZW50VHlwZS5TZWN0aW9uO1xuICAgIHRoaXMuaWQgPSB1dWlkdjcoKTtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgfVxuXG4gIHRvUHVibGlzaEV2ZW50KCk6IFB1Ymxpc2hFdmVudCB7XG4gICAgY29uc3QgYXR0cnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7IHBhcmVudDogdGhpcy5wYXJlbnQuaWQgfTtcbiAgICByZXR1cm4ge1xuICAgICAgdDogdGhpcy5ldmVudF90eXBlLFxuICAgICAgaTogdGhpcy5pZCxcbiAgICAgIGE6IGF0dHJzLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENsaWNrIGltcGxlbWVudHMgQ2xpY2tFdmVudCB7XG4gIHJlYWRvbmx5IGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5DbGljaztcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcmVhZG9ubHkgcGFyZW50OiBTZWN0aW9uUmVmZXJlbmNlO1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogU2VjdGlvblJlZmVyZW5jZSkge1xuICAgIHRoaXMuZXZlbnRfdHlwZSA9IEV2ZW50VHlwZS5DbGljaztcbiAgICB0aGlzLmlkID0gdXVpZHY3KCk7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cblxuICB0b1B1Ymxpc2hFdmVudCgpOiBQdWJsaXNoRXZlbnQge1xuICAgIGNvbnN0IGF0dHJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0geyBwYXJlbnQ6IHRoaXMucGFyZW50LmlkIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIHQ6IHRoaXMuZXZlbnRfdHlwZSxcbiAgICAgIGk6IHRoaXMuaWQsXG4gICAgICBhOiBhdHRycyxcbiAgICB9O1xuICB9XG59XG4iLCJpbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hTdWNjZXNzIHtcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGVudW0gRXZlbnRQdWJsaXNoRXJyb3Ige1xuICBCYWRSZXF1ZXN0LFxuICBDb25maWd1cmF0aW9uRXJyb3IsXG4gIEludGVybmFsU2VydmVyRXJyb3IsXG4gIFRpbWVvdXQsXG59XG5cbmV4cG9ydCB0eXBlIEV2ZW50UHVibGlzaFJlc3VsdCA9IEV2ZW50UHVibGlzaFN1Y2Nlc3MgfCBFdmVudFB1Ymxpc2hFcnJvcjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hlciB7XG4gIHB1Ymxpc2goZXZlbnRzOiBQdWJsaXNoRXZlbnRbXSk6IFByb21pc2U8RXZlbnRQdWJsaXNoUmVzdWx0Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24ge1xuICBhcGlfa2V5OiBzdHJpbmc7XG4gIGhvc3Q6IHN0cmluZztcbn1cblxuZXhwb3J0IGVudW0gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUge1xuICBJbnZhbGlkLFxuICBJbnZhbGlkQXBpS2V5LFxuICBJbnZhbGlkSG9zdCxcbiAgU3VjY2Vzcyxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKFxuICBjb25maWc6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbixcbik6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlIHtcbiAgaWYgKGNvbmZpZy5hcGlfa2V5LnRyaW0oKS5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLkludmFsaWRBcGlLZXk7XG4gIH1cbiAgY29uc3QgaG9zdCA9IFVSTC5wYXJzZShjb25maWcuaG9zdCk7XG4gIGlmIChob3N0ID09IG51bGwpIHtcbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZEhvc3Q7XG4gIH1cbiAgaWYgKFxuICAgIGhvc3QucGF0aG5hbWUubGVuZ3RoID4gMSB8fFxuICAgIGhvc3Quc2VhcmNoLmxlbmd0aCA+IDAgfHxcbiAgICBob3N0Lmhhc2gubGVuZ3RoID4gMFxuICApIHtcbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZEhvc3Q7XG4gIH1cbiAgcmV0dXJuIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLlN1Y2Nlc3M7XG59XG4iLCJpbXBvcnQge1xuICBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24sXG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLFxuICBFdmVudFB1Ymxpc2hFcnJvcixcbiAgRXZlbnRQdWJsaXNoUmVzdWx0LFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgUHVibGlzaEV2ZW50IH0gZnJvbSBcIi4vUHVibGlzaEV2ZW50XCI7XG5cbmV4cG9ydCBlbnVtIFdvcmtlck1lc3NhZ2VUeXBlIHtcbiAgQ29uZmlndXJlUmVxdWVzdCxcbiAgQ29uZmlndXJlUmVzdWx0LFxuICBQdWJsaXNoRXJyb3IsXG4gIFB1Ymxpc2hSZXF1ZXN0LFxuICBQdWJsaXNoUmVzdWx0LFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlck1lc3NhZ2Uge1xuICBpZDogc3RyaW5nO1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5Db25maWd1cmVSZXF1ZXN0O1xuICBjb25maWc6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJDb25maWd1cmF0aW9uUmVzdWx0TWVzc2FnZSBleHRlbmRzIFdvcmtlck1lc3NhZ2Uge1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuQ29uZmlndXJlUmVzdWx0O1xuICBjb25maWd1cmF0aW9uU3RhdGU6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlclB1Ymxpc2hFcnJvck1lc3NhZ2UgZXh0ZW5kcyBXb3JrZXJNZXNzYWdlIHtcbiAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLlB1Ymxpc2hFcnJvcjtcbiAgZXJyb3JUeXBlOiBFdmVudFB1Ymxpc2hFcnJvcjtcbiAgZXJyb3JNZXNzYWdlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVxdWVzdDtcbiAgZXZlbnRzOiBQdWJsaXNoRXZlbnRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZSBleHRlbmRzIFdvcmtlck1lc3NhZ2Uge1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaFJlc3VsdDtcbiAgcmVzdWx0OiBFdmVudFB1Ymxpc2hSZXN1bHQ7XG59XG4iLCJpbXBvcnQgeyBWaXNpdG9yIH0gZnJvbSBcIi4vRXZlbnQvRXZlbnRcIjtcbi8vIGltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gXCIuL0V2ZW50TWFuYWdlci9FdmVudE1hbmFnZXJcIjtcbi8vIGltcG9ydCB7IEh0dHBFdmVudFB1Ymxpc2hlciB9IGZyb20gXCIuL0V2ZW50UHVibGlzaGVyL0h0dHBFdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgV29ya2VyUHVibGlzaGVyR2F0ZXdheSB9IGZyb20gXCIuL0V2ZW50UHVibGlzaGVyL1dvcmtlclB1Ymxpc2hlckdhdGV3YXlcIjtcbi8vIGltcG9ydCB7IFdlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5IH0gZnJvbSBcIi4vU2l0ZVN0YXRlL1dlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5XCI7XG5cbmxldCBhcGlfa2V5ID0gXCJhYmMteHl6XCI7XG5sZXQgaG9zdCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwXCI7XG5cbi8vIGxldCBzaXRlU3RhdGVSZXBvc2l0b3J5ID0gbmV3IFdlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5KGFwaV9rZXkpO1xuLy8gbGV0IHB1Ymxpc2hlciA9IG5ldyBIdHRwRXZlbnRQdWJsaXNoZXIoe1xuLy8gICBhcGlfa2V5LFxuLy8gICBob3N0OiBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiLFxuLy8gfSk7XG4vLyBsZXQgZXZlbnRNYW5hZ2VyID0gbmV3IEV2ZW50TWFuYWdlcihwdWJsaXNoZXIsIHNpdGVTdGF0ZVJlcG9zaXRvcnkpO1xuXG4vLyBldmVudE1hbmFnZXIucmVnaXN0ZXJTZWN0aW9uKCk7XG5cbmxldCB2aXNpdG9yOiBWaXNpdG9yID0gbmV3IFZpc2l0b3IoKTtcblxubGV0IGdhdGV3YXkgPSBuZXcgV29ya2VyUHVibGlzaGVyR2F0ZXdheSh7IGFwaV9rZXksIGhvc3QgfSwgKGUpID0+XG4gIGNvbnNvbGUubG9nKGUpLFxuKTtcblxuZ2F0ZXdheS5wdWJsaXNoKFt2aXNpdG9yLnRvUHVibGlzaEV2ZW50KCldKTtcbiIsImltcG9ydCB7XG4gIEV2ZW50UHVibGlzaGVyLFxuICBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24sXG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLFxuICBFdmVudFB1Ymxpc2hSZXN1bHQsXG4gIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uLFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgUHVibGlzaEV2ZW50IH0gZnJvbSBcIi4vUHVibGlzaEV2ZW50XCI7XG5pbXBvcnQge1xuICBXb3JrZXJDb25maWd1cmF0aW9uUmVxdWVzdE1lc3NhZ2UsXG4gIFdvcmtlckNvbmZpZ3VyYXRpb25SZXN1bHRNZXNzYWdlLFxuICBXb3JrZXJNZXNzYWdlVHlwZSxcbiAgV29ya2VyUHVibGlzaEVycm9yTWVzc2FnZSxcbiAgV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlLFxuICBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZSxcbn0gZnJvbSBcIi4vV29ya2VyTWVzc2FnZVwiO1xuaW1wb3J0IHsgdjcgYXMgdXVpZHY3IH0gZnJvbSBcInV1aWRcIjtcblxudHlwZSBSZXNvbHZlRXZlbnRQdWJsaXNoUmVzdWx0ID0gKFxuICB2YWx1ZTogRXZlbnRQdWJsaXNoUmVzdWx0IHwgUHJvbWlzZUxpa2U8RXZlbnRQdWJsaXNoUmVzdWx0PixcbikgPT4gdm9pZDtcbnR5cGUgUmVqZWN0RXZlbnRQdWJsaXNoUmVzdWx0ID0gKHJlYXNvbj86IGFueSkgPT4gdm9pZDtcblxuaW50ZXJmYWNlIFByb21pc2VIYW5kbGVycyB7XG4gIHJlc29sdmU6IFJlc29sdmVFdmVudFB1Ymxpc2hSZXN1bHQ7XG4gIHJlamVjdDogUmVqZWN0RXZlbnRQdWJsaXNoUmVzdWx0O1xufVxuXG5leHBvcnQgdHlwZSBHbG9iYWxQdWJsaXNoRXJyb3JIYW5kbGVyID0gKGVycj86IHN0cmluZykgPT4gdm9pZDtcblxuZXhwb3J0IGNsYXNzIFdvcmtlclB1Ymxpc2hlckdhdGV3YXkgaW1wbGVtZW50cyBFdmVudFB1Ymxpc2hlciB7XG4gIHByaXZhdGUgd29ya2VyUHVibGlzaGVyOiBXb3JrZXI7XG4gIHByaXZhdGUgcHJvbWlzZVJlZ2lzdHJ5OiBSZWNvcmQ8c3RyaW5nLCBQcm9taXNlSGFuZGxlcnM+O1xuICBwcml2YXRlIGNvbmZpZ3VyYXRpb25TdGF0ZTogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgZXJyb3JIYW5kbGVyOiBHbG9iYWxQdWJsaXNoRXJyb3JIYW5kbGVyIHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGNvbmZpZzogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uLFxuICAgIGVycm9ySGFuZGxlcj86IEdsb2JhbFB1Ymxpc2hFcnJvckhhbmRsZXIsXG4gICkge1xuICAgIHRoaXMuZXJyb3JIYW5kbGVyID0gZXJyb3JIYW5kbGVyO1xuICAgIHRoaXMuY29uZmlndXJhdGlvblN0YXRlID0gdW5kZWZpbmVkO1xuICAgIGlmIChcbiAgICAgIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKGNvbmZpZykgIT1cbiAgICAgIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLlN1Y2Nlc3NcbiAgICApIHtcbiAgICAgIGlmICh0aGlzLmVycm9ySGFuZGxlciAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5lcnJvckhhbmRsZXIoXG4gICAgICAgICAgXCJFcnJvciBjb25zdHJ1Y3RpbmcgV29ya2VyUHVibGlzaGVyR2F0ZXdheSAtIEludmFsaWQgQ29uZmlndXJhdGlvblwiLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBFdmVudCBQdWJsaXNoZXIgQ29uZmlndXJhdGlvblwiKTtcbiAgICB9XG4gICAgdGhpcy5wcm9taXNlUmVnaXN0cnkgPSB7fTtcbiAgICB0aGlzLndvcmtlclB1Ymxpc2hlciA9IG5ldyBXb3JrZXIoXG4gICAgICBuZXcgVVJMKFwiV29ya2VyUHVibGlzaGVyLmpzXCIsIGltcG9ydC5tZXRhLnVybCksXG4gICAgKTtcbiAgICB0aGlzLndvcmtlclB1Ymxpc2hlci5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAobSkgPT5cbiAgICAgIHRoaXMucm91dGVNZXNzYWdlKG0pLFxuICAgICk7XG4gICAgdGhpcy53b3JrZXJQdWJsaXNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIChlKSA9PiB7XG4gICAgICBpZiAodGhpcy5lcnJvckhhbmRsZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyKGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5wb3N0Q29uZmlnUmVxdWVzdChjb25maWcpO1xuICB9XG5cbiAgcHVibGlzaChldmVudHM6IFB1Ymxpc2hFdmVudFtdKTogUHJvbWlzZTxFdmVudFB1Ymxpc2hSZXN1bHQ+IHtcbiAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5jcmVhdGVQdWJsaXNoTWVzc2FnZShldmVudHMpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxFdmVudFB1Ymxpc2hSZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMucmVnaXN0ZXJQdWJsaXNoUHJvbWlzZShtZXNzYWdlLCB7IHJlc29sdmUsIHJlamVjdCB9KTtcbiAgICAgIHRoaXMucG9zdFB1Ymxpc2hSZXF1ZXN0KG1lc3NhZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByb3V0ZU1lc3NhZ2UobWVzc2FnZTogTWVzc2FnZUV2ZW50KSB7XG4gICAgY29uc3Qgd29ya2VyTWVzc2FnZSA9IG1lc3NhZ2UuZGF0YSBhc1xuICAgICAgfCBXb3JrZXJDb25maWd1cmF0aW9uUmVzdWx0TWVzc2FnZVxuICAgICAgfCBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZVxuICAgICAgfCBXb3JrZXJQdWJsaXNoRXJyb3JNZXNzYWdlO1xuXG4gICAgaWYgKHdvcmtlck1lc3NhZ2UubWVzc2FnZVR5cGUgPT0gV29ya2VyTWVzc2FnZVR5cGUuQ29uZmlndXJlUmVzdWx0KSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyYXRpb25TdGF0ZSA9IHdvcmtlck1lc3NhZ2UuY29uZmlndXJhdGlvblN0YXRlO1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25TdGF0ZSAhPSBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZS5TdWNjZXNzICYmXG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyICE9IHVuZGVmaW5lZFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyKFwiV29ya2VyIGV2ZW50IHB1Ymxpc2hlciBmYWlsZWRcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVzb2x2ZVB1Ymxpc2god29ya2VyTWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNvbHZlUHVibGlzaChcbiAgICByZXN1bHRNZXNzYWdlOiBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZSB8IFdvcmtlclB1Ymxpc2hFcnJvck1lc3NhZ2UsXG4gICkge1xuICAgIGNvbnN0IGhhbmRsZXJzID0gdGhpcy5wcm9taXNlUmVnaXN0cnlbcmVzdWx0TWVzc2FnZS5pZF07XG4gICAgaWYgKGhhbmRsZXJzID09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHRoaXMuZXJyb3JIYW5kbGVyICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmVycm9ySGFuZGxlcihcbiAgICAgICAgICBcIkV2ZW50IFB1Ymxpc2ggUmVzdWx0IGhhZCBubyBtYXRjaGluZyBoYW5kbGVycyBpbiByZWdpc3RyeVwiLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyZXN1bHRNZXNzYWdlLm1lc3NhZ2VUeXBlID09IFdvcmtlck1lc3NhZ2VUeXBlLlB1Ymxpc2hSZXN1bHQpIHtcbiAgICAgICAgaGFuZGxlcnMucmVzb2x2ZShyZXN1bHRNZXNzYWdlLnJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVycy5yZWplY3QocmVzdWx0TWVzc2FnZS5lcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgZGVsZXRlIHRoaXMucHJvbWlzZVJlZ2lzdHJ5W3Jlc3VsdE1lc3NhZ2UuaWRdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHVibGlzaE1lc3NhZ2UoXG4gICAgZXZlbnRzOiBQdWJsaXNoRXZlbnRbXSxcbiAgKTogV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlIHtcbiAgICBjb25zdCBpZCA9IHV1aWR2NygpO1xuICAgIHJldHVybiB7XG4gICAgICBpZCxcbiAgICAgIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVxdWVzdCxcbiAgICAgIGV2ZW50czogZXZlbnRzLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyUHVibGlzaFByb21pc2UoXG4gICAgbWVzc2FnZTogV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlLFxuICAgIGhhbmRsZXJzOiBQcm9taXNlSGFuZGxlcnMsXG4gICk6IHZvaWQge1xuICAgIHRoaXMucHJvbWlzZVJlZ2lzdHJ5W21lc3NhZ2UuaWRdID0gaGFuZGxlcnM7XG4gIH1cblxuICBwcml2YXRlIHBvc3RQdWJsaXNoUmVxdWVzdChcbiAgICBwdWJsaXNoTWVzc2FnZTogV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlLFxuICApOiB2b2lkIHtcbiAgICB0aGlzLndvcmtlclB1Ymxpc2hlci5wb3N0TWVzc2FnZShwdWJsaXNoTWVzc2FnZSk7XG4gIH1cblxuICBwcml2YXRlIHBvc3RDb25maWdSZXF1ZXN0KGNvbmZpZzogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgY29uZmlnTWVzc2FnZTogV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlID0ge1xuICAgICAgY29uZmlnLFxuICAgICAgaWQ6IHV1aWR2NygpLFxuICAgICAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLkNvbmZpZ3VyZVJlcXVlc3QsXG4gICAgfTtcbiAgICB0aGlzLndvcmtlclB1Ymxpc2hlci5wb3N0TWVzc2FnZShjb25maWdNZXNzYWdlKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJnZXRSYW5kb21WYWx1ZXMiLCJtIiwidSIsImNodW5rSWQiLCJnIiwiZ2xvYmFsVGhpcyIsInRoaXMiLCJGdW5jdGlvbiIsImUiLCJ3aW5kb3ciLCJvIiwib2JqIiwicHJvcCIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJsb2NhdGlvbiIsImRvY3VtZW50IiwiY3VycmVudFNjcmlwdCIsInRhZ05hbWUiLCJ0b1VwcGVyQ2FzZSIsInNyYyIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImxlbmd0aCIsImkiLCJ0ZXN0IiwiRXJyb3IiLCJyZXBsYWNlIiwicCIsImIiLCJiYXNlVVJJIiwic2VsZiIsImhyZWYiLCJybmRzOCIsIlVpbnQ4QXJyYXkiLCJybmciLCJjcnlwdG8iLCJiaW5kIiwiYnl0ZVRvSGV4IiwicHVzaCIsInRvU3RyaW5nIiwic2xpY2UiLCJfc3RhdGUiLCJ2N0J5dGVzIiwicm5kcyIsIm1zZWNzIiwic2VxIiwiYnVmIiwib2Zmc2V0IiwiUmFuZ2VFcnJvciIsIkRhdGUiLCJub3ciLCJvcHRpb25zIiwiYnl0ZXMiLCJyYW5kb20iLCJzdGF0ZSIsInVwZGF0ZVY3U3RhdGUiLCJhcnIiLCJ0b0xvd2VyQ2FzZSIsInVuc2FmZVN0cmluZ2lmeSIsIkV2ZW50VHlwZSIsIkV2ZW50UHVibGlzaEVycm9yIiwiRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUiLCJXb3JrZXJNZXNzYWdlVHlwZSIsInZpc2l0b3IiLCJjb25zdHJ1Y3RvciIsImV2ZW50X3R5cGUiLCJWaXNpdG9yIiwiaWQiLCJ0b1B1Ymxpc2hFdmVudCIsInQiLCJhIiwidW5kZWZpbmVkIiwiY29uZmlnIiwiZXJyb3JIYW5kbGVyIiwiY29uZmlndXJhdGlvblN0YXRlIiwiYXBpX2tleSIsInRyaW0iLCJJbnZhbGlkQXBpS2V5IiwiaG9zdCIsIlVSTCIsInBhcnNlIiwicGF0aG5hbWUiLCJzZWFyY2giLCJoYXNoIiwiSW52YWxpZEhvc3QiLCJTdWNjZXNzIiwidmFsaWRhdGVFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24iLCJwcm9taXNlUmVnaXN0cnkiLCJ3b3JrZXJQdWJsaXNoZXIiLCJXb3JrZXIiLCJhZGRFdmVudExpc3RlbmVyIiwicm91dGVNZXNzYWdlIiwibWVzc2FnZSIsInBvc3RDb25maWdSZXF1ZXN0IiwicHVibGlzaCIsImV2ZW50cyIsImNyZWF0ZVB1Ymxpc2hNZXNzYWdlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZWdpc3RlclB1Ymxpc2hQcm9taXNlIiwicG9zdFB1Ymxpc2hSZXF1ZXN0Iiwid29ya2VyTWVzc2FnZSIsImRhdGEiLCJtZXNzYWdlVHlwZSIsIkNvbmZpZ3VyZVJlc3VsdCIsInJlc29sdmVQdWJsaXNoIiwicmVzdWx0TWVzc2FnZSIsImhhbmRsZXJzIiwiUHVibGlzaFJlc3VsdCIsInJlc3VsdCIsImVycm9yTWVzc2FnZSIsIlB1Ymxpc2hSZXF1ZXN0IiwicHVibGlzaE1lc3NhZ2UiLCJwb3N0TWVzc2FnZSIsImNvbmZpZ01lc3NhZ2UiLCJDb25maWd1cmVSZXF1ZXN0IiwiY29uc29sZSIsImxvZyJdLCJzb3VyY2VSb290IjoiIn0=