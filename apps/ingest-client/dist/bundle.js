(()=>{"use strict";const t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,e=function(e){return"string"==typeof e&&t.test(e)};let i;const s=new Uint8Array(16);function r(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(s)}const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));const o={};function c(t,e,i,s,r=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(s){if(r<0||r+16>s.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`)}else s=new Uint8Array(16),r=0;return e??=Date.now(),i??=127*t[6]<<24|t[7]<<16|t[8]<<8|t[9],s[r++]=e/1099511627776&255,s[r++]=e/4294967296&255,s[r++]=e/16777216&255,s[r++]=e/65536&255,s[r++]=e/256&255,s[r++]=255&e,s[r++]=112|i>>>28&15,s[r++]=i>>>20&255,s[r++]=128|i>>>14&63,s[r++]=i>>>6&255,s[r++]=i<<2&255|3&t[10],s[r++]=t[11],s[r++]=t[12],s[r++]=t[13],s[r++]=t[14],s[r++]=t[15],s}const a=function(t,e,i){let s;if(t)s=c(t.random??t.rng?.()??r(),t.msecs,t.seq,e,i);else{const t=Date.now(),n=r();!function(t,e,i){t.msecs??=-1/0,t.seq??=0,e>t.msecs?(t.seq=i[6]<<23|i[7]<<16|i[8]<<8|i[9],t.msecs=e):(t.seq=t.seq+1|0,0===t.seq&&t.msecs++)}(o,t,n),s=c(n,o.msecs,o.seq,e,i)}return e?s:function(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}(s)};var u,h,f,l;function S(t){return!(void 0===t||"number"!=typeof t.event_type||"string"!=typeof t.id||!e(t.id)||7!=function(t){if(!e(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}(t.id))}!function(t){t[t.Visitor=1]="Visitor",t[t.Session=2]="Session",t[t.Section=3]="Section",t[t.Click=4]="Click"}(u||(u={}));class d{constructor(){this.event_type=u.Visitor,this.id=a()}toPublishEvent(){return{t:this.event_type,i:this.id,a:void 0}}}class p{constructor(t){this.event_type=u.Session,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}class v{constructor(t){this.event_type=u.Section,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}class g{constructor(t){this.event_type=u.Click,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}function y(t){return"number"==typeof t}!function(t){t[t.BadRequestError=0]="BadRequestError",t[t.ConfigurationError=1]="ConfigurationError",t[t.InternalError=2]="InternalError"}(h||(h={})),function(t){t[t.InternalError=0]="InternalError",t[t.MalformedData=1]="MalformedData",t[t.NotFound=2]="NotFound"}(f||(f={})),function(t){t[t.BadRequest=0]="BadRequest",t[t.InternalServerError=1]="InternalServerError",t[t.Timeout=2]="Timeout"}(l||(l={}));const m="SALUS",R="VISITOR",w="SESSION";let E="abc-xyz",_=new class{constructor(t){if(t.trim().length<1)throw new TypeError("invalid empty api_key");this.api_key=t,this.section=void 0}clearSiteState(){return this.clearSection(),this.clearSession(),this.clearVisitor(),{visitor:void 0,session:void 0,section:void 0}}getSiteState(){const t=this.getVisitor();let e;if("number"==typeof t)return t;e=t;const i=this.getSession();let s;if("number"==typeof i)return i==f.MalformedData||i==f.InternalError?i:{visitor:e,session:void 0,section:void 0};s=i;const r=this.getSection();let n;if("number"==typeof r){if(r==f.MalformedData||r==f.InternalError)return r}else n=r;return{visitor:e,session:s,section:n}}setSiteState(t){const e=t.section;if(void 0===e)this.clearSection();else{const t=this.setSection(e);if(!S(t))return t}const i=t.session;if(void 0===i)this.clearSession();else{const t=this.setSession(i);if(!S(t))return t}const s=t.visitor;if(void 0===s)this.clearVisitor();else{const t=this.setVisitor(s);if(!S(t))return t}return t}getVisitor(){const t=[m,R,this.api_key].join("_"),e=localStorage.getItem(t);if(null==e)return f.NotFound;const i={id:e,event_type:u.Visitor};return S(i)?i:f.MalformedData}setVisitor(t){const e=[m,R,this.api_key].join("_");try{localStorage.setItem(e,t.id)}catch(t){return f.InternalError}return t}clearVisitor(){const t=[m,R,this.api_key].join("_");localStorage.removeItem(t)}getSession(){const t=[m,w,this.api_key].join("_"),e=sessionStorage.getItem(t);if(null==e)return f.NotFound;const i={id:e,event_type:u.Session};return S(i)?i:f.MalformedData}setSession(t){const e=[m,w,this.api_key].join("_");try{sessionStorage.setItem(e,t.id)}catch(t){return f.InternalError}return t}clearSession(){const t=[m,w,this.api_key].join("_");localStorage.removeItem(t)}getSection(){return null==this.section?f.NotFound:this.section}setSection(t){return this.section=t,this.section}clearSection(){this.section=void 0}}(E),I=new class{constructor(t,e){this.api_key=t,this.endpoint=e+"/multi"}publish(t){return e=this,i=void 0,r=function*(){const e=yield fetch(this.createRequest(t));return e.ok?{count:t.length}:500==e.status?l.InternalServerError:400==e.status?l.BadRequest:l.Timeout},new((s=void 0)||(s=Promise))((function(t,n){function o(t){try{a(r.next(t))}catch(t){n(t)}}function c(t){try{a(r.throw(t))}catch(t){n(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(o,c)}a((r=r.apply(e,i||[])).next())}));var e,i,s,r}createRequest(t){return new Request(this.endpoint,{method:"POST",mode:"cors",headers:{"content-type":"application/json","api-key":this.api_key},body:JSON.stringify(t.map((t=>t.toPublishEvent())))})}}(E,"http://localhost:3000"),V=new class{constructor(t,e){this.publisher=t,this.siteStateRepository=e,this.eventQueue=[],this.siteStateWriteBuffer=void 0}getSiteState(){if(null!=this.siteStateWriteBuffer)return this.siteStateWriteBuffer;const t=this.siteStateRepository.getSiteState();return y(t)?this.siteStateWriteBuffer={visitor:void 0,session:void 0,section:void 0}:this.siteStateWriteBuffer=t,this.siteStateWriteBuffer}writeSiteState(){let t;return t=null!=this.siteStateWriteBuffer?this.siteStateRepository.setSiteState(this.siteStateWriteBuffer):this.siteStateRepository.clearSiteState(),this.siteStateWriteBuffer=void 0,t}setVisitorReference(t){this.siteStateWriteBuffer={visitor:t,session:void 0,section:void 0}}setSessionReference(t){this.siteStateWriteBuffer={visitor:this.getSiteState().visitor,session:t,section:void 0}}setSectionReference(t){this.siteStateWriteBuffer={visitor:this.getSiteState().visitor,session:this.getSiteState().session,section:t}}flush(){if(y(this.writeSiteState()))return h.InternalError;this.publisher.publish(this.eventQueue),this.eventQueue=[]}registerVisitor(){return this.createVisitor(),this.flush()}deregisterVisitor(){return this.setVisitorReference(void 0),this.flush()}createVisitor(){const t=new d;return this.setVisitorReference(t),this.eventQueue.push(t),t}getOrCreateVisitorReference(){const t=this.getSiteState().visitor;return null!=t?t:this.createVisitor()}registerSession(){return this.createSession(),this.flush()}deregisterSession(){return this.setSessionReference(void 0),this.flush()}createSession(){const t=this.getOrCreateVisitorReference(),e=new p(t);return this.setSessionReference(e),this.eventQueue.push(e),e}getOrCreateSessionReference(){const t=this.getSiteState().session;return null!=t?t:this.createSession()}registerSection(){return this.createSection(),this.flush()}deregisterSection(){return this.setSectionReference(void 0),this.flush()}createSection(){const t=this.getOrCreateSessionReference(),e=new v(t);return this.setSectionReference(e),this.eventQueue.push(e),e}getOrCreateSectionReference(){const t=this.getSiteState().section;return null!=t?t:this.createSection()}registerClick(){return this.createClick(),this.flush()}createClick(){const t=this.getOrCreateSectionReference(),e=new g(t);return this.eventQueue.push(e),e}}(I,_);V.registerSection()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q1QsQ0FFUSwyQkFBQXlFLEdBQ04sTUFBTUMsRUFBbUI1RixLQUFLeUIsZUFBZVAsUUFDN0MsT0FBd0JkLE1BQXBCd0YsRUFDS0EsRUFFRjVGLEtBQUt5RixlQUNkLENBRUEsYUFBQUksR0FFRSxPQURBN0YsS0FBSzhGLGNBQ0U5RixLQUFLNkUsT0FDZCxDQUVRLFdBQUFpQixHQUNOLE1BQU01RSxFQUFVbEIsS0FBSzJGLDhCQUNmSSxFQUFRLElBQUl0RixFQUFNUyxHQUV4QixPQURBbEIsS0FBS3NFLFdBQVd4RyxLQUFLaUksR0FDZEEsQ0FDVCxHRnBMa0NoRCxFQUFXL0IsR0FFL0NxRCxFQUFhbUIsaUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9yZWdleC5qcyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci92YWxpZGF0ZS5qcyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9ybmcuanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvc3RyaW5naWZ5LmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y3LmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvRXZlbnQvRXZlbnQudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudC9FdmVudFJlZ2lzdHJ5LnRzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvU2l0ZVN0YXRlL1NpdGVTdGF0ZS50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL0V2ZW50UHVibGlzaGVyLnRzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3ZlcnNpb24uanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9TaXRlU3RhdGUvV2ViU3RvcmFnZVNpdGVTdGF0ZVJlcG9zaXRvcnkudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL0h0dHBFdmVudFB1Ymxpc2hlci50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50TWFuYWdlci9FdmVudE1hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgL14oPzpbMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS04XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfXwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDB8ZmZmZmZmZmYtZmZmZi1mZmZmLWZmZmYtZmZmZmZmZmZmZmZmKSQvaTtcbiIsImltcG9ydCBSRUdFWCBmcm9tICcuL3JlZ2V4LmpzJztcbmZ1bmN0aW9uIHZhbGlkYXRlKHV1aWQpIHtcbiAgICByZXR1cm4gdHlwZW9mIHV1aWQgPT09ICdzdHJpbmcnICYmIFJFR0VYLnRlc3QodXVpZCk7XG59XG5leHBvcnQgZGVmYXVsdCB2YWxpZGF0ZTtcbiIsImxldCBnZXRSYW5kb21WYWx1ZXM7XG5jb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJuZygpIHtcbiAgICBpZiAoIWdldFJhbmRvbVZhbHVlcykge1xuICAgICAgICBpZiAodHlwZW9mIGNyeXB0byA9PT0gJ3VuZGVmaW5lZCcgfHwgIWNyeXB0by5nZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY3J5cHRvLmdldFJhbmRvbVZhbHVlcygpIG5vdCBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQjZ2V0cmFuZG9tdmFsdWVzLW5vdC1zdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBnZXRSYW5kb21WYWx1ZXMgPSBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQoY3J5cHRvKTtcbiAgICB9XG4gICAgcmV0dXJuIGdldFJhbmRvbVZhbHVlcyhybmRzOCk7XG59XG4iLCJpbXBvcnQgdmFsaWRhdGUgZnJvbSAnLi92YWxpZGF0ZS5qcyc7XG5jb25zdCBieXRlVG9IZXggPSBbXTtcbmZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHtcbiAgICBieXRlVG9IZXgucHVzaCgoaSArIDB4MTAwKS50b1N0cmluZygxNikuc2xpY2UoMSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuc2FmZVN0cmluZ2lmeShhcnIsIG9mZnNldCA9IDApIHtcbiAgICByZXR1cm4gKGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICtcbiAgICAgICAgJy0nICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA0XV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDVdXSArXG4gICAgICAgICctJyArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNl1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA3XV0gK1xuICAgICAgICAnLScgK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICtcbiAgICAgICAgJy0nICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMF1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMV1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMl1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxM11dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNF1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNV1dKS50b0xvd2VyQ2FzZSgpO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5KGFyciwgb2Zmc2V0ID0gMCkge1xuICAgIGNvbnN0IHV1aWQgPSB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQpO1xuICAgIGlmICghdmFsaWRhdGUodXVpZCkpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdTdHJpbmdpZmllZCBVVUlEIGlzIGludmFsaWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHV1aWQ7XG59XG5leHBvcnQgZGVmYXVsdCBzdHJpbmdpZnk7XG4iLCJpbXBvcnQgcm5nIGZyb20gJy4vcm5nLmpzJztcbmltcG9ydCB7IHVuc2FmZVN0cmluZ2lmeSB9IGZyb20gJy4vc3RyaW5naWZ5LmpzJztcbmNvbnN0IF9zdGF0ZSA9IHt9O1xuZnVuY3Rpb24gdjcob3B0aW9ucywgYnVmLCBvZmZzZXQpIHtcbiAgICBsZXQgYnl0ZXM7XG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgYnl0ZXMgPSB2N0J5dGVzKG9wdGlvbnMucmFuZG9tID8/IG9wdGlvbnMucm5nPy4oKSA/PyBybmcoKSwgb3B0aW9ucy5tc2Vjcywgb3B0aW9ucy5zZXEsIGJ1Ziwgb2Zmc2V0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IHJuZHMgPSBybmcoKTtcbiAgICAgICAgdXBkYXRlVjdTdGF0ZShfc3RhdGUsIG5vdywgcm5kcyk7XG4gICAgICAgIGJ5dGVzID0gdjdCeXRlcyhybmRzLCBfc3RhdGUubXNlY3MsIF9zdGF0ZS5zZXEsIGJ1Ziwgb2Zmc2V0KTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1ZiA/IGJ5dGVzIDogdW5zYWZlU3RyaW5naWZ5KGJ5dGVzKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVWN1N0YXRlKHN0YXRlLCBub3csIHJuZHMpIHtcbiAgICBzdGF0ZS5tc2VjcyA/Pz0gLUluZmluaXR5O1xuICAgIHN0YXRlLnNlcSA/Pz0gMDtcbiAgICBpZiAobm93ID4gc3RhdGUubXNlY3MpIHtcbiAgICAgICAgc3RhdGUuc2VxID0gKHJuZHNbNl0gPDwgMjMpIHwgKHJuZHNbN10gPDwgMTYpIHwgKHJuZHNbOF0gPDwgOCkgfCBybmRzWzldO1xuICAgICAgICBzdGF0ZS5tc2VjcyA9IG5vdztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHN0YXRlLnNlcSA9IChzdGF0ZS5zZXEgKyAxKSB8IDA7XG4gICAgICAgIGlmIChzdGF0ZS5zZXEgPT09IDApIHtcbiAgICAgICAgICAgIHN0YXRlLm1zZWNzKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlO1xufVxuZnVuY3Rpb24gdjdCeXRlcyhybmRzLCBtc2Vjcywgc2VxLCBidWYsIG9mZnNldCA9IDApIHtcbiAgICBpZiAocm5kcy5sZW5ndGggPCAxNikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JhbmRvbSBieXRlcyBsZW5ndGggbXVzdCBiZSA+PSAxNicpO1xuICAgIH1cbiAgICBpZiAoIWJ1Zikge1xuICAgICAgICBidWYgPSBuZXcgVWludDhBcnJheSgxNik7XG4gICAgICAgIG9mZnNldCA9IDA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAob2Zmc2V0IDwgMCB8fCBvZmZzZXQgKyAxNiA+IGJ1Zi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKGBVVUlEIGJ5dGUgcmFuZ2UgJHtvZmZzZXR9OiR7b2Zmc2V0ICsgMTV9IGlzIG91dCBvZiBidWZmZXIgYm91bmRzYCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbXNlY3MgPz89IERhdGUubm93KCk7XG4gICAgc2VxID8/PSAoKHJuZHNbNl0gKiAweDdmKSA8PCAyNCkgfCAocm5kc1s3XSA8PCAxNikgfCAocm5kc1s4XSA8PCA4KSB8IHJuZHNbOV07XG4gICAgYnVmW29mZnNldCsrXSA9IChtc2VjcyAvIDB4MTAwMDAwMDAwMDApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gKG1zZWNzIC8gMHgxMDAwMDAwMDApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gKG1zZWNzIC8gMHgxMDAwMDAwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IChtc2VjcyAvIDB4MTAwMDApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gKG1zZWNzIC8gMHgxMDApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gbXNlY3MgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAweDcwIHwgKChzZXEgPj4+IDI4KSAmIDB4MGYpO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAoc2VxID4+PiAyMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAweDgwIHwgKChzZXEgPj4+IDE0KSAmIDB4M2YpO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAoc2VxID4+PiA2KSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9ICgoc2VxIDw8IDIpICYgMHhmZikgfCAocm5kc1sxMF0gJiAweDAzKTtcbiAgICBidWZbb2Zmc2V0KytdID0gcm5kc1sxMV07XG4gICAgYnVmW29mZnNldCsrXSA9IHJuZHNbMTJdO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBybmRzWzEzXTtcbiAgICBidWZbb2Zmc2V0KytdID0gcm5kc1sxNF07XG4gICAgYnVmW29mZnNldCsrXSA9IHJuZHNbMTVdO1xuICAgIHJldHVybiBidWY7XG59XG5leHBvcnQgZGVmYXVsdCB2NztcbiIsImltcG9ydCB7IFB1Ymxpc2hFdmVudCB9IGZyb20gXCIuLi9FdmVudFB1Ymxpc2hlci9QdWJsaXNoRXZlbnRcIjtcbmltcG9ydCB7XG4gIHY3IGFzIHV1aWR2NyxcbiAgdmFsaWRhdGUgYXMgdXVpZFZhbGlkYXRlLFxuICB2ZXJzaW9uIGFzIHV1aWRWZXJzaW9uLFxufSBmcm9tIFwidXVpZFwiO1xuXG5leHBvcnQgY29uc3QgZW51bSBFdmVudFR5cGUge1xuICBWaXNpdG9yID0gMSxcbiAgU2Vzc2lvbiA9IDIsXG4gIFNlY3Rpb24gPSAzLFxuICBDbGljayA9IDQsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRSZWZlcmVuY2Uge1xuICByZWFkb25seSBldmVudF90eXBlOiBFdmVudFR5cGU7XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0V2ZW50UmVmZXJlbmNlKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyBFdmVudFJlZmVyZW5jZSB7XG4gIHJldHVybiAhKFxuICAgIHR5cGVvZiB2YWx1ZSA9PSBcInVuZGVmaW5lZFwiIHx8XG4gICAgdHlwZW9mIHZhbHVlLmV2ZW50X3R5cGUgIT0gXCJudW1iZXJcIiB8fFxuICAgIHR5cGVvZiB2YWx1ZS5pZCAhPSBcInN0cmluZ1wiIHx8XG4gICAgIXV1aWRWYWxpZGF0ZSh2YWx1ZS5pZCkgfHxcbiAgICB1dWlkVmVyc2lvbih2YWx1ZS5pZCkgIT0gN1xuICApO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50IGV4dGVuZHMgRXZlbnRSZWZlcmVuY2Uge1xuICB0b1B1Ymxpc2hFdmVudCgpOiBQdWJsaXNoRXZlbnQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlzaXRvckV2ZW50IGV4dGVuZHMgRXZlbnQge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuVmlzaXRvcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWaXNpdG9yUmVmZXJlbmNlIGV4dGVuZHMgRXZlbnRSZWZlcmVuY2Uge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuVmlzaXRvcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uRXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gIHBhcmVudDogVmlzaXRvclJlZmVyZW5jZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uUmVmZXJlbmNlIGV4dGVuZHMgRXZlbnRSZWZlcmVuY2Uge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuU2Vzc2lvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN0aW9uRXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5TZWN0aW9uO1xuICBwYXJlbnQ6IFNlc3Npb25SZWZlcmVuY2U7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdGlvblJlZmVyZW5jZSBleHRlbmRzIEV2ZW50UmVmZXJlbmNlIHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlY3Rpb247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xpY2tFdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLkNsaWNrO1xuICBwYXJlbnQ6IFNlY3Rpb25SZWZlcmVuY2U7XG59XG5cbmV4cG9ydCBjbGFzcyBWaXNpdG9yIGltcGxlbWVudHMgVmlzaXRvckV2ZW50LCBWaXNpdG9yUmVmZXJlbmNlIHtcbiAgcmVhZG9ubHkgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlZpc2l0b3I7XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ldmVudF90eXBlID0gRXZlbnRUeXBlLlZpc2l0b3I7XG4gICAgdGhpcy5pZCA9IHV1aWR2NygpO1xuICB9XG5cbiAgdG9QdWJsaXNoRXZlbnQoKTogUHVibGlzaEV2ZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdDogdGhpcy5ldmVudF90eXBlLFxuICAgICAgaTogdGhpcy5pZCxcbiAgICAgIGE6IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTZXNzaW9uIGltcGxlbWVudHMgU2Vzc2lvbkV2ZW50LCBTZXNzaW9uUmVmZXJlbmNlIHtcbiAgcmVhZG9ubHkgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlc3Npb247XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHBhcmVudDogVmlzaXRvclJlZmVyZW5jZTtcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IFZpc2l0b3JSZWZlcmVuY2UpIHtcbiAgICB0aGlzLmV2ZW50X3R5cGUgPSBFdmVudFR5cGUuU2Vzc2lvbjtcbiAgICB0aGlzLmlkID0gdXVpZHY3KCk7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cblxuICB0b1B1Ymxpc2hFdmVudCgpOiBQdWJsaXNoRXZlbnQge1xuICAgIGNvbnN0IGF0dHJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0geyBwYXJlbnQ6IHRoaXMucGFyZW50LmlkIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIHQ6IHRoaXMuZXZlbnRfdHlwZSxcbiAgICAgIGk6IHRoaXMuaWQsXG4gICAgICBhOiBhdHRycyxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTZWN0aW9uIGltcGxlbWVudHMgU2VjdGlvbkV2ZW50LCBTZWN0aW9uUmVmZXJlbmNlIHtcbiAgcmVhZG9ubHkgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlY3Rpb247XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHBhcmVudDogU2Vzc2lvblJlZmVyZW5jZTtcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IFNlc3Npb25SZWZlcmVuY2UpIHtcbiAgICB0aGlzLmV2ZW50X3R5cGUgPSBFdmVudFR5cGUuU2VjdGlvbjtcbiAgICB0aGlzLmlkID0gdXVpZHY3KCk7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cblxuICB0b1B1Ymxpc2hFdmVudCgpOiBQdWJsaXNoRXZlbnQge1xuICAgIGNvbnN0IGF0dHJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0geyBwYXJlbnQ6IHRoaXMucGFyZW50LmlkIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIHQ6IHRoaXMuZXZlbnRfdHlwZSxcbiAgICAgIGk6IHRoaXMuaWQsXG4gICAgICBhOiBhdHRycyxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDbGljayBpbXBsZW1lbnRzIENsaWNrRXZlbnQge1xuICByZWFkb25seSBldmVudF90eXBlOiBFdmVudFR5cGUuQ2xpY2s7XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHBhcmVudDogU2VjdGlvblJlZmVyZW5jZTtcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IFNlY3Rpb25SZWZlcmVuY2UpIHtcbiAgICB0aGlzLmV2ZW50X3R5cGUgPSBFdmVudFR5cGUuQ2xpY2s7XG4gICAgdGhpcy5pZCA9IHV1aWR2NygpO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgdG9QdWJsaXNoRXZlbnQoKTogUHVibGlzaEV2ZW50IHtcbiAgICBjb25zdCBhdHRyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHsgcGFyZW50OiB0aGlzLnBhcmVudC5pZCB9O1xuICAgIHJldHVybiB7XG4gICAgICB0OiB0aGlzLmV2ZW50X3R5cGUsXG4gICAgICBpOiB0aGlzLmlkLFxuICAgICAgYTogYXR0cnMsXG4gICAgfTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IGVudW0gUmVnaXN0ZXJFdmVudEVycm9yIHtcbiAgQmFkUmVxdWVzdEVycm9yLFxuICBDb25maWd1cmF0aW9uRXJyb3IsXG4gIEludGVybmFsRXJyb3IsXG59XG5cbmV4cG9ydCB0eXBlIFJlZ2lzdGVyRXZlbnRSZXN1bHQgPSBSZWdpc3RlckV2ZW50RXJyb3IgfCB2b2lkO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UmVnaXN0cnkge1xuICByZWdpc3RlclZpc2l0b3IoKTogUmVnaXN0ZXJFdmVudFJlc3VsdDtcbiAgZGVyZWdpc3RlclZpc2l0b3IoKTogUmVnaXN0ZXJFdmVudFJlc3VsdDtcbiAgcmVnaXN0ZXJTZXNzaW9uKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQ7XG4gIGRlcmVnaXN0ZXJTZXNzaW9uKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQ7XG4gIHJlZ2lzdGVyU2VjdGlvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0O1xuICBkZXJlZ2lzdGVyU2VjdGlvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0O1xuICByZWdpc3RlckNsaWNrKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQ7XG59XG4iLCJpbXBvcnQge1xuICBTZWN0aW9uUmVmZXJlbmNlLFxuICBTZXNzaW9uUmVmZXJlbmNlLFxuICBWaXNpdG9yUmVmZXJlbmNlLFxufSBmcm9tIFwiLi4vRXZlbnQvRXZlbnRcIjtcblxuZXhwb3J0IGVudW0gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yIHtcbiAgSW50ZXJuYWxFcnJvcixcbiAgTWFsZm9ybWVkRGF0YSxcbiAgTm90Rm91bmQsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZVN0YXRlIHtcbiAgdmlzaXRvcjogVmlzaXRvclJlZmVyZW5jZSB8IHVuZGVmaW5lZDtcbiAgc2Vzc2lvbjogU2Vzc2lvblJlZmVyZW5jZSB8IHVuZGVmaW5lZDtcbiAgc2VjdGlvbjogU2VjdGlvblJlZmVyZW5jZSB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IHR5cGUgU2l0ZVN0YXRlUmVwb3NpdG9yeVJlc3VsdCA9IFNpdGVTdGF0ZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcjtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yKFxuICByZXN1bHQ6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQsXG4pOiByZXN1bHQgaXMgU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yIHtcbiAgcmV0dXJuIHR5cGVvZiByZXN1bHQgPT0gXCJudW1iZXJcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaXRlU3RhdGVSZXBvc2l0b3J5IHtcbiAgZ2V0U2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQ7XG4gIHNldFNpdGVTdGF0ZShzdGF0ZTogU2l0ZVN0YXRlKTogU2l0ZVN0YXRlUmVwb3NpdG9yeVJlc3VsdDtcbiAgY2xlYXJTaXRlU3RhdGUoKTogU2l0ZVN0YXRlUmVwb3NpdG9yeVJlc3VsdDtcbn1cbiIsImltcG9ydCB7IFRvUHVibGlzaEV2ZW50IH0gZnJvbSBcIi4vUHVibGlzaEV2ZW50XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRQdWJsaXNoU3VjY2VzcyB7XG4gIGNvdW50OiBudW1iZXI7XG59XG5cbmV4cG9ydCBlbnVtIEV2ZW50UHVibGlzaEVycm9yIHtcbiAgQmFkUmVxdWVzdCxcbiAgSW50ZXJuYWxTZXJ2ZXJFcnJvcixcbiAgVGltZW91dCxcbn1cblxuZXhwb3J0IHR5cGUgRXZlbnRQdWJsaXNoUmVzdWx0ID0gRXZlbnRQdWJsaXNoU3VjY2VzcyB8IEV2ZW50UHVibGlzaEVycm9yO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UHVibGlzaGVyIHtcbiAgcHVibGlzaChldmVudHM6IFRvUHVibGlzaEV2ZW50W10pOiBQcm9taXNlPEV2ZW50UHVibGlzaFJlc3VsdD47XG59XG4iLCJpbXBvcnQgdmFsaWRhdGUgZnJvbSAnLi92YWxpZGF0ZS5qcyc7XG5mdW5jdGlvbiB2ZXJzaW9uKHV1aWQpIHtcbiAgICBpZiAoIXZhbGlkYXRlKHV1aWQpKSB7XG4gICAgICAgIHRocm93IFR5cGVFcnJvcignSW52YWxpZCBVVUlEJyk7XG4gICAgfVxuICAgIHJldHVybiBwYXJzZUludCh1dWlkLnNsaWNlKDE0LCAxNSksIDE2KTtcbn1cbmV4cG9ydCBkZWZhdWx0IHZlcnNpb247XG4iLCJpbXBvcnQge1xuICBFdmVudFR5cGUsXG4gIGlzRXZlbnRSZWZlcmVuY2UsXG4gIFNlY3Rpb25SZWZlcmVuY2UsXG4gIFNlc3Npb25SZWZlcmVuY2UsXG4gIFZpc2l0b3JSZWZlcmVuY2UsXG59IGZyb20gXCIuLi9FdmVudC9FdmVudFwiO1xuaW1wb3J0IHtcbiAgU2l0ZVN0YXRlLFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5LFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IsXG4gIFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQsXG59IGZyb20gXCIuL1NpdGVTdGF0ZVwiO1xuXG5jb25zdCBQUkVGSVg6IHN0cmluZyA9IFwiU0FMVVNcIjtcbmNvbnN0IFZJU0lUT1JfU1VGRklYOiBzdHJpbmcgPSBcIlZJU0lUT1JcIjtcbmNvbnN0IFNFU1NJT05fU1VGRklYOiBzdHJpbmcgPSBcIlNFU1NJT05cIjtcblxuZXhwb3J0IGNsYXNzIFdlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5IGltcGxlbWVudHMgU2l0ZVN0YXRlUmVwb3NpdG9yeSB7XG4gIHByaXZhdGUgYXBpX2tleTogc3RyaW5nO1xuICBwcml2YXRlIHNlY3Rpb246IFNlY3Rpb25SZWZlcmVuY2UgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3IoYXBpX2tleTogc3RyaW5nKSB7XG4gICAgaWYgKGFwaV9rZXkudHJpbSgpLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJpbnZhbGlkIGVtcHR5IGFwaV9rZXlcIik7XG4gICAgfVxuICAgIHRoaXMuYXBpX2tleSA9IGFwaV9rZXk7XG4gICAgdGhpcy5zZWN0aW9uID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgY2xlYXJTaXRlU3RhdGUoKTogU2l0ZVN0YXRlUmVwb3NpdG9yeVJlc3VsdCB7XG4gICAgdGhpcy5jbGVhclNlY3Rpb24oKTtcbiAgICB0aGlzLmNsZWFyU2Vzc2lvbigpO1xuICAgIHRoaXMuY2xlYXJWaXNpdG9yKCk7XG4gICAgcmV0dXJuIHsgdmlzaXRvcjogdW5kZWZpbmVkLCBzZXNzaW9uOiB1bmRlZmluZWQsIHNlY3Rpb246IHVuZGVmaW5lZCB9O1xuICB9XG5cbiAgZ2V0U2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQge1xuICAgIGNvbnN0IHZpc2l0b3JSZXN1bHQgPSB0aGlzLmdldFZpc2l0b3IoKTtcbiAgICBsZXQgdmlzaXRvcjogVmlzaXRvclJlZmVyZW5jZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICBpZiAodHlwZW9mIHZpc2l0b3JSZXN1bHQgPT0gXCJudW1iZXJcIikge1xuICAgICAgcmV0dXJuIHZpc2l0b3JSZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpc2l0b3IgPSB2aXNpdG9yUmVzdWx0O1xuICAgIH1cblxuICAgIGNvbnN0IHNlc3Npb25SZXN1bHQgPSB0aGlzLmdldFNlc3Npb24oKTtcbiAgICBsZXQgc2Vzc2lvbjogU2Vzc2lvblJlZmVyZW5jZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICBpZiAodHlwZW9mIHNlc3Npb25SZXN1bHQgPT0gXCJudW1iZXJcIikge1xuICAgICAgaWYgKFxuICAgICAgICBzZXNzaW9uUmVzdWx0ID09IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5NYWxmb3JtZWREYXRhIHx8XG4gICAgICAgIHNlc3Npb25SZXN1bHQgPT0gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLkludGVybmFsRXJyb3JcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc2Vzc2lvblJlc3VsdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7IHZpc2l0b3IsIHNlc3Npb246IHVuZGVmaW5lZCwgc2VjdGlvbjogdW5kZWZpbmVkIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlc3Npb24gPSBzZXNzaW9uUmVzdWx0O1xuICAgIH1cblxuICAgIGNvbnN0IHNlY3Rpb25SZXN1bHQgPSB0aGlzLmdldFNlY3Rpb24oKTtcbiAgICBsZXQgc2VjdGlvbjogU2VjdGlvblJlZmVyZW5jZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICBpZiAodHlwZW9mIHNlY3Rpb25SZXN1bHQgPT0gXCJudW1iZXJcIikge1xuICAgICAgaWYgKFxuICAgICAgICBzZWN0aW9uUmVzdWx0ID09IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5NYWxmb3JtZWREYXRhIHx8XG4gICAgICAgIHNlY3Rpb25SZXN1bHQgPT0gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLkludGVybmFsRXJyb3JcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc2VjdGlvblJlc3VsdDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2VjdGlvbiA9IHNlY3Rpb25SZXN1bHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZpc2l0b3IsXG4gICAgICBzZXNzaW9uLFxuICAgICAgc2VjdGlvbixcbiAgICB9O1xuICB9XG5cbiAgc2V0U2l0ZVN0YXRlKHN0YXRlOiBTaXRlU3RhdGUpOiBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0IHtcbiAgICBjb25zdCBzZWN0aW9uID0gc3RhdGUuc2VjdGlvbjtcbiAgICBpZiAodHlwZW9mIHNlY3Rpb24gPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhpcy5jbGVhclNlY3Rpb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2VjdGlvblJlc3VsdCA9IHRoaXMuc2V0U2VjdGlvbihzZWN0aW9uKTtcbiAgICAgIGlmICghaXNFdmVudFJlZmVyZW5jZShzZWN0aW9uUmVzdWx0KSkge1xuICAgICAgICByZXR1cm4gc2VjdGlvblJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgc2Vzc2lvbiA9IHN0YXRlLnNlc3Npb247XG4gICAgaWYgKHR5cGVvZiBzZXNzaW9uID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuY2xlYXJTZXNzaW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNlc3Npb25SZXN1bHQgPSB0aGlzLnNldFNlc3Npb24oc2Vzc2lvbik7XG4gICAgICBpZiAoIWlzRXZlbnRSZWZlcmVuY2Uoc2Vzc2lvblJlc3VsdCkpIHtcbiAgICAgICAgcmV0dXJuIHNlc3Npb25SZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHZpc2l0b3IgPSBzdGF0ZS52aXNpdG9yO1xuICAgIGlmICh0eXBlb2YgdmlzaXRvciA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aGlzLmNsZWFyVmlzaXRvcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB2aXNpdG9yUmVzdWx0ID0gdGhpcy5zZXRWaXNpdG9yKHZpc2l0b3IpO1xuICAgICAgaWYgKCFpc0V2ZW50UmVmZXJlbmNlKHZpc2l0b3JSZXN1bHQpKSB7XG4gICAgICAgIHJldHVybiB2aXNpdG9yUmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICBwcml2YXRlIGdldFZpc2l0b3IoKTogVmlzaXRvclJlZmVyZW5jZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gICAgY29uc3Qga2V5OiBzdHJpbmcgPSBbUFJFRklYLCBWSVNJVE9SX1NVRkZJWCwgdGhpcy5hcGlfa2V5XS5qb2luKFwiX1wiKTtcbiAgICBjb25zdCBpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgaWYgKGlkID09IG51bGwpIHtcbiAgICAgIHJldHVybiBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTm90Rm91bmQ7XG4gICAgfVxuICAgIGNvbnN0IHZpc2l0b3IgPSB7IGlkLCBldmVudF90eXBlOiBFdmVudFR5cGUuVmlzaXRvciB9O1xuICAgIGlmICghaXNFdmVudFJlZmVyZW5jZSh2aXNpdG9yKSkge1xuICAgICAgcmV0dXJuIFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5NYWxmb3JtZWREYXRhO1xuICAgIH1cblxuICAgIHJldHVybiB2aXNpdG9yIGFzIFZpc2l0b3JSZWZlcmVuY2U7XG4gIH1cblxuICBwcml2YXRlIHNldFZpc2l0b3IoXG4gICAgdmlzaXRvcjogVmlzaXRvclJlZmVyZW5jZSxcbiAgKTogVmlzaXRvclJlZmVyZW5jZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gICAgY29uc3Qga2V5OiBzdHJpbmcgPSBbUFJFRklYLCBWSVNJVE9SX1NVRkZJWCwgdGhpcy5hcGlfa2V5XS5qb2luKFwiX1wiKTtcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2aXNpdG9yLmlkKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLkludGVybmFsRXJyb3I7XG4gICAgfVxuICAgIHJldHVybiB2aXNpdG9yO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhclZpc2l0b3IoKTogdm9pZCB7XG4gICAgY29uc3Qga2V5OiBzdHJpbmcgPSBbUFJFRklYLCBWSVNJVE9SX1NVRkZJWCwgdGhpcy5hcGlfa2V5XS5qb2luKFwiX1wiKTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXNzaW9uKCk6IFNlc3Npb25SZWZlcmVuY2UgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3Ige1xuICAgIGNvbnN0IGtleTogc3RyaW5nID0gW1BSRUZJWCwgU0VTU0lPTl9TVUZGSVgsIHRoaXMuYXBpX2tleV0uam9pbihcIl9cIik7XG4gICAgY29uc3QgaWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgaWYgKGlkID09IG51bGwpIHtcbiAgICAgIHJldHVybiBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTm90Rm91bmQ7XG4gICAgfVxuICAgIGNvbnN0IHNlc3Npb24gPSB7IGlkLCBldmVudF90eXBlOiBFdmVudFR5cGUuU2Vzc2lvbiB9O1xuICAgIGlmICghaXNFdmVudFJlZmVyZW5jZShzZXNzaW9uKSkge1xuICAgICAgcmV0dXJuIFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5NYWxmb3JtZWREYXRhO1xuICAgIH1cblxuICAgIHJldHVybiBzZXNzaW9uIGFzIFNlc3Npb25SZWZlcmVuY2U7XG4gIH1cblxuICBwcml2YXRlIHNldFNlc3Npb24oXG4gICAgc2Vzc2lvbjogU2Vzc2lvblJlZmVyZW5jZSxcbiAgKTogU2Vzc2lvblJlZmVyZW5jZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gICAgY29uc3Qga2V5OiBzdHJpbmcgPSBbUFJFRklYLCBTRVNTSU9OX1NVRkZJWCwgdGhpcy5hcGlfa2V5XS5qb2luKFwiX1wiKTtcbiAgICB0cnkge1xuICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIHNlc3Npb24uaWQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuSW50ZXJuYWxFcnJvcjtcbiAgICB9XG4gICAgcmV0dXJuIHNlc3Npb247XG4gIH1cblxuICBwcml2YXRlIGNsZWFyU2Vzc2lvbigpOiB2b2lkIHtcbiAgICBjb25zdCBrZXk6IHN0cmluZyA9IFtQUkVGSVgsIFNFU1NJT05fU1VGRklYLCB0aGlzLmFwaV9rZXldLmpvaW4oXCJfXCIpO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlY3Rpb24oKTogU2VjdGlvblJlZmVyZW5jZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gICAgcmV0dXJuIHRoaXMuc2VjdGlvbiA9PSB1bmRlZmluZWRcbiAgICAgID8gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLk5vdEZvdW5kXG4gICAgICA6IHRoaXMuc2VjdGlvbjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0U2VjdGlvbihcbiAgICBzZWN0aW9uOiBTZWN0aW9uUmVmZXJlbmNlLFxuICApOiBTZWN0aW9uUmVmZXJlbmNlIHwgU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yIHtcbiAgICB0aGlzLnNlY3Rpb24gPSBzZWN0aW9uO1xuICAgIHJldHVybiB0aGlzLnNlY3Rpb247XG4gIH1cblxuICBwcml2YXRlIGNsZWFyU2VjdGlvbigpOiB2b2lkIHtcbiAgICB0aGlzLnNlY3Rpb24gPSB1bmRlZmluZWQ7XG4gIH1cbn1cbiIsImltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gXCIuL0V2ZW50TWFuYWdlci9FdmVudE1hbmFnZXJcIjtcbmltcG9ydCB7IEh0dHBFdmVudFB1Ymxpc2hlciB9IGZyb20gXCIuL0V2ZW50UHVibGlzaGVyL0h0dHBFdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgV2ViU3RvcmFnZVNpdGVTdGF0ZVJlcG9zaXRvcnkgfSBmcm9tIFwiLi9TaXRlU3RhdGUvV2ViU3RvcmFnZVNpdGVTdGF0ZVJlcG9zaXRvcnlcIjtcblxubGV0IGFwaV9rZXkgPSBcImFiYy14eXpcIjtcbmxldCBzaXRlU3RhdGVSZXBvc2l0b3J5ID0gbmV3IFdlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5KGFwaV9rZXkpO1xubGV0IHB1Ymxpc2hlciA9IG5ldyBIdHRwRXZlbnRQdWJsaXNoZXIoYXBpX2tleSwgXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIik7XG5sZXQgZXZlbnRNYW5hZ2VyID0gbmV3IEV2ZW50TWFuYWdlcihwdWJsaXNoZXIsIHNpdGVTdGF0ZVJlcG9zaXRvcnkpO1xuXG5ldmVudE1hbmFnZXIucmVnaXN0ZXJTZWN0aW9uKCk7XG4iLCJpbXBvcnQgeyBUb1B1Ymxpc2hFdmVudCB9IGZyb20gXCIuL1B1Ymxpc2hFdmVudFwiO1xuaW1wb3J0IHtcbiAgRXZlbnRQdWJsaXNoZXIsXG4gIEV2ZW50UHVibGlzaEVycm9yLFxuICBFdmVudFB1Ymxpc2hSZXN1bHQsXG59IGZyb20gXCIuL0V2ZW50UHVibGlzaGVyXCI7XG5cbmV4cG9ydCBjbGFzcyBIdHRwRXZlbnRQdWJsaXNoZXIgaW1wbGVtZW50cyBFdmVudFB1Ymxpc2hlciB7XG4gIHByaXZhdGUgYXBpX2tleTogc3RyaW5nO1xuICBwcml2YXRlIGVuZHBvaW50OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoYXBpX2tleTogc3RyaW5nLCBob3N0OiBzdHJpbmcpIHtcbiAgICB0aGlzLmFwaV9rZXkgPSBhcGlfa2V5O1xuICAgIHRoaXMuZW5kcG9pbnQgPSBob3N0ICsgXCIvbXVsdGlcIjtcbiAgfVxuXG4gIGFzeW5jIHB1Ymxpc2goZXZlbnRzOiBUb1B1Ymxpc2hFdmVudFtdKTogUHJvbWlzZTxFdmVudFB1Ymxpc2hSZXN1bHQ+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMuY3JlYXRlUmVxdWVzdChldmVudHMpKTtcblxuICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgcmV0dXJuIHsgY291bnQ6IGV2ZW50cy5sZW5ndGggfTtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDUwMCkge1xuICAgICAgcmV0dXJuIEV2ZW50UHVibGlzaEVycm9yLkludGVybmFsU2VydmVyRXJyb3I7XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSA0MDApIHtcbiAgICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5CYWRSZXF1ZXN0O1xuICAgIH1cblxuICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5UaW1lb3V0O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZXF1ZXN0KGV2ZW50czogVG9QdWJsaXNoRXZlbnRbXSk6IFJlcXVlc3Qge1xuICAgIHJldHVybiBuZXcgUmVxdWVzdCh0aGlzLmVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgbW9kZTogXCJjb3JzXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcImFwaS1rZXlcIjogdGhpcy5hcGlfa2V5LFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGV2ZW50cy5tYXAoKGUpID0+IGUudG9QdWJsaXNoRXZlbnQoKSkpLFxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQge1xuICBDbGljayxcbiAgU2VjdGlvbixcbiAgU2VjdGlvblJlZmVyZW5jZSxcbiAgU2Vzc2lvbixcbiAgU2Vzc2lvblJlZmVyZW5jZSxcbiAgVmlzaXRvcixcbiAgVmlzaXRvclJlZmVyZW5jZSxcbn0gZnJvbSBcIi4uL0V2ZW50L0V2ZW50XCI7XG5pbXBvcnQge1xuICBFdmVudFJlZ2lzdHJ5LFxuICBSZWdpc3RlckV2ZW50RXJyb3IsXG4gIFJlZ2lzdGVyRXZlbnRSZXN1bHQsXG59IGZyb20gXCIuLi9FdmVudC9FdmVudFJlZ2lzdHJ5XCI7XG5pbXBvcnQgeyBFdmVudFB1Ymxpc2hlciB9IGZyb20gXCIuLi9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgVG9QdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi4vRXZlbnRQdWJsaXNoZXIvUHVibGlzaEV2ZW50XCI7XG5pbXBvcnQge1xuICBpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcixcbiAgU2l0ZVN0YXRlLFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5LFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0LFxufSBmcm9tIFwiLi4vU2l0ZVN0YXRlL1NpdGVTdGF0ZVwiO1xuXG5leHBvcnQgY2xhc3MgRXZlbnRNYW5hZ2VyIGltcGxlbWVudHMgRXZlbnRSZWdpc3RyeSB7XG4gIHByaXZhdGUgcHVibGlzaGVyOiBFdmVudFB1Ymxpc2hlcjtcbiAgcHJpdmF0ZSBzaXRlU3RhdGVSZXBvc2l0b3J5OiBTaXRlU3RhdGVSZXBvc2l0b3J5O1xuICBwcml2YXRlIGV2ZW50UXVldWU6IFRvUHVibGlzaEV2ZW50W107XG4gIHByaXZhdGUgc2l0ZVN0YXRlV3JpdGVCdWZmZXI6IFNpdGVTdGF0ZSB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaXNoZXI6IEV2ZW50UHVibGlzaGVyLFxuICAgIHNpdGVTdGF0ZVJlcG9zaXRvcnk6IFNpdGVTdGF0ZVJlcG9zaXRvcnksXG4gICkge1xuICAgIHRoaXMucHVibGlzaGVyID0gcHVibGlzaGVyO1xuICAgIHRoaXMuc2l0ZVN0YXRlUmVwb3NpdG9yeSA9IHNpdGVTdGF0ZVJlcG9zaXRvcnk7XG4gICAgdGhpcy5ldmVudFF1ZXVlID0gW107XG4gICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZSB7XG4gICAgaWYgKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlcjtcbiAgICB9XG4gICAgY29uc3QgcmVwb1ZhbHVlID0gdGhpcy5zaXRlU3RhdGVSZXBvc2l0b3J5LmdldFNpdGVTdGF0ZSgpO1xuICAgIGlmIChpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcihyZXBvVmFsdWUpKSB7XG4gICAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgICB2aXNpdG9yOiB1bmRlZmluZWQsXG4gICAgICAgIHNlc3Npb246IHVuZGVmaW5lZCxcbiAgICAgICAgc2VjdGlvbjogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHJlcG9WYWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXI7XG4gIH1cblxuICBwcml2YXRlIHdyaXRlU2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQge1xuICAgIGxldCByZXN1bHQ6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQ7XG4gICAgaWYgKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXN1bHQgPSB0aGlzLnNpdGVTdGF0ZVJlcG9zaXRvcnkuc2V0U2l0ZVN0YXRlKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSB0aGlzLnNpdGVTdGF0ZVJlcG9zaXRvcnkuY2xlYXJTaXRlU3RhdGUoKTtcbiAgICB9XG4gICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaXNpdG9yUmVmZXJlbmNlKHZpc2l0b3I6IFZpc2l0b3JSZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcixcbiAgICAgIHNlc3Npb246IHVuZGVmaW5lZCxcbiAgICAgIHNlY3Rpb246IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZXNzaW9uUmVmZXJlbmNlKHNlc3Npb246IFNlc3Npb25SZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcjogdGhpcy5nZXRTaXRlU3RhdGUoKS52aXNpdG9yLFxuICAgICAgc2Vzc2lvbixcbiAgICAgIHNlY3Rpb246IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZWN0aW9uUmVmZXJlbmNlKHNlY3Rpb246IFNlY3Rpb25SZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcjogdGhpcy5nZXRTaXRlU3RhdGUoKS52aXNpdG9yLFxuICAgICAgc2Vzc2lvbjogdGhpcy5nZXRTaXRlU3RhdGUoKS5zZXNzaW9uLFxuICAgICAgc2VjdGlvbixcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBmbHVzaCgpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICBjb25zdCBzaXRlU3RhdGVTZXRSZXN1bHQgPSB0aGlzLndyaXRlU2l0ZVN0YXRlKCk7XG4gICAgaWYgKGlzU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yKHNpdGVTdGF0ZVNldFJlc3VsdCkpIHtcbiAgICAgIHJldHVybiBSZWdpc3RlckV2ZW50RXJyb3IuSW50ZXJuYWxFcnJvcjtcbiAgICB9XG4gICAgdGhpcy5wdWJsaXNoZXIucHVibGlzaCh0aGlzLmV2ZW50UXVldWUpO1xuICAgIHRoaXMuZXZlbnRRdWV1ZSA9IFtdO1xuICB9XG5cbiAgcmVnaXN0ZXJWaXNpdG9yKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlVmlzaXRvcigpO1xuICAgIHJldHVybiB0aGlzLmZsdXNoKCk7XG4gIH1cblxuICBkZXJlZ2lzdGVyVmlzaXRvcigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLnNldFZpc2l0b3JSZWZlcmVuY2UodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVWaXNpdG9yKCk6IFZpc2l0b3Ige1xuICAgIGNvbnN0IHZpc2l0b3IgPSBuZXcgVmlzaXRvcigpO1xuICAgIHRoaXMuc2V0VmlzaXRvclJlZmVyZW5jZSh2aXNpdG9yKTtcbiAgICB0aGlzLmV2ZW50UXVldWUucHVzaCh2aXNpdG9yKTtcbiAgICByZXR1cm4gdmlzaXRvcjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0T3JDcmVhdGVWaXNpdG9yUmVmZXJlbmNlKCk6IFZpc2l0b3JSZWZlcmVuY2Uge1xuICAgIGNvbnN0IHNpdGVTdGF0ZVZpc2l0b3IgPSB0aGlzLmdldFNpdGVTdGF0ZSgpLnZpc2l0b3I7XG4gICAgaWYgKHNpdGVTdGF0ZVZpc2l0b3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gc2l0ZVN0YXRlVmlzaXRvcjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVmlzaXRvcigpO1xuICB9XG5cbiAgcmVnaXN0ZXJTZXNzaW9uKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlU2Vzc2lvbigpO1xuICAgIHJldHVybiB0aGlzLmZsdXNoKCk7XG4gIH1cblxuICBkZXJlZ2lzdGVyU2Vzc2lvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLnNldFNlc3Npb25SZWZlcmVuY2UodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTZXNzaW9uKCk6IFNlc3Npb24ge1xuICAgIGNvbnN0IHZpc2l0b3IgPSB0aGlzLmdldE9yQ3JlYXRlVmlzaXRvclJlZmVyZW5jZSgpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBuZXcgU2Vzc2lvbih2aXNpdG9yKTtcbiAgICB0aGlzLnNldFNlc3Npb25SZWZlcmVuY2Uoc2Vzc2lvbik7XG4gICAgdGhpcy5ldmVudFF1ZXVlLnB1c2goc2Vzc2lvbik7XG4gICAgcmV0dXJuIHNlc3Npb247XG4gIH1cblxuICBwcml2YXRlIGdldE9yQ3JlYXRlU2Vzc2lvblJlZmVyZW5jZSgpOiBTZXNzaW9uUmVmZXJlbmNlIHtcbiAgICBjb25zdCBzaXRlU3RhdGVTZXNzaW9uID0gdGhpcy5nZXRTaXRlU3RhdGUoKS5zZXNzaW9uO1xuICAgIGlmIChzaXRlU3RhdGVTZXNzaW9uICE9IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHNpdGVTdGF0ZVNlc3Npb247XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIHJlZ2lzdGVyU2VjdGlvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLmNyZWF0ZVNlY3Rpb24oKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgZGVyZWdpc3RlclNlY3Rpb24oKTogUmVnaXN0ZXJFdmVudFJlc3VsdCB7XG4gICAgdGhpcy5zZXRTZWN0aW9uUmVmZXJlbmNlKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIHRoaXMuZmx1c2goKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2VjdGlvbigpOiBTZWN0aW9uIHtcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5nZXRPckNyZWF0ZVNlc3Npb25SZWZlcmVuY2UoKTtcbiAgICBjb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oc2Vzc2lvbik7XG4gICAgdGhpcy5zZXRTZWN0aW9uUmVmZXJlbmNlKHNlY3Rpb24pO1xuICAgIHRoaXMuZXZlbnRRdWV1ZS5wdXNoKHNlY3Rpb24pO1xuICAgIHJldHVybiBzZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRPckNyZWF0ZVNlY3Rpb25SZWZlcmVuY2UoKTogU2VjdGlvblJlZmVyZW5jZSB7XG4gICAgY29uc3Qgc2l0ZVN0YXRlU2VjdGlvbiA9IHRoaXMuZ2V0U2l0ZVN0YXRlKCkuc2VjdGlvbjtcbiAgICBpZiAoc2l0ZVN0YXRlU2VjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBzaXRlU3RhdGVTZWN0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVTZWN0aW9uKCk7XG4gIH1cblxuICByZWdpc3RlckNsaWNrKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlQ2xpY2soKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDbGljaygpOiBDbGljayB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IHRoaXMuZ2V0T3JDcmVhdGVTZWN0aW9uUmVmZXJlbmNlKCk7XG4gICAgY29uc3QgY2xpY2sgPSBuZXcgQ2xpY2soc2VjdGlvbik7XG4gICAgdGhpcy5ldmVudFF1ZXVlLnB1c2goY2xpY2spO1xuICAgIHJldHVybiBjbGljaztcbiAgfVxufVxuIl0sIm5hbWVzIjpbInV1aWQiLCJ0ZXN0IiwiZ2V0UmFuZG9tVmFsdWVzIiwicm5kczgiLCJVaW50OEFycmF5Iiwicm5nIiwiY3J5cHRvIiwiRXJyb3IiLCJiaW5kIiwiYnl0ZVRvSGV4IiwiaSIsInB1c2giLCJ0b1N0cmluZyIsInNsaWNlIiwiX3N0YXRlIiwidjdCeXRlcyIsInJuZHMiLCJtc2VjcyIsInNlcSIsImJ1ZiIsIm9mZnNldCIsImxlbmd0aCIsIlJhbmdlRXJyb3IiLCJEYXRlIiwibm93Iiwib3B0aW9ucyIsImJ5dGVzIiwicmFuZG9tIiwic3RhdGUiLCJ1cGRhdGVWN1N0YXRlIiwiYXJyIiwidG9Mb3dlckNhc2UiLCJ1bnNhZmVTdHJpbmdpZnkiLCJFdmVudFR5cGUiLCJSZWdpc3RlckV2ZW50RXJyb3IiLCJTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IiLCJFdmVudFB1Ymxpc2hFcnJvciIsImlzRXZlbnRSZWZlcmVuY2UiLCJ2YWx1ZSIsImV2ZW50X3R5cGUiLCJpZCIsIlR5cGVFcnJvciIsInBhcnNlSW50IiwiVmlzaXRvciIsImNvbnN0cnVjdG9yIiwidGhpcyIsInRvUHVibGlzaEV2ZW50IiwidCIsImEiLCJ1bmRlZmluZWQiLCJTZXNzaW9uIiwicGFyZW50IiwiYXR0cnMiLCJTZWN0aW9uIiwiQ2xpY2siLCJpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciIsInJlc3VsdCIsIlBSRUZJWCIsIlZJU0lUT1JfU1VGRklYIiwiU0VTU0lPTl9TVUZGSVgiLCJhcGlfa2V5Iiwic2l0ZVN0YXRlUmVwb3NpdG9yeSIsInRyaW0iLCJzZWN0aW9uIiwiY2xlYXJTaXRlU3RhdGUiLCJjbGVhclNlY3Rpb24iLCJjbGVhclNlc3Npb24iLCJjbGVhclZpc2l0b3IiLCJ2aXNpdG9yIiwic2Vzc2lvbiIsImdldFNpdGVTdGF0ZSIsInZpc2l0b3JSZXN1bHQiLCJnZXRWaXNpdG9yIiwic2Vzc2lvblJlc3VsdCIsImdldFNlc3Npb24iLCJNYWxmb3JtZWREYXRhIiwiSW50ZXJuYWxFcnJvciIsInNlY3Rpb25SZXN1bHQiLCJnZXRTZWN0aW9uIiwic2V0U2l0ZVN0YXRlIiwic2V0U2VjdGlvbiIsInNldFNlc3Npb24iLCJzZXRWaXNpdG9yIiwia2V5Iiwiam9pbiIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJOb3RGb3VuZCIsInNldEl0ZW0iLCJlIiwicmVtb3ZlSXRlbSIsInNlc3Npb25TdG9yYWdlIiwicHVibGlzaGVyIiwiaG9zdCIsImVuZHBvaW50IiwicHVibGlzaCIsImV2ZW50cyIsInJlc3BvbnNlIiwiZmV0Y2giLCJjcmVhdGVSZXF1ZXN0Iiwib2siLCJjb3VudCIsInN0YXR1cyIsIkludGVybmFsU2VydmVyRXJyb3IiLCJCYWRSZXF1ZXN0IiwiVGltZW91dCIsIlJlcXVlc3QiLCJtZXRob2QiLCJtb2RlIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibWFwIiwiZXZlbnRNYW5hZ2VyIiwiZXZlbnRRdWV1ZSIsInNpdGVTdGF0ZVdyaXRlQnVmZmVyIiwicmVwb1ZhbHVlIiwid3JpdGVTaXRlU3RhdGUiLCJzZXRWaXNpdG9yUmVmZXJlbmNlIiwic2V0U2Vzc2lvblJlZmVyZW5jZSIsInNldFNlY3Rpb25SZWZlcmVuY2UiLCJmbHVzaCIsInJlZ2lzdGVyVmlzaXRvciIsImNyZWF0ZVZpc2l0b3IiLCJkZXJlZ2lzdGVyVmlzaXRvciIsImdldE9yQ3JlYXRlVmlzaXRvclJlZmVyZW5jZSIsInNpdGVTdGF0ZVZpc2l0b3IiLCJyZWdpc3RlclNlc3Npb24iLCJjcmVhdGVTZXNzaW9uIiwiZGVyZWdpc3RlclNlc3Npb24iLCJnZXRPckNyZWF0ZVNlc3Npb25SZWZlcmVuY2UiLCJzaXRlU3RhdGVTZXNzaW9uIiwicmVnaXN0ZXJTZWN0aW9uIiwiY3JlYXRlU2VjdGlvbiIsImRlcmVnaXN0ZXJTZWN0aW9uIiwiZ2V0T3JDcmVhdGVTZWN0aW9uUmVmZXJlbmNlIiwic2l0ZVN0YXRlU2VjdGlvbiIsInJlZ2lzdGVyQ2xpY2siLCJjcmVhdGVDbGljayIsImNsaWNrIl0sInNvdXJjZVJvb3QiOiIifQ==