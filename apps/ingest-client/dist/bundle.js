(()=>{"use strict";const t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,e=function(e){return"string"==typeof e&&t.test(e)};let i;const s=new Uint8Array(16);function r(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(s)}const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));const o={};function c(t,e,i,s,r=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(s){if(r<0||r+16>s.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`)}else s=new Uint8Array(16),r=0;return e??=Date.now(),i??=127*t[6]<<24|t[7]<<16|t[8]<<8|t[9],s[r++]=e/1099511627776&255,s[r++]=e/4294967296&255,s[r++]=e/16777216&255,s[r++]=e/65536&255,s[r++]=e/256&255,s[r++]=255&e,s[r++]=112|i>>>28&15,s[r++]=i>>>20&255,s[r++]=128|i>>>14&63,s[r++]=i>>>6&255,s[r++]=i<<2&255|3&t[10],s[r++]=t[11],s[r++]=t[12],s[r++]=t[13],s[r++]=t[14],s[r++]=t[15],s}const a=function(t,e,i){let s;if(t)s=c(t.random??t.rng?.()??r(),t.msecs,t.seq,e,i);else{const t=Date.now(),n=r();!function(t,e,i){t.msecs??=-1/0,t.seq??=0,e>t.msecs?(t.seq=i[6]<<23|i[7]<<16|i[8]<<8|i[9],t.msecs=e):(t.seq=t.seq+1|0,0===t.seq&&t.msecs++)}(o,t,n),s=c(n,o.msecs,o.seq,e,i)}return e?s:function(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}(s)};var u,h,f,l;function S(t){return!(void 0===t||"number"!=typeof t.event_type||"string"!=typeof t.id||!e(t.id)||7!=function(t){if(!e(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}(t.id))}!function(t){t[t.Visitor=1]="Visitor",t[t.Session=2]="Session",t[t.Section=3]="Section",t[t.Click=4]="Click"}(u||(u={}));class d{constructor(){this.event_type=u.Visitor,this.id=a()}toPublishEvent(){return{t:this.event_type,i:this.id,a:void 0}}}class p{constructor(t){this.event_type=u.Session,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}class v{constructor(t){this.event_type=u.Section,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}class y{constructor(t){this.event_type=u.Click,this.id=a(),this.parent=t}toPublishEvent(){const t={parent:this.parent.id};return{t:this.event_type,i:this.id,a:t}}}function g(t){return"number"==typeof t}!function(t){t[t.BadRequestError=0]="BadRequestError",t[t.ConfigurationError=1]="ConfigurationError",t[t.InternalError=2]="InternalError"}(h||(h={})),function(t){t[t.InternalError=0]="InternalError",t[t.MalformedData=1]="MalformedData",t[t.NotFound=2]="NotFound"}(f||(f={})),function(t){t[t.BadRequest=0]="BadRequest",t[t.InternalServerError=1]="InternalServerError",t[t.Timeout=2]="Timeout"}(l||(l={}));const m="SALUS",R="VISITOR",w="SESSION";let E="abc-xyz",_=new class{constructor(t){if(t.trim().length<1)throw new TypeError("invalid empty api_key");this.api_key=t,this.section=void 0}clearSiteState(){return this.clearSection(),this.clearSession(),this.clearVisitor(),{visitor:void 0,session:void 0,section:void 0}}getSiteState(){const t=this.getVisitor();let e;if("number"==typeof t)return t;e=t;const i=this.getSession();let s;if("number"==typeof i)return i==f.MalformedData||i==f.InternalError?i:{visitor:e,session:void 0,section:void 0};s=i;const r=this.getSection();let n;if("number"==typeof r){if(r==f.MalformedData||r==f.InternalError)return r}else n=r;return{visitor:e,session:s,section:n}}setSiteState(t){const e=t.section;if(void 0===e)this.clearSection();else{const t=this.setSection(e);if(!S(t))return t}const i=t.session;if(void 0===i)this.clearSession();else{const t=this.setSession(i);if(!S(t))return t}const s=t.visitor;if(void 0===s)this.clearVisitor();else{const t=this.setVisitor(s);if(!S(t))return t}return t}getVisitor(){const t=[m,R,this.api_key].join("_"),e=localStorage.getItem(t);if(null==e)return f.NotFound;const i={id:e,event_type:u.Visitor};return S(i)?i:f.MalformedData}setVisitor(t){const e=[m,R,this.api_key].join("_");try{localStorage.setItem(e,t.id)}catch(t){return f.InternalError}return t}clearVisitor(){const t=[m,R,this.api_key].join("_");localStorage.removeItem(t)}getSession(){const t=[m,w,this.api_key].join("_"),e=sessionStorage.getItem(t);if(null==e)return f.NotFound;const i={id:e,event_type:u.Session};return S(i)?i:f.MalformedData}setSession(t){const e=[m,w,this.api_key].join("_");try{sessionStorage.setItem(e,t.id)}catch(t){return f.InternalError}return t}clearSession(){const t=[m,w,this.api_key].join("_");localStorage.removeItem(t)}getSection(){return null==this.section?f.NotFound:this.section}setSection(t){return this.section=t,this.section}clearSection(){this.section=void 0}}(E),I=new class{constructor(t,e){this.api_key=t,this.endpoint=e+"/multi"}publish(t){return e=this,i=void 0,r=function*(){const e=yield fetch(this.createRequest(t));return e.ok?{count:t.length}:500==e.status?l.InternalServerError:400==e.status?l.BadRequest:l.Timeout},new((s=void 0)||(s=Promise))((function(t,n){function o(t){try{a(r.next(t))}catch(t){n(t)}}function c(t){try{a(r.throw(t))}catch(t){n(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(o,c)}a((r=r.apply(e,i||[])).next())}));var e,i,s,r}createRequest(t){return new Request(this.endpoint,{method:"POST",mode:"cors",headers:{"content-type":"application/json","api-key":this.api_key},priority:"low",keepalive:!0,body:JSON.stringify(t.map((t=>t.toPublishEvent())))})}}(E,"http://localhost:3000"),V=new class{constructor(t,e){this.publisher=t,this.siteStateRepository=e,this.eventQueue=[],this.siteStateWriteBuffer=void 0}getSiteState(){if(null!=this.siteStateWriteBuffer)return this.siteStateWriteBuffer;const t=this.siteStateRepository.getSiteState();return g(t)?this.siteStateWriteBuffer={visitor:void 0,session:void 0,section:void 0}:this.siteStateWriteBuffer=t,this.siteStateWriteBuffer}writeSiteState(){let t;return t=null!=this.siteStateWriteBuffer?this.siteStateRepository.setSiteState(this.siteStateWriteBuffer):this.siteStateRepository.clearSiteState(),this.siteStateWriteBuffer=void 0,t}setVisitorReference(t){this.siteStateWriteBuffer={visitor:t,session:void 0,section:void 0}}setSessionReference(t){this.siteStateWriteBuffer={visitor:this.getSiteState().visitor,session:t,section:void 0}}setSectionReference(t){this.siteStateWriteBuffer={visitor:this.getSiteState().visitor,session:this.getSiteState().session,section:t}}flush(){if(g(this.writeSiteState()))return h.InternalError;this.publisher.publish(this.eventQueue),this.eventQueue=[]}registerVisitor(){return this.createVisitor(),this.flush()}deregisterVisitor(){return this.setVisitorReference(void 0),this.flush()}createVisitor(){const t=new d;return this.setVisitorReference(t),this.eventQueue.push(t),t}getOrCreateVisitorReference(){const t=this.getSiteState().visitor;return null!=t?t:this.createVisitor()}registerSession(){return this.createSession(),this.flush()}deregisterSession(){return this.setSessionReference(void 0),this.flush()}createSession(){const t=this.getOrCreateVisitorReference(),e=new p(t);return this.setSessionReference(e),this.eventQueue.push(e),e}getOrCreateSessionReference(){const t=this.getSiteState().session;return null!=t?t:this.createSession()}registerSection(){return this.createSection(),this.flush()}deregisterSection(){return this.setSectionReference(void 0),this.flush()}createSection(){const t=this.getOrCreateSessionReference(),e=new v(t);return this.setSectionReference(e),this.eventQueue.push(e),e}getOrCreateSectionReference(){const t=this.getSiteState().section;return null!=t?t:this.createSection()}registerClick(){return this.createClick(),this.flush()}createClick(){const t=this.getOrCreateSectionReference(),e=new y(t);return this.eventQueue.push(e),e}}(I,_);V.registerSection()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBVzFHLEtBQUtvRCxHQUNkQSxDQUNULENBRVEsMkJBQUEyRSxHQUNOLE1BQU1DLEVBQW1COUYsS0FBS3lCLGVBQWVQLFFBQzdDLE9BQXdCZCxNQUFwQjBGLEVBQ0tBLEVBRUY5RixLQUFLMkYsZUFDZCxDQUVBLGFBQUFJLEdBRUUsT0FEQS9GLEtBQUtnRyxjQUNFaEcsS0FBSytFLE9BQ2QsQ0FFUSxXQUFBaUIsR0FDTixNQUFNOUUsRUFBVWxCLEtBQUs2Riw4QkFDZkksRUFBUSxJQUFJeEYsRUFBTVMsR0FFeEIsT0FEQWxCLEtBQUt3RSxXQUFXMUcsS0FBS21JLEdBQ2RBLENBQ1QsR0ZwTGtDbEQsRUFBVy9CLEdBRS9DdUQsRUFBYW1CLGlCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvcmVnZXguanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvdmFsaWRhdGUuanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvcm5nLmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3N0cmluZ2lmeS5qcyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci92Ny5qcyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50L0V2ZW50LnRzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvRXZlbnQvRXZlbnRSZWdpc3RyeS50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL1NpdGVTdGF0ZS9TaXRlU3RhdGUudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlci50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci92ZXJzaW9uLmpzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvU2l0ZVN0YXRlL1dlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5LnRzIiwid2VicGFjazovL2luZ2VzdC1jbGllbnQvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9IdHRwRXZlbnRQdWJsaXNoZXIudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudE1hbmFnZXIvRXZlbnRNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IC9eKD86WzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtOF1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn18MDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwfGZmZmZmZmZmLWZmZmYtZmZmZi1mZmZmLWZmZmZmZmZmZmZmZikkL2k7XG4iLCJpbXBvcnQgUkVHRVggZnJvbSAnLi9yZWdleC5qcyc7XG5mdW5jdGlvbiB2YWxpZGF0ZSh1dWlkKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB1dWlkID09PSAnc3RyaW5nJyAmJiBSRUdFWC50ZXN0KHV1aWQpO1xufVxuZXhwb3J0IGRlZmF1bHQgdmFsaWRhdGU7XG4iLCJsZXQgZ2V0UmFuZG9tVmFsdWVzO1xuY29uc3Qgcm5kczggPSBuZXcgVWludDhBcnJheSgxNik7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBybmcoKSB7XG4gICAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjcnlwdG8gPT09ICd1bmRlZmluZWQnIHx8ICFjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0UmFuZG9tVmFsdWVzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcy5iaW5kKGNyeXB0byk7XG4gICAgfVxuICAgIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufVxuIiwiaW1wb3J0IHZhbGlkYXRlIGZyb20gJy4vdmFsaWRhdGUuanMnO1xuY29uc3QgYnl0ZVRvSGV4ID0gW107XG5mb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKSB7XG4gICAgYnl0ZVRvSGV4LnB1c2goKGkgKyAweDEwMCkudG9TdHJpbmcoMTYpLnNsaWNlKDEpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7XG4gICAgcmV0dXJuIChieXRlVG9IZXhbYXJyW29mZnNldCArIDBdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMV1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAyXV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDNdXSArXG4gICAgICAgICctJyArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNF1dICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA1XV0gK1xuICAgICAgICAnLScgK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDZdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgN11dICtcbiAgICAgICAgJy0nICtcbiAgICAgICAgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA4XV0gK1xuICAgICAgICBieXRlVG9IZXhbYXJyW29mZnNldCArIDldXSArXG4gICAgICAgICctJyArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTBdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTFdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTJdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTNdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTRdXSArXG4gICAgICAgIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTVdXSkudG9Mb3dlckNhc2UoKTtcbn1cbmZ1bmN0aW9uIHN0cmluZ2lmeShhcnIsIG9mZnNldCA9IDApIHtcbiAgICBjb25zdCB1dWlkID0gdW5zYWZlU3RyaW5naWZ5KGFyciwgb2Zmc2V0KTtcbiAgICBpZiAoIXZhbGlkYXRlKHV1aWQpKSB7XG4gICAgICAgIHRocm93IFR5cGVFcnJvcignU3RyaW5naWZpZWQgVVVJRCBpcyBpbnZhbGlkJyk7XG4gICAgfVxuICAgIHJldHVybiB1dWlkO1xufVxuZXhwb3J0IGRlZmF1bHQgc3RyaW5naWZ5O1xuIiwiaW1wb3J0IHJuZyBmcm9tICcuL3JuZy5qcyc7XG5pbXBvcnQgeyB1bnNhZmVTdHJpbmdpZnkgfSBmcm9tICcuL3N0cmluZ2lmeS5qcyc7XG5jb25zdCBfc3RhdGUgPSB7fTtcbmZ1bmN0aW9uIHY3KG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gICAgbGV0IGJ5dGVzO1xuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgIGJ5dGVzID0gdjdCeXRlcyhvcHRpb25zLnJhbmRvbSA/PyBvcHRpb25zLnJuZz8uKCkgPz8gcm5nKCksIG9wdGlvbnMubXNlY3MsIG9wdGlvbnMuc2VxLCBidWYsIG9mZnNldCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCBybmRzID0gcm5nKCk7XG4gICAgICAgIHVwZGF0ZVY3U3RhdGUoX3N0YXRlLCBub3csIHJuZHMpO1xuICAgICAgICBieXRlcyA9IHY3Qnl0ZXMocm5kcywgX3N0YXRlLm1zZWNzLCBfc3RhdGUuc2VxLCBidWYsIG9mZnNldCk7XG4gICAgfVxuICAgIHJldHVybiBidWYgPyBieXRlcyA6IHVuc2FmZVN0cmluZ2lmeShieXRlcyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlVjdTdGF0ZShzdGF0ZSwgbm93LCBybmRzKSB7XG4gICAgc3RhdGUubXNlY3MgPz89IC1JbmZpbml0eTtcbiAgICBzdGF0ZS5zZXEgPz89IDA7XG4gICAgaWYgKG5vdyA+IHN0YXRlLm1zZWNzKSB7XG4gICAgICAgIHN0YXRlLnNlcSA9IChybmRzWzZdIDw8IDIzKSB8IChybmRzWzddIDw8IDE2KSB8IChybmRzWzhdIDw8IDgpIHwgcm5kc1s5XTtcbiAgICAgICAgc3RhdGUubXNlY3MgPSBub3c7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzdGF0ZS5zZXEgPSAoc3RhdGUuc2VxICsgMSkgfCAwO1xuICAgICAgICBpZiAoc3RhdGUuc2VxID09PSAwKSB7XG4gICAgICAgICAgICBzdGF0ZS5tc2VjcysrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdGF0ZTtcbn1cbmZ1bmN0aW9uIHY3Qnl0ZXMocm5kcywgbXNlY3MsIHNlcSwgYnVmLCBvZmZzZXQgPSAwKSB7XG4gICAgaWYgKHJuZHMubGVuZ3RoIDwgMTYpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSYW5kb20gYnl0ZXMgbGVuZ3RoIG11c3QgYmUgPj0gMTYnKTtcbiAgICB9XG4gICAgaWYgKCFidWYpIHtcbiAgICAgICAgYnVmID0gbmV3IFVpbnQ4QXJyYXkoMTYpO1xuICAgICAgICBvZmZzZXQgPSAwO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKG9mZnNldCA8IDAgfHwgb2Zmc2V0ICsgMTYgPiBidWYubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgVVVJRCBieXRlIHJhbmdlICR7b2Zmc2V0fToke29mZnNldCArIDE1fSBpcyBvdXQgb2YgYnVmZmVyIGJvdW5kc2ApO1xuICAgICAgICB9XG4gICAgfVxuICAgIG1zZWNzID8/PSBEYXRlLm5vdygpO1xuICAgIHNlcSA/Pz0gKChybmRzWzZdICogMHg3ZikgPDwgMjQpIHwgKHJuZHNbN10gPDwgMTYpIHwgKHJuZHNbOF0gPDwgOCkgfCBybmRzWzldO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAobXNlY3MgLyAweDEwMDAwMDAwMDAwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IChtc2VjcyAvIDB4MTAwMDAwMDAwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IChtc2VjcyAvIDB4MTAwMDAwMCkgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAobXNlY3MgLyAweDEwMDAwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IChtc2VjcyAvIDB4MTAwKSAmIDB4ZmY7XG4gICAgYnVmW29mZnNldCsrXSA9IG1zZWNzICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gMHg3MCB8ICgoc2VxID4+PiAyOCkgJiAweDBmKTtcbiAgICBidWZbb2Zmc2V0KytdID0gKHNlcSA+Pj4gMjApICYgMHhmZjtcbiAgICBidWZbb2Zmc2V0KytdID0gMHg4MCB8ICgoc2VxID4+PiAxNCkgJiAweDNmKTtcbiAgICBidWZbb2Zmc2V0KytdID0gKHNlcSA+Pj4gNikgJiAweGZmO1xuICAgIGJ1ZltvZmZzZXQrK10gPSAoKHNlcSA8PCAyKSAmIDB4ZmYpIHwgKHJuZHNbMTBdICYgMHgwMyk7XG4gICAgYnVmW29mZnNldCsrXSA9IHJuZHNbMTFdO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBybmRzWzEyXTtcbiAgICBidWZbb2Zmc2V0KytdID0gcm5kc1sxM107XG4gICAgYnVmW29mZnNldCsrXSA9IHJuZHNbMTRdO1xuICAgIGJ1ZltvZmZzZXQrK10gPSBybmRzWzE1XTtcbiAgICByZXR1cm4gYnVmO1xufVxuZXhwb3J0IGRlZmF1bHQgdjc7XG4iLCJpbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi4vRXZlbnRQdWJsaXNoZXIvUHVibGlzaEV2ZW50XCI7XG5pbXBvcnQge1xuICB2NyBhcyB1dWlkdjcsXG4gIHZhbGlkYXRlIGFzIHV1aWRWYWxpZGF0ZSxcbiAgdmVyc2lvbiBhcyB1dWlkVmVyc2lvbixcbn0gZnJvbSBcInV1aWRcIjtcblxuZXhwb3J0IGNvbnN0IGVudW0gRXZlbnRUeXBlIHtcbiAgVmlzaXRvciA9IDEsXG4gIFNlc3Npb24gPSAyLFxuICBTZWN0aW9uID0gMyxcbiAgQ2xpY2sgPSA0LFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UmVmZXJlbmNlIHtcbiAgcmVhZG9ubHkgZXZlbnRfdHlwZTogRXZlbnRUeXBlO1xuICByZWFkb25seSBpZDogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNFdmVudFJlZmVyZW5jZSh2YWx1ZTogYW55KTogdmFsdWUgaXMgRXZlbnRSZWZlcmVuY2Uge1xuICByZXR1cm4gIShcbiAgICB0eXBlb2YgdmFsdWUgPT0gXCJ1bmRlZmluZWRcIiB8fFxuICAgIHR5cGVvZiB2YWx1ZS5ldmVudF90eXBlICE9IFwibnVtYmVyXCIgfHxcbiAgICB0eXBlb2YgdmFsdWUuaWQgIT0gXCJzdHJpbmdcIiB8fFxuICAgICF1dWlkVmFsaWRhdGUodmFsdWUuaWQpIHx8XG4gICAgdXVpZFZlcnNpb24odmFsdWUuaWQpICE9IDdcbiAgKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFdmVudCBleHRlbmRzIEV2ZW50UmVmZXJlbmNlIHtcbiAgdG9QdWJsaXNoRXZlbnQoKTogUHVibGlzaEV2ZW50O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpc2l0b3JFdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlZpc2l0b3I7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlzaXRvclJlZmVyZW5jZSBleHRlbmRzIEV2ZW50UmVmZXJlbmNlIHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlZpc2l0b3I7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvbkV2ZW50IGV4dGVuZHMgRXZlbnQge1xuICBwYXJlbnQ6IFZpc2l0b3JSZWZlcmVuY2U7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvblJlZmVyZW5jZSBleHRlbmRzIEV2ZW50UmVmZXJlbmNlIHtcbiAgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlc3Npb247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdGlvbkV2ZW50IGV4dGVuZHMgRXZlbnQge1xuICBldmVudF90eXBlOiBFdmVudFR5cGUuU2VjdGlvbjtcbiAgcGFyZW50OiBTZXNzaW9uUmVmZXJlbmNlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3Rpb25SZWZlcmVuY2UgZXh0ZW5kcyBFdmVudFJlZmVyZW5jZSB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5TZWN0aW9uO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENsaWNrRXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gIGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5DbGljaztcbiAgcGFyZW50OiBTZWN0aW9uUmVmZXJlbmNlO1xufVxuXG5leHBvcnQgY2xhc3MgVmlzaXRvciBpbXBsZW1lbnRzIFZpc2l0b3JFdmVudCwgVmlzaXRvclJlZmVyZW5jZSB7XG4gIHJlYWRvbmx5IGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5WaXNpdG9yO1xuICByZWFkb25seSBpZDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZXZlbnRfdHlwZSA9IEV2ZW50VHlwZS5WaXNpdG9yO1xuICAgIHRoaXMuaWQgPSB1dWlkdjcoKTtcbiAgfVxuXG4gIHRvUHVibGlzaEV2ZW50KCk6IFB1Ymxpc2hFdmVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHQ6IHRoaXMuZXZlbnRfdHlwZSxcbiAgICAgIGk6IHRoaXMuaWQsXG4gICAgICBhOiB1bmRlZmluZWQsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU2Vzc2lvbiBpbXBsZW1lbnRzIFNlc3Npb25FdmVudCwgU2Vzc2lvblJlZmVyZW5jZSB7XG4gIHJlYWRvbmx5IGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5TZXNzaW9uO1xuICByZWFkb25seSBpZDogc3RyaW5nO1xuICByZWFkb25seSBwYXJlbnQ6IFZpc2l0b3JSZWZlcmVuY2U7XG5cbiAgY29uc3RydWN0b3IocGFyZW50OiBWaXNpdG9yUmVmZXJlbmNlKSB7XG4gICAgdGhpcy5ldmVudF90eXBlID0gRXZlbnRUeXBlLlNlc3Npb247XG4gICAgdGhpcy5pZCA9IHV1aWR2NygpO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgdG9QdWJsaXNoRXZlbnQoKTogUHVibGlzaEV2ZW50IHtcbiAgICBjb25zdCBhdHRyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHsgcGFyZW50OiB0aGlzLnBhcmVudC5pZCB9O1xuICAgIHJldHVybiB7XG4gICAgICB0OiB0aGlzLmV2ZW50X3R5cGUsXG4gICAgICBpOiB0aGlzLmlkLFxuICAgICAgYTogYXR0cnMsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU2VjdGlvbiBpbXBsZW1lbnRzIFNlY3Rpb25FdmVudCwgU2VjdGlvblJlZmVyZW5jZSB7XG4gIHJlYWRvbmx5IGV2ZW50X3R5cGU6IEV2ZW50VHlwZS5TZWN0aW9uO1xuICByZWFkb25seSBpZDogc3RyaW5nO1xuICByZWFkb25seSBwYXJlbnQ6IFNlc3Npb25SZWZlcmVuY2U7XG5cbiAgY29uc3RydWN0b3IocGFyZW50OiBTZXNzaW9uUmVmZXJlbmNlKSB7XG4gICAgdGhpcy5ldmVudF90eXBlID0gRXZlbnRUeXBlLlNlY3Rpb247XG4gICAgdGhpcy5pZCA9IHV1aWR2NygpO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgdG9QdWJsaXNoRXZlbnQoKTogUHVibGlzaEV2ZW50IHtcbiAgICBjb25zdCBhdHRyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHsgcGFyZW50OiB0aGlzLnBhcmVudC5pZCB9O1xuICAgIHJldHVybiB7XG4gICAgICB0OiB0aGlzLmV2ZW50X3R5cGUsXG4gICAgICBpOiB0aGlzLmlkLFxuICAgICAgYTogYXR0cnMsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2xpY2sgaW1wbGVtZW50cyBDbGlja0V2ZW50IHtcbiAgcmVhZG9ubHkgZXZlbnRfdHlwZTogRXZlbnRUeXBlLkNsaWNrO1xuICByZWFkb25seSBpZDogc3RyaW5nO1xuICByZWFkb25seSBwYXJlbnQ6IFNlY3Rpb25SZWZlcmVuY2U7XG5cbiAgY29uc3RydWN0b3IocGFyZW50OiBTZWN0aW9uUmVmZXJlbmNlKSB7XG4gICAgdGhpcy5ldmVudF90eXBlID0gRXZlbnRUeXBlLkNsaWNrO1xuICAgIHRoaXMuaWQgPSB1dWlkdjcoKTtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgfVxuXG4gIHRvUHVibGlzaEV2ZW50KCk6IFB1Ymxpc2hFdmVudCB7XG4gICAgY29uc3QgYXR0cnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7IHBhcmVudDogdGhpcy5wYXJlbnQuaWQgfTtcbiAgICByZXR1cm4ge1xuICAgICAgdDogdGhpcy5ldmVudF90eXBlLFxuICAgICAgaTogdGhpcy5pZCxcbiAgICAgIGE6IGF0dHJzLFxuICAgIH07XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBlbnVtIFJlZ2lzdGVyRXZlbnRFcnJvciB7XG4gIEJhZFJlcXVlc3RFcnJvcixcbiAgQ29uZmlndXJhdGlvbkVycm9yLFxuICBJbnRlcm5hbEVycm9yLFxufVxuXG5leHBvcnQgdHlwZSBSZWdpc3RlckV2ZW50UmVzdWx0ID0gUmVnaXN0ZXJFdmVudEVycm9yIHwgdm9pZDtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFJlZ2lzdHJ5IHtcbiAgcmVnaXN0ZXJWaXNpdG9yKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQ7XG4gIGRlcmVnaXN0ZXJWaXNpdG9yKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQ7XG4gIHJlZ2lzdGVyU2Vzc2lvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0O1xuICBkZXJlZ2lzdGVyU2Vzc2lvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0O1xuICByZWdpc3RlclNlY3Rpb24oKTogUmVnaXN0ZXJFdmVudFJlc3VsdDtcbiAgZGVyZWdpc3RlclNlY3Rpb24oKTogUmVnaXN0ZXJFdmVudFJlc3VsdDtcbiAgcmVnaXN0ZXJDbGljaygpOiBSZWdpc3RlckV2ZW50UmVzdWx0O1xufVxuIiwiaW1wb3J0IHtcbiAgU2VjdGlvblJlZmVyZW5jZSxcbiAgU2Vzc2lvblJlZmVyZW5jZSxcbiAgVmlzaXRvclJlZmVyZW5jZSxcbn0gZnJvbSBcIi4uL0V2ZW50L0V2ZW50XCI7XG5cbmV4cG9ydCBlbnVtIFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gIEludGVybmFsRXJyb3IsXG4gIE1hbGZvcm1lZERhdGEsXG4gIE5vdEZvdW5kLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpdGVTdGF0ZSB7XG4gIHZpc2l0b3I6IFZpc2l0b3JSZWZlcmVuY2UgfCB1bmRlZmluZWQ7XG4gIHNlc3Npb246IFNlc3Npb25SZWZlcmVuY2UgfCB1bmRlZmluZWQ7XG4gIHNlY3Rpb246IFNlY3Rpb25SZWZlcmVuY2UgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCB0eXBlIFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQgPSBTaXRlU3RhdGUgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3I7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcihcbiAgcmVzdWx0OiBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0LFxuKTogcmVzdWx0IGlzIFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gIHJldHVybiB0eXBlb2YgcmVzdWx0ID09IFwibnVtYmVyXCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZVN0YXRlUmVwb3NpdG9yeSB7XG4gIGdldFNpdGVTdGF0ZSgpOiBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0O1xuICBzZXRTaXRlU3RhdGUoc3RhdGU6IFNpdGVTdGF0ZSk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQ7XG4gIGNsZWFyU2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQ7XG59XG4iLCJpbXBvcnQgeyBUb1B1Ymxpc2hFdmVudCB9IGZyb20gXCIuL1B1Ymxpc2hFdmVudFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UHVibGlzaFN1Y2Nlc3Mge1xuICBjb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBFdmVudFB1Ymxpc2hFcnJvciB7XG4gIEJhZFJlcXVlc3QsXG4gIEludGVybmFsU2VydmVyRXJyb3IsXG4gIFRpbWVvdXQsXG59XG5cbmV4cG9ydCB0eXBlIEV2ZW50UHVibGlzaFJlc3VsdCA9IEV2ZW50UHVibGlzaFN1Y2Nlc3MgfCBFdmVudFB1Ymxpc2hFcnJvcjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hlciB7XG4gIHB1Ymxpc2goZXZlbnRzOiBUb1B1Ymxpc2hFdmVudFtdKTogUHJvbWlzZTxFdmVudFB1Ymxpc2hSZXN1bHQ+O1xufVxuIiwiaW1wb3J0IHZhbGlkYXRlIGZyb20gJy4vdmFsaWRhdGUuanMnO1xuZnVuY3Rpb24gdmVyc2lvbih1dWlkKSB7XG4gICAgaWYgKCF2YWxpZGF0ZSh1dWlkKSkge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ0ludmFsaWQgVVVJRCcpO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VJbnQodXVpZC5zbGljZSgxNCwgMTUpLCAxNik7XG59XG5leHBvcnQgZGVmYXVsdCB2ZXJzaW9uO1xuIiwiaW1wb3J0IHtcbiAgRXZlbnRUeXBlLFxuICBpc0V2ZW50UmVmZXJlbmNlLFxuICBTZWN0aW9uUmVmZXJlbmNlLFxuICBTZXNzaW9uUmVmZXJlbmNlLFxuICBWaXNpdG9yUmVmZXJlbmNlLFxufSBmcm9tIFwiLi4vRXZlbnQvRXZlbnRcIjtcbmltcG9ydCB7XG4gIFNpdGVTdGF0ZSxcbiAgU2l0ZVN0YXRlUmVwb3NpdG9yeSxcbiAgU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0LFxufSBmcm9tIFwiLi9TaXRlU3RhdGVcIjtcblxuY29uc3QgUFJFRklYOiBzdHJpbmcgPSBcIlNBTFVTXCI7XG5jb25zdCBWSVNJVE9SX1NVRkZJWDogc3RyaW5nID0gXCJWSVNJVE9SXCI7XG5jb25zdCBTRVNTSU9OX1NVRkZJWDogc3RyaW5nID0gXCJTRVNTSU9OXCI7XG5cbmV4cG9ydCBjbGFzcyBXZWJTdG9yYWdlU2l0ZVN0YXRlUmVwb3NpdG9yeSBpbXBsZW1lbnRzIFNpdGVTdGF0ZVJlcG9zaXRvcnkge1xuICBwcml2YXRlIGFwaV9rZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBzZWN0aW9uOiBTZWN0aW9uUmVmZXJlbmNlIHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKGFwaV9rZXk6IHN0cmluZykge1xuICAgIGlmIChhcGlfa2V5LnRyaW0oKS5sZW5ndGggPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiaW52YWxpZCBlbXB0eSBhcGlfa2V5XCIpO1xuICAgIH1cbiAgICB0aGlzLmFwaV9rZXkgPSBhcGlfa2V5O1xuICAgIHRoaXMuc2VjdGlvbiA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNsZWFyU2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQge1xuICAgIHRoaXMuY2xlYXJTZWN0aW9uKCk7XG4gICAgdGhpcy5jbGVhclNlc3Npb24oKTtcbiAgICB0aGlzLmNsZWFyVmlzaXRvcigpO1xuICAgIHJldHVybiB7IHZpc2l0b3I6IHVuZGVmaW5lZCwgc2Vzc2lvbjogdW5kZWZpbmVkLCBzZWN0aW9uOiB1bmRlZmluZWQgfTtcbiAgfVxuXG4gIGdldFNpdGVTdGF0ZSgpOiBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0IHtcbiAgICBjb25zdCB2aXNpdG9yUmVzdWx0ID0gdGhpcy5nZXRWaXNpdG9yKCk7XG4gICAgbGV0IHZpc2l0b3I6IFZpc2l0b3JSZWZlcmVuY2UgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHR5cGVvZiB2aXNpdG9yUmVzdWx0ID09IFwibnVtYmVyXCIpIHtcbiAgICAgIHJldHVybiB2aXNpdG9yUmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICB2aXNpdG9yID0gdmlzaXRvclJlc3VsdDtcbiAgICB9XG5cbiAgICBjb25zdCBzZXNzaW9uUmVzdWx0ID0gdGhpcy5nZXRTZXNzaW9uKCk7XG4gICAgbGV0IHNlc3Npb246IFNlc3Npb25SZWZlcmVuY2UgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHR5cGVvZiBzZXNzaW9uUmVzdWx0ID09IFwibnVtYmVyXCIpIHtcbiAgICAgIGlmIChcbiAgICAgICAgc2Vzc2lvblJlc3VsdCA9PSBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTWFsZm9ybWVkRGF0YSB8fFxuICAgICAgICBzZXNzaW9uUmVzdWx0ID09IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5JbnRlcm5hbEVycm9yXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHNlc3Npb25SZXN1bHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyB2aXNpdG9yLCBzZXNzaW9uOiB1bmRlZmluZWQsIHNlY3Rpb246IHVuZGVmaW5lZCB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzZXNzaW9uID0gc2Vzc2lvblJlc3VsdDtcbiAgICB9XG5cbiAgICBjb25zdCBzZWN0aW9uUmVzdWx0ID0gdGhpcy5nZXRTZWN0aW9uKCk7XG4gICAgbGV0IHNlY3Rpb246IFNlY3Rpb25SZWZlcmVuY2UgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHR5cGVvZiBzZWN0aW9uUmVzdWx0ID09IFwibnVtYmVyXCIpIHtcbiAgICAgIGlmIChcbiAgICAgICAgc2VjdGlvblJlc3VsdCA9PSBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTWFsZm9ybWVkRGF0YSB8fFxuICAgICAgICBzZWN0aW9uUmVzdWx0ID09IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5JbnRlcm5hbEVycm9yXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHNlY3Rpb25SZXN1bHQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlY3Rpb24gPSBzZWN0aW9uUmVzdWx0O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2aXNpdG9yLFxuICAgICAgc2Vzc2lvbixcbiAgICAgIHNlY3Rpb24sXG4gICAgfTtcbiAgfVxuXG4gIHNldFNpdGVTdGF0ZShzdGF0ZTogU2l0ZVN0YXRlKTogU2l0ZVN0YXRlUmVwb3NpdG9yeVJlc3VsdCB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IHN0YXRlLnNlY3Rpb247XG4gICAgaWYgKHR5cGVvZiBzZWN0aW9uID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuY2xlYXJTZWN0aW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNlY3Rpb25SZXN1bHQgPSB0aGlzLnNldFNlY3Rpb24oc2VjdGlvbik7XG4gICAgICBpZiAoIWlzRXZlbnRSZWZlcmVuY2Uoc2VjdGlvblJlc3VsdCkpIHtcbiAgICAgICAgcmV0dXJuIHNlY3Rpb25SZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHNlc3Npb24gPSBzdGF0ZS5zZXNzaW9uO1xuICAgIGlmICh0eXBlb2Ygc2Vzc2lvbiA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aGlzLmNsZWFyU2Vzc2lvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZXNzaW9uUmVzdWx0ID0gdGhpcy5zZXRTZXNzaW9uKHNlc3Npb24pO1xuICAgICAgaWYgKCFpc0V2ZW50UmVmZXJlbmNlKHNlc3Npb25SZXN1bHQpKSB7XG4gICAgICAgIHJldHVybiBzZXNzaW9uUmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB2aXNpdG9yID0gc3RhdGUudmlzaXRvcjtcbiAgICBpZiAodHlwZW9mIHZpc2l0b3IgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhpcy5jbGVhclZpc2l0b3IoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdmlzaXRvclJlc3VsdCA9IHRoaXMuc2V0VmlzaXRvcih2aXNpdG9yKTtcbiAgICAgIGlmICghaXNFdmVudFJlZmVyZW5jZSh2aXNpdG9yUmVzdWx0KSkge1xuICAgICAgICByZXR1cm4gdmlzaXRvclJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRWaXNpdG9yKCk6IFZpc2l0b3JSZWZlcmVuY2UgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3Ige1xuICAgIGNvbnN0IGtleTogc3RyaW5nID0gW1BSRUZJWCwgVklTSVRPUl9TVUZGSVgsIHRoaXMuYXBpX2tleV0uam9pbihcIl9cIik7XG4gICAgY29uc3QgaWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgIGlmIChpZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLk5vdEZvdW5kO1xuICAgIH1cbiAgICBjb25zdCB2aXNpdG9yID0geyBpZCwgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlZpc2l0b3IgfTtcbiAgICBpZiAoIWlzRXZlbnRSZWZlcmVuY2UodmlzaXRvcikpIHtcbiAgICAgIHJldHVybiBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTWFsZm9ybWVkRGF0YTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmlzaXRvciBhcyBWaXNpdG9yUmVmZXJlbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaXNpdG9yKFxuICAgIHZpc2l0b3I6IFZpc2l0b3JSZWZlcmVuY2UsXG4gICk6IFZpc2l0b3JSZWZlcmVuY2UgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3Ige1xuICAgIGNvbnN0IGtleTogc3RyaW5nID0gW1BSRUZJWCwgVklTSVRPUl9TVUZGSVgsIHRoaXMuYXBpX2tleV0uam9pbihcIl9cIik7XG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmlzaXRvci5pZCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5JbnRlcm5hbEVycm9yO1xuICAgIH1cbiAgICByZXR1cm4gdmlzaXRvcjtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJWaXNpdG9yKCk6IHZvaWQge1xuICAgIGNvbnN0IGtleTogc3RyaW5nID0gW1BSRUZJWCwgVklTSVRPUl9TVUZGSVgsIHRoaXMuYXBpX2tleV0uam9pbihcIl9cIik7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2Vzc2lvbigpOiBTZXNzaW9uUmVmZXJlbmNlIHwgU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yIHtcbiAgICBjb25zdCBrZXk6IHN0cmluZyA9IFtQUkVGSVgsIFNFU1NJT05fU1VGRklYLCB0aGlzLmFwaV9rZXldLmpvaW4oXCJfXCIpO1xuICAgIGNvbnN0IGlkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgIGlmIChpZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLk5vdEZvdW5kO1xuICAgIH1cbiAgICBjb25zdCBzZXNzaW9uID0geyBpZCwgZXZlbnRfdHlwZTogRXZlbnRUeXBlLlNlc3Npb24gfTtcbiAgICBpZiAoIWlzRXZlbnRSZWZlcmVuY2Uoc2Vzc2lvbikpIHtcbiAgICAgIHJldHVybiBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IuTWFsZm9ybWVkRGF0YTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2Vzc2lvbiBhcyBTZXNzaW9uUmVmZXJlbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZXNzaW9uKFxuICAgIHNlc3Npb246IFNlc3Npb25SZWZlcmVuY2UsXG4gICk6IFNlc3Npb25SZWZlcmVuY2UgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3Ige1xuICAgIGNvbnN0IGtleTogc3RyaW5nID0gW1BSRUZJWCwgU0VTU0lPTl9TVUZGSVgsIHRoaXMuYXBpX2tleV0uam9pbihcIl9cIik7XG4gICAgdHJ5IHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCBzZXNzaW9uLmlkKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yLkludGVybmFsRXJyb3I7XG4gICAgfVxuICAgIHJldHVybiBzZXNzaW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhclNlc3Npb24oKTogdm9pZCB7XG4gICAgY29uc3Qga2V5OiBzdHJpbmcgPSBbUFJFRklYLCBTRVNTSU9OX1NVRkZJWCwgdGhpcy5hcGlfa2V5XS5qb2luKFwiX1wiKTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZWN0aW9uKCk6IFNlY3Rpb25SZWZlcmVuY2UgfCBTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3Ige1xuICAgIHJldHVybiB0aGlzLnNlY3Rpb24gPT0gdW5kZWZpbmVkXG4gICAgICA/IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvci5Ob3RGb3VuZFxuICAgICAgOiB0aGlzLnNlY3Rpb247XG4gIH1cblxuICBwcml2YXRlIHNldFNlY3Rpb24oXG4gICAgc2VjdGlvbjogU2VjdGlvblJlZmVyZW5jZSxcbiAgKTogU2VjdGlvblJlZmVyZW5jZSB8IFNpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciB7XG4gICAgdGhpcy5zZWN0aW9uID0gc2VjdGlvbjtcbiAgICByZXR1cm4gdGhpcy5zZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhclNlY3Rpb24oKTogdm9pZCB7XG4gICAgdGhpcy5zZWN0aW9uID0gdW5kZWZpbmVkO1xuICB9XG59XG4iLCJpbXBvcnQgeyBFdmVudE1hbmFnZXIgfSBmcm9tIFwiLi9FdmVudE1hbmFnZXIvRXZlbnRNYW5hZ2VyXCI7XG5pbXBvcnQgeyBIdHRwRXZlbnRQdWJsaXNoZXIgfSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlci9IdHRwRXZlbnRQdWJsaXNoZXJcIjtcbmltcG9ydCB7IFdlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5IH0gZnJvbSBcIi4vU2l0ZVN0YXRlL1dlYlN0b3JhZ2VTaXRlU3RhdGVSZXBvc2l0b3J5XCI7XG5cbmxldCBhcGlfa2V5ID0gXCJhYmMteHl6XCI7XG5sZXQgc2l0ZVN0YXRlUmVwb3NpdG9yeSA9IG5ldyBXZWJTdG9yYWdlU2l0ZVN0YXRlUmVwb3NpdG9yeShhcGlfa2V5KTtcbmxldCBwdWJsaXNoZXIgPSBuZXcgSHR0cEV2ZW50UHVibGlzaGVyKGFwaV9rZXksIFwiaHR0cDovL2xvY2FsaG9zdDozMDAwXCIpO1xubGV0IGV2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIocHVibGlzaGVyLCBzaXRlU3RhdGVSZXBvc2l0b3J5KTtcblxuZXZlbnRNYW5hZ2VyLnJlZ2lzdGVyU2VjdGlvbigpO1xuIiwiaW1wb3J0IHsgVG9QdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcbmltcG9ydCB7XG4gIEV2ZW50UHVibGlzaGVyLFxuICBFdmVudFB1Ymxpc2hFcnJvcixcbiAgRXZlbnRQdWJsaXNoUmVzdWx0LFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuXG5leHBvcnQgY2xhc3MgSHR0cEV2ZW50UHVibGlzaGVyIGltcGxlbWVudHMgRXZlbnRQdWJsaXNoZXIge1xuICBwcml2YXRlIGFwaV9rZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBlbmRwb2ludDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGFwaV9rZXk6IHN0cmluZywgaG9zdDogc3RyaW5nKSB7XG4gICAgdGhpcy5hcGlfa2V5ID0gYXBpX2tleTtcbiAgICB0aGlzLmVuZHBvaW50ID0gaG9zdCArIFwiL211bHRpXCI7XG4gIH1cblxuICBhc3luYyBwdWJsaXNoKGV2ZW50czogVG9QdWJsaXNoRXZlbnRbXSk6IFByb21pc2U8RXZlbnRQdWJsaXNoUmVzdWx0PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmNyZWF0ZVJlcXVlc3QoZXZlbnRzKSk7XG5cbiAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgIHJldHVybiB7IGNvdW50OiBldmVudHMubGVuZ3RoIH07XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSA1MDApIHtcbiAgICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5JbnRlcm5hbFNlcnZlckVycm9yO1xuICAgIH1cblxuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gNDAwKSB7XG4gICAgICByZXR1cm4gRXZlbnRQdWJsaXNoRXJyb3IuQmFkUmVxdWVzdDtcbiAgICB9XG5cbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoRXJyb3IuVGltZW91dDtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUmVxdWVzdChldmVudHM6IFRvUHVibGlzaEV2ZW50W10pOiBSZXF1ZXN0IHtcbiAgICByZXR1cm4gbmV3IFJlcXVlc3QodGhpcy5lbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwiY29yc1wiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJhcGkta2V5XCI6IHRoaXMuYXBpX2tleSxcbiAgICAgIH0sXG4gICAgICBwcmlvcml0eTogXCJsb3dcIixcbiAgICAgIGtlZXBhbGl2ZTogdHJ1ZSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGV2ZW50cy5tYXAoKGUpID0+IGUudG9QdWJsaXNoRXZlbnQoKSkpLFxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQge1xuICBDbGljayxcbiAgU2VjdGlvbixcbiAgU2VjdGlvblJlZmVyZW5jZSxcbiAgU2Vzc2lvbixcbiAgU2Vzc2lvblJlZmVyZW5jZSxcbiAgVmlzaXRvcixcbiAgVmlzaXRvclJlZmVyZW5jZSxcbn0gZnJvbSBcIi4uL0V2ZW50L0V2ZW50XCI7XG5pbXBvcnQge1xuICBFdmVudFJlZ2lzdHJ5LFxuICBSZWdpc3RlckV2ZW50RXJyb3IsXG4gIFJlZ2lzdGVyRXZlbnRSZXN1bHQsXG59IGZyb20gXCIuLi9FdmVudC9FdmVudFJlZ2lzdHJ5XCI7XG5pbXBvcnQgeyBFdmVudFB1Ymxpc2hlciB9IGZyb20gXCIuLi9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgVG9QdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi4vRXZlbnRQdWJsaXNoZXIvUHVibGlzaEV2ZW50XCI7XG5pbXBvcnQge1xuICBpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcixcbiAgU2l0ZVN0YXRlLFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5LFxuICBTaXRlU3RhdGVSZXBvc2l0b3J5UmVzdWx0LFxufSBmcm9tIFwiLi4vU2l0ZVN0YXRlL1NpdGVTdGF0ZVwiO1xuXG5leHBvcnQgY2xhc3MgRXZlbnRNYW5hZ2VyIGltcGxlbWVudHMgRXZlbnRSZWdpc3RyeSB7XG4gIHByaXZhdGUgcHVibGlzaGVyOiBFdmVudFB1Ymxpc2hlcjtcbiAgcHJpdmF0ZSBzaXRlU3RhdGVSZXBvc2l0b3J5OiBTaXRlU3RhdGVSZXBvc2l0b3J5O1xuICBwcml2YXRlIGV2ZW50UXVldWU6IFRvUHVibGlzaEV2ZW50W107XG4gIHByaXZhdGUgc2l0ZVN0YXRlV3JpdGVCdWZmZXI6IFNpdGVTdGF0ZSB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaXNoZXI6IEV2ZW50UHVibGlzaGVyLFxuICAgIHNpdGVTdGF0ZVJlcG9zaXRvcnk6IFNpdGVTdGF0ZVJlcG9zaXRvcnksXG4gICkge1xuICAgIHRoaXMucHVibGlzaGVyID0gcHVibGlzaGVyO1xuICAgIHRoaXMuc2l0ZVN0YXRlUmVwb3NpdG9yeSA9IHNpdGVTdGF0ZVJlcG9zaXRvcnk7XG4gICAgdGhpcy5ldmVudFF1ZXVlID0gW107XG4gICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZSB7XG4gICAgaWYgKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlcjtcbiAgICB9XG4gICAgY29uc3QgcmVwb1ZhbHVlID0gdGhpcy5zaXRlU3RhdGVSZXBvc2l0b3J5LmdldFNpdGVTdGF0ZSgpO1xuICAgIGlmIChpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvcihyZXBvVmFsdWUpKSB7XG4gICAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgICB2aXNpdG9yOiB1bmRlZmluZWQsXG4gICAgICAgIHNlc3Npb246IHVuZGVmaW5lZCxcbiAgICAgICAgc2VjdGlvbjogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHJlcG9WYWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXI7XG4gIH1cblxuICBwcml2YXRlIHdyaXRlU2l0ZVN0YXRlKCk6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQge1xuICAgIGxldCByZXN1bHQ6IFNpdGVTdGF0ZVJlcG9zaXRvcnlSZXN1bHQ7XG4gICAgaWYgKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXN1bHQgPSB0aGlzLnNpdGVTdGF0ZVJlcG9zaXRvcnkuc2V0U2l0ZVN0YXRlKHRoaXMuc2l0ZVN0YXRlV3JpdGVCdWZmZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSB0aGlzLnNpdGVTdGF0ZVJlcG9zaXRvcnkuY2xlYXJTaXRlU3RhdGUoKTtcbiAgICB9XG4gICAgdGhpcy5zaXRlU3RhdGVXcml0ZUJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaXNpdG9yUmVmZXJlbmNlKHZpc2l0b3I6IFZpc2l0b3JSZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcixcbiAgICAgIHNlc3Npb246IHVuZGVmaW5lZCxcbiAgICAgIHNlY3Rpb246IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZXNzaW9uUmVmZXJlbmNlKHNlc3Npb246IFNlc3Npb25SZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcjogdGhpcy5nZXRTaXRlU3RhdGUoKS52aXNpdG9yLFxuICAgICAgc2Vzc2lvbixcbiAgICAgIHNlY3Rpb246IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZWN0aW9uUmVmZXJlbmNlKHNlY3Rpb246IFNlY3Rpb25SZWZlcmVuY2UgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpdGVTdGF0ZVdyaXRlQnVmZmVyID0ge1xuICAgICAgdmlzaXRvcjogdGhpcy5nZXRTaXRlU3RhdGUoKS52aXNpdG9yLFxuICAgICAgc2Vzc2lvbjogdGhpcy5nZXRTaXRlU3RhdGUoKS5zZXNzaW9uLFxuICAgICAgc2VjdGlvbixcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBmbHVzaCgpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICBjb25zdCBzaXRlU3RhdGVTZXRSZXN1bHQgPSB0aGlzLndyaXRlU2l0ZVN0YXRlKCk7XG4gICAgaWYgKGlzU2l0ZVN0YXRlUmVwb3NpdG9yeUVycm9yKHNpdGVTdGF0ZVNldFJlc3VsdCkpIHtcbiAgICAgIHJldHVybiBSZWdpc3RlckV2ZW50RXJyb3IuSW50ZXJuYWxFcnJvcjtcbiAgICB9XG4gICAgdGhpcy5wdWJsaXNoZXIucHVibGlzaCh0aGlzLmV2ZW50UXVldWUpO1xuICAgIHRoaXMuZXZlbnRRdWV1ZSA9IFtdO1xuICB9XG5cbiAgcmVnaXN0ZXJWaXNpdG9yKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlVmlzaXRvcigpO1xuICAgIHJldHVybiB0aGlzLmZsdXNoKCk7XG4gIH1cblxuICBkZXJlZ2lzdGVyVmlzaXRvcigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLnNldFZpc2l0b3JSZWZlcmVuY2UodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVWaXNpdG9yKCk6IFZpc2l0b3Ige1xuICAgIGNvbnN0IHZpc2l0b3IgPSBuZXcgVmlzaXRvcigpO1xuICAgIHRoaXMuc2V0VmlzaXRvclJlZmVyZW5jZSh2aXNpdG9yKTtcbiAgICB0aGlzLmV2ZW50UXVldWUucHVzaCh2aXNpdG9yKTtcbiAgICByZXR1cm4gdmlzaXRvcjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0T3JDcmVhdGVWaXNpdG9yUmVmZXJlbmNlKCk6IFZpc2l0b3JSZWZlcmVuY2Uge1xuICAgIGNvbnN0IHNpdGVTdGF0ZVZpc2l0b3IgPSB0aGlzLmdldFNpdGVTdGF0ZSgpLnZpc2l0b3I7XG4gICAgaWYgKHNpdGVTdGF0ZVZpc2l0b3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gc2l0ZVN0YXRlVmlzaXRvcjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVmlzaXRvcigpO1xuICB9XG5cbiAgcmVnaXN0ZXJTZXNzaW9uKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlU2Vzc2lvbigpO1xuICAgIHJldHVybiB0aGlzLmZsdXNoKCk7XG4gIH1cblxuICBkZXJlZ2lzdGVyU2Vzc2lvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLnNldFNlc3Npb25SZWZlcmVuY2UodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTZXNzaW9uKCk6IFNlc3Npb24ge1xuICAgIGNvbnN0IHZpc2l0b3IgPSB0aGlzLmdldE9yQ3JlYXRlVmlzaXRvclJlZmVyZW5jZSgpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBuZXcgU2Vzc2lvbih2aXNpdG9yKTtcbiAgICB0aGlzLnNldFNlc3Npb25SZWZlcmVuY2Uoc2Vzc2lvbik7XG4gICAgdGhpcy5ldmVudFF1ZXVlLnB1c2goc2Vzc2lvbik7XG4gICAgcmV0dXJuIHNlc3Npb247XG4gIH1cblxuICBwcml2YXRlIGdldE9yQ3JlYXRlU2Vzc2lvblJlZmVyZW5jZSgpOiBTZXNzaW9uUmVmZXJlbmNlIHtcbiAgICBjb25zdCBzaXRlU3RhdGVTZXNzaW9uID0gdGhpcy5nZXRTaXRlU3RhdGUoKS5zZXNzaW9uO1xuICAgIGlmIChzaXRlU3RhdGVTZXNzaW9uICE9IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHNpdGVTdGF0ZVNlc3Npb247XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIHJlZ2lzdGVyU2VjdGlvbigpOiBSZWdpc3RlckV2ZW50UmVzdWx0IHtcbiAgICB0aGlzLmNyZWF0ZVNlY3Rpb24oKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgZGVyZWdpc3RlclNlY3Rpb24oKTogUmVnaXN0ZXJFdmVudFJlc3VsdCB7XG4gICAgdGhpcy5zZXRTZWN0aW9uUmVmZXJlbmNlKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIHRoaXMuZmx1c2goKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2VjdGlvbigpOiBTZWN0aW9uIHtcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5nZXRPckNyZWF0ZVNlc3Npb25SZWZlcmVuY2UoKTtcbiAgICBjb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oc2Vzc2lvbik7XG4gICAgdGhpcy5zZXRTZWN0aW9uUmVmZXJlbmNlKHNlY3Rpb24pO1xuICAgIHRoaXMuZXZlbnRRdWV1ZS5wdXNoKHNlY3Rpb24pO1xuICAgIHJldHVybiBzZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRPckNyZWF0ZVNlY3Rpb25SZWZlcmVuY2UoKTogU2VjdGlvblJlZmVyZW5jZSB7XG4gICAgY29uc3Qgc2l0ZVN0YXRlU2VjdGlvbiA9IHRoaXMuZ2V0U2l0ZVN0YXRlKCkuc2VjdGlvbjtcbiAgICBpZiAoc2l0ZVN0YXRlU2VjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBzaXRlU3RhdGVTZWN0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVTZWN0aW9uKCk7XG4gIH1cblxuICByZWdpc3RlckNsaWNrKCk6IFJlZ2lzdGVyRXZlbnRSZXN1bHQge1xuICAgIHRoaXMuY3JlYXRlQ2xpY2soKTtcbiAgICByZXR1cm4gdGhpcy5mbHVzaCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDbGljaygpOiBDbGljayB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IHRoaXMuZ2V0T3JDcmVhdGVTZWN0aW9uUmVmZXJlbmNlKCk7XG4gICAgY29uc3QgY2xpY2sgPSBuZXcgQ2xpY2soc2VjdGlvbik7XG4gICAgdGhpcy5ldmVudFF1ZXVlLnB1c2goY2xpY2spO1xuICAgIHJldHVybiBjbGljaztcbiAgfVxufVxuIl0sIm5hbWVzIjpbInV1aWQiLCJ0ZXN0IiwiZ2V0UmFuZG9tVmFsdWVzIiwicm5kczgiLCJVaW50OEFycmF5Iiwicm5nIiwiY3J5cHRvIiwiRXJyb3IiLCJiaW5kIiwiYnl0ZVRvSGV4IiwiaSIsInB1c2giLCJ0b1N0cmluZyIsInNsaWNlIiwiX3N0YXRlIiwidjdCeXRlcyIsInJuZHMiLCJtc2VjcyIsInNlcSIsImJ1ZiIsIm9mZnNldCIsImxlbmd0aCIsIlJhbmdlRXJyb3IiLCJEYXRlIiwibm93Iiwib3B0aW9ucyIsImJ5dGVzIiwicmFuZG9tIiwic3RhdGUiLCJ1cGRhdGVWN1N0YXRlIiwiYXJyIiwidG9Mb3dlckNhc2UiLCJ1bnNhZmVTdHJpbmdpZnkiLCJFdmVudFR5cGUiLCJSZWdpc3RlckV2ZW50RXJyb3IiLCJTaXRlU3RhdGVSZXBvc2l0b3J5RXJyb3IiLCJFdmVudFB1Ymxpc2hFcnJvciIsImlzRXZlbnRSZWZlcmVuY2UiLCJ2YWx1ZSIsImV2ZW50X3R5cGUiLCJpZCIsIlR5cGVFcnJvciIsInBhcnNlSW50IiwiVmlzaXRvciIsImNvbnN0cnVjdG9yIiwidGhpcyIsInRvUHVibGlzaEV2ZW50IiwidCIsImEiLCJ1bmRlZmluZWQiLCJTZXNzaW9uIiwicGFyZW50IiwiYXR0cnMiLCJTZWN0aW9uIiwiQ2xpY2siLCJpc1NpdGVTdGF0ZVJlcG9zaXRvcnlFcnJvciIsInJlc3VsdCIsIlBSRUZJWCIsIlZJU0lUT1JfU1VGRklYIiwiU0VTU0lPTl9TVUZGSVgiLCJhcGlfa2V5Iiwic2l0ZVN0YXRlUmVwb3NpdG9yeSIsInRyaW0iLCJzZWN0aW9uIiwiY2xlYXJTaXRlU3RhdGUiLCJjbGVhclNlY3Rpb24iLCJjbGVhclNlc3Npb24iLCJjbGVhclZpc2l0b3IiLCJ2aXNpdG9yIiwic2Vzc2lvbiIsImdldFNpdGVTdGF0ZSIsInZpc2l0b3JSZXN1bHQiLCJnZXRWaXNpdG9yIiwic2Vzc2lvblJlc3VsdCIsImdldFNlc3Npb24iLCJNYWxmb3JtZWREYXRhIiwiSW50ZXJuYWxFcnJvciIsInNlY3Rpb25SZXN1bHQiLCJnZXRTZWN0aW9uIiwic2V0U2l0ZVN0YXRlIiwic2V0U2VjdGlvbiIsInNldFNlc3Npb24iLCJzZXRWaXNpdG9yIiwia2V5Iiwiam9pbiIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJOb3RGb3VuZCIsInNldEl0ZW0iLCJlIiwicmVtb3ZlSXRlbSIsInNlc3Npb25TdG9yYWdlIiwicHVibGlzaGVyIiwiaG9zdCIsImVuZHBvaW50IiwicHVibGlzaCIsImV2ZW50cyIsInJlc3BvbnNlIiwiZmV0Y2giLCJjcmVhdGVSZXF1ZXN0Iiwib2siLCJjb3VudCIsInN0YXR1cyIsIkludGVybmFsU2VydmVyRXJyb3IiLCJCYWRSZXF1ZXN0IiwiVGltZW91dCIsIlJlcXVlc3QiLCJtZXRob2QiLCJtb2RlIiwiaGVhZGVycyIsInByaW9yaXR5Iiwia2VlcGFsaXZlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtYXAiLCJldmVudE1hbmFnZXIiLCJldmVudFF1ZXVlIiwic2l0ZVN0YXRlV3JpdGVCdWZmZXIiLCJyZXBvVmFsdWUiLCJ3cml0ZVNpdGVTdGF0ZSIsInNldFZpc2l0b3JSZWZlcmVuY2UiLCJzZXRTZXNzaW9uUmVmZXJlbmNlIiwic2V0U2VjdGlvblJlZmVyZW5jZSIsImZsdXNoIiwicmVnaXN0ZXJWaXNpdG9yIiwiY3JlYXRlVmlzaXRvciIsImRlcmVnaXN0ZXJWaXNpdG9yIiwiZ2V0T3JDcmVhdGVWaXNpdG9yUmVmZXJlbmNlIiwic2l0ZVN0YXRlVmlzaXRvciIsInJlZ2lzdGVyU2Vzc2lvbiIsImNyZWF0ZVNlc3Npb24iLCJkZXJlZ2lzdGVyU2Vzc2lvbiIsImdldE9yQ3JlYXRlU2Vzc2lvblJlZmVyZW5jZSIsInNpdGVTdGF0ZVNlc3Npb24iLCJyZWdpc3RlclNlY3Rpb24iLCJjcmVhdGVTZWN0aW9uIiwiZGVyZWdpc3RlclNlY3Rpb24iLCJnZXRPckNyZWF0ZVNlY3Rpb25SZWZlcmVuY2UiLCJzaXRlU3RhdGVTZWN0aW9uIiwicmVnaXN0ZXJDbGljayIsImNyZWF0ZUNsaWNrIiwiY2xpY2siXSwic291cmNlUm9vdCI6IiJ9