(()=>{"use strict";var e,t;!function(e){e[e.BadRequest=0]="BadRequest",e[e.ConfigurationError=1]="ConfigurationError",e[e.FetchError=2]="FetchError",e[e.InternalServerError=3]="InternalServerError",e[e.Timeout=4]="Timeout"}(e||(e={})),function(e){e[e.Invalid=0]="Invalid",e[e.InvalidApiKey=1]="InvalidApiKey",e[e.InvalidHost=2]="InvalidHost",e[e.Success=3]="Success"}(t||(t={}));var s;class r{constructor(e){if(function(e){if(e.api_key.trim().length<1)return t.InvalidApiKey;const s=URL.parse(e.host);return null==s||s.pathname.length>1||s.search.length>0||s.hash.length>0?t.InvalidHost:t.Success}(e)!=t.Success)throw new Error("Invalid Event Publisher Configuration");this.api_key=e.api_key,this.endpoint=e.host+"/multi"}publish(t){return s=this,r=void 0,n=function*(){try{const s=yield fetch(this.createRequest(t));return s.ok?{count:t.length}:500==s.status?e.InternalServerError:400==s.status?e.BadRequest:e.Timeout}catch(t){return e.FetchError}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{h(n.next(e))}catch(e){t(e)}}function u(e){try{h(n.throw(e))}catch(e){t(e)}}function h(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(o,u)}h((n=n.apply(s,r||[])).next())}));var s,r,i,n}createRequest(e){return new Request(this.endpoint,{method:"POST",mode:"cors",headers:{"content-type":"application/json","api-key":this.api_key},priority:"low",keepalive:!0,body:JSON.stringify(e)})}}!function(e){e[e.ConfigureRequest=0]="ConfigureRequest",e[e.ConfigureResult=1]="ConfigureResult",e[e.PublishError=2]="PublishError",e[e.PublishRequest=3]="PublishRequest",e[e.PublishResult=4]="PublishResult"}(s||(s={}));const i=self,n=new class{constructor(e){this.httpPublisher=void 0,this.workerContext=e}configurePublisher(e){try{this.httpPublisher=new r(e.config)}catch(r){const i={configurationState:t.Invalid,id:e.id,messageType:s.ConfigureResult};this.postResponse(i)}}publishEvents(t){if(null!=this.httpPublisher)if(t.events.length<1){const r={id:t.id,errorType:e.BadRequest,errorMessage:"Request to publish empty set of events",messageType:s.PublishError};this.postResponse(r)}else this.httpPublisher.publish(t.events).then((e=>this.publishResult(t.id,e)));else{const r={id:t.id,errorType:e.ConfigurationError,errorMessage:"Publish event request received prior to configuration",messageType:s.PublishError};this.postResponse(r)}}publishResult(e,t){const r={id:e,messageType:s.PublishResult,result:t};this.postResponse(r)}postResponse(e){this.workerContext.postMessage(e)}proxyMessage(e){const t=e.data;t.messageType==s.ConfigureRequest?this.configurePublisher(t):t.messageType==s.PublishRequest&&this.publishEvents(t)}}(i);i.addEventListener("message",(e=>n.proxyMessage(e)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDdkMsTUFBTUksRUFBNEMsQ0FDaERkLEdBQUlhLEVBQ0paLFlBQWF2RCxFQUFrQnFFLGNBQy9CTCxVQUVGOUMsS0FBS3VDLGFBQWFXLEVBQ3BCLENBRVEsWUFBQVgsQ0FBYWEsR0FDbkJwRCxLQUFLMkIsY0FBYzBCLFlBQVlELEVBQ2pDLENBRUEsWUFBQUUsQ0FBYUYsR0FDWCxNQUFNRyxFQUFnQkgsRUFBUUksS0FJMUJELEVBQWNsQixhQUFldkQsRUFBa0IyRSxpQkFDakR6RCxLQUFLOEIsbUJBQW1CeUIsR0FDZkEsRUFBY2xCLGFBQWV2RCxFQUFrQjRFLGdCQUN4RDFELEtBQUt3QyxjQUFjZSxFQUV2QixHRHBGOEMvQixHQUNoREEsRUFBSW1DLGlCQUFpQixXQUFZOUMsR0FBTWEsRUFBZTRCLGFBQWF6QyxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlci50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL1dvcmtlck1lc3NhZ2UudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9IdHRwRXZlbnRQdWJsaXNoZXIudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9Xb3JrZXJQdWJsaXNoZXIuanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9Xb3JrZXJQdWJsaXNoZXJQcm94eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hTdWNjZXNzIHtcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGVudW0gRXZlbnRQdWJsaXNoRXJyb3Ige1xuICBCYWRSZXF1ZXN0LFxuICBDb25maWd1cmF0aW9uRXJyb3IsXG4gIEZldGNoRXJyb3IsXG4gIEludGVybmFsU2VydmVyRXJyb3IsXG4gIFRpbWVvdXQsXG59XG5cbmV4cG9ydCB0eXBlIEV2ZW50UHVibGlzaFJlc3VsdCA9IEV2ZW50UHVibGlzaFN1Y2Nlc3MgfCBFdmVudFB1Ymxpc2hFcnJvcjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hlciB7XG4gIHB1Ymxpc2goZXZlbnRzOiBQdWJsaXNoRXZlbnRbXSk6IFByb21pc2U8RXZlbnRQdWJsaXNoUmVzdWx0Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24ge1xuICBhcGlfa2V5OiBzdHJpbmc7XG4gIGhvc3Q6IHN0cmluZztcbn1cblxuZXhwb3J0IGVudW0gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUge1xuICBJbnZhbGlkLFxuICBJbnZhbGlkQXBpS2V5LFxuICBJbnZhbGlkSG9zdCxcbiAgU3VjY2Vzcyxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKFxuICBjb25maWc6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbixcbik6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlIHtcbiAgaWYgKGNvbmZpZy5hcGlfa2V5LnRyaW0oKS5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLkludmFsaWRBcGlLZXk7XG4gIH1cbiAgY29uc3QgaG9zdCA9IFVSTC5wYXJzZShjb25maWcuaG9zdCk7XG4gIGlmIChob3N0ID09IG51bGwpIHtcbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZEhvc3Q7XG4gIH1cbiAgaWYgKFxuICAgIGhvc3QucGF0aG5hbWUubGVuZ3RoID4gMSB8fFxuICAgIGhvc3Quc2VhcmNoLmxlbmd0aCA+IDAgfHxcbiAgICBob3N0Lmhhc2gubGVuZ3RoID4gMFxuICApIHtcbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZEhvc3Q7XG4gIH1cbiAgcmV0dXJuIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLlN1Y2Nlc3M7XG59XG4iLCJpbXBvcnQge1xuICBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24sXG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLFxuICBFdmVudFB1Ymxpc2hFcnJvcixcbiAgRXZlbnRQdWJsaXNoUmVzdWx0LFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHsgUHVibGlzaEV2ZW50IH0gZnJvbSBcIi4vUHVibGlzaEV2ZW50XCI7XG5cbmV4cG9ydCBlbnVtIFdvcmtlck1lc3NhZ2VUeXBlIHtcbiAgQ29uZmlndXJlUmVxdWVzdCxcbiAgQ29uZmlndXJlUmVzdWx0LFxuICBQdWJsaXNoRXJyb3IsXG4gIFB1Ymxpc2hSZXF1ZXN0LFxuICBQdWJsaXNoUmVzdWx0LFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlck1lc3NhZ2Uge1xuICBpZDogc3RyaW5nO1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5Db25maWd1cmVSZXF1ZXN0O1xuICBjb25maWc6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJDb25maWd1cmF0aW9uUmVzdWx0TWVzc2FnZSBleHRlbmRzIFdvcmtlck1lc3NhZ2Uge1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuQ29uZmlndXJlUmVzdWx0O1xuICBjb25maWd1cmF0aW9uU3RhdGU6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlclB1Ymxpc2hFcnJvck1lc3NhZ2UgZXh0ZW5kcyBXb3JrZXJNZXNzYWdlIHtcbiAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLlB1Ymxpc2hFcnJvcjtcbiAgZXJyb3JUeXBlOiBFdmVudFB1Ymxpc2hFcnJvcjtcbiAgZXJyb3JNZXNzYWdlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyUHVibGlzaFJlcXVlc3RNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVxdWVzdDtcbiAgZXZlbnRzOiBQdWJsaXNoRXZlbnRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZSBleHRlbmRzIFdvcmtlck1lc3NhZ2Uge1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaFJlc3VsdDtcbiAgcmVzdWx0OiBFdmVudFB1Ymxpc2hSZXN1bHQ7XG59XG4iLCJpbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcbmltcG9ydCB7XG4gIEV2ZW50UHVibGlzaGVyLFxuICBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24sXG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLFxuICBFdmVudFB1Ymxpc2hFcnJvcixcbiAgRXZlbnRQdWJsaXNoUmVzdWx0LFxuICB2YWxpZGF0ZUV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbixcbn0gZnJvbSBcIi4vRXZlbnRQdWJsaXNoZXJcIjtcblxuZXhwb3J0IGNsYXNzIEh0dHBFdmVudFB1Ymxpc2hlciBpbXBsZW1lbnRzIEV2ZW50UHVibGlzaGVyIHtcbiAgcHJpdmF0ZSBhcGlfa2V5OiBzdHJpbmc7XG4gIHByaXZhdGUgZW5kcG9pbnQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbikge1xuICAgIGlmIChcbiAgICAgIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKGNvbmZpZykgIT1cbiAgICAgIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLlN1Y2Nlc3NcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgRXZlbnQgUHVibGlzaGVyIENvbmZpZ3VyYXRpb25cIik7XG4gICAgfVxuICAgIHRoaXMuYXBpX2tleSA9IGNvbmZpZy5hcGlfa2V5O1xuICAgIHRoaXMuZW5kcG9pbnQgPSBjb25maWcuaG9zdCArIFwiL211bHRpXCI7XG4gIH1cblxuICBhc3luYyBwdWJsaXNoKGV2ZW50czogUHVibGlzaEV2ZW50W10pOiBQcm9taXNlPEV2ZW50UHVibGlzaFJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMuY3JlYXRlUmVxdWVzdChldmVudHMpKTtcblxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHJldHVybiB7IGNvdW50OiBldmVudHMubGVuZ3RoIH07XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gNTAwKSB7XG4gICAgICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5JbnRlcm5hbFNlcnZlckVycm9yO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDQwMCkge1xuICAgICAgICByZXR1cm4gRXZlbnRQdWJsaXNoRXJyb3IuQmFkUmVxdWVzdDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIEV2ZW50UHVibGlzaEVycm9yLlRpbWVvdXQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIEV2ZW50UHVibGlzaEVycm9yLkZldGNoRXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSZXF1ZXN0KGV2ZW50czogUHVibGlzaEV2ZW50W10pOiBSZXF1ZXN0IHtcbiAgICByZXR1cm4gbmV3IFJlcXVlc3QodGhpcy5lbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwiY29yc1wiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJhcGkta2V5XCI6IHRoaXMuYXBpX2tleSxcbiAgICAgIH0sXG4gICAgICBwcmlvcml0eTogXCJsb3dcIixcbiAgICAgIGtlZXBhbGl2ZTogdHJ1ZSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGV2ZW50cyksXG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IFdvcmtlclB1Ymxpc2hlclByb3h5IH0gZnJvbSBcIi4vV29ya2VyUHVibGlzaGVyUHJveHlcIjtcblxuLyoqQHR5cGUge0RlZGljYXRlZFdvcmtlckdsb2JhbFNjb3BlfSAqL1xuY29uc3QgY3R4ID0gc2VsZjtcbmNvbnN0IHB1Ymxpc2hlclByb3h5ID0gbmV3IFdvcmtlclB1Ymxpc2hlclByb3h5KGN0eCk7XG5jdHguYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGUpID0+IHB1Ymxpc2hlclByb3h5LnByb3h5TWVzc2FnZShlKSk7XG4iLCJpbXBvcnQgeyBIdHRwRXZlbnRQdWJsaXNoZXIgfSBmcm9tIFwiLi9IdHRwRXZlbnRQdWJsaXNoZXJcIjtcbmltcG9ydCB7XG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlLFxuICBFdmVudFB1Ymxpc2hFcnJvcixcbiAgRXZlbnRQdWJsaXNoUmVzdWx0LFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuaW1wb3J0IHtcbiAgV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlLFxuICBXb3JrZXJDb25maWd1cmF0aW9uUmVzdWx0TWVzc2FnZSxcbiAgV29ya2VyUHVibGlzaEVycm9yTWVzc2FnZSxcbiAgV29ya2VyTWVzc2FnZSxcbiAgV29ya2VyTWVzc2FnZVR5cGUsXG4gIFdvcmtlclB1Ymxpc2hSZXF1ZXN0TWVzc2FnZSxcbiAgV29ya2VyUHVibGlzaFJlc3VsdE1lc3NhZ2UsXG59IGZyb20gXCIuL1dvcmtlck1lc3NhZ2VcIjtcblxuZXhwb3J0IGNsYXNzIFdvcmtlclB1Ymxpc2hlclByb3h5IHtcbiAgcHJpdmF0ZSBodHRwUHVibGlzaGVyOiBIdHRwRXZlbnRQdWJsaXNoZXIgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gIHByaXZhdGUgd29ya2VyQ29udGV4dDogRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGU7XG5cbiAgY29uc3RydWN0b3Iod29ya2VyQ29udGV4dDogRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGUpIHtcbiAgICB0aGlzLndvcmtlckNvbnRleHQgPSB3b3JrZXJDb250ZXh0O1xuICB9XG5cbiAgcHJpdmF0ZSBjb25maWd1cmVQdWJsaXNoZXIoXG4gICAgY29uZmlnTWVzc2FnZTogV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlLFxuICApOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5odHRwUHVibGlzaGVyID0gbmV3IEh0dHBFdmVudFB1Ymxpc2hlcihjb25maWdNZXNzYWdlLmNvbmZpZyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBlcnJNZXNzYWdlOiBXb3JrZXJDb25maWd1cmF0aW9uUmVzdWx0TWVzc2FnZSA9IHtcbiAgICAgICAgY29uZmlndXJhdGlvblN0YXRlOiBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZS5JbnZhbGlkLFxuICAgICAgICBpZDogY29uZmlnTWVzc2FnZS5pZCxcbiAgICAgICAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLkNvbmZpZ3VyZVJlc3VsdCxcbiAgICAgIH07XG4gICAgICB0aGlzLnBvc3RSZXNwb25zZShlcnJNZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHB1Ymxpc2hFdmVudHMocHVibGlzaE1lc3NhZ2U6IFdvcmtlclB1Ymxpc2hSZXF1ZXN0TWVzc2FnZSkge1xuICAgIGlmICh0aGlzLmh0dHBQdWJsaXNoZXIgPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2U6IFdvcmtlclB1Ymxpc2hFcnJvck1lc3NhZ2UgPSB7XG4gICAgICAgIGlkOiBwdWJsaXNoTWVzc2FnZS5pZCxcbiAgICAgICAgZXJyb3JUeXBlOiBFdmVudFB1Ymxpc2hFcnJvci5Db25maWd1cmF0aW9uRXJyb3IsXG4gICAgICAgIGVycm9yTWVzc2FnZTogXCJQdWJsaXNoIGV2ZW50IHJlcXVlc3QgcmVjZWl2ZWQgcHJpb3IgdG8gY29uZmlndXJhdGlvblwiLFxuICAgICAgICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaEVycm9yLFxuICAgICAgfTtcbiAgICAgIHRoaXMucG9zdFJlc3BvbnNlKGVycm9yTWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwdWJsaXNoTWVzc2FnZS5ldmVudHMubGVuZ3RoIDwgMSkge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlOiBXb3JrZXJQdWJsaXNoRXJyb3JNZXNzYWdlID0ge1xuICAgICAgICBpZDogcHVibGlzaE1lc3NhZ2UuaWQsXG4gICAgICAgIGVycm9yVHlwZTogRXZlbnRQdWJsaXNoRXJyb3IuQmFkUmVxdWVzdCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBcIlJlcXVlc3QgdG8gcHVibGlzaCBlbXB0eSBzZXQgb2YgZXZlbnRzXCIsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoRXJyb3IsXG4gICAgICB9O1xuICAgICAgdGhpcy5wb3N0UmVzcG9uc2UoZXJyb3JNZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5odHRwUHVibGlzaGVyXG4gICAgICAucHVibGlzaChwdWJsaXNoTWVzc2FnZS5ldmVudHMpXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB0aGlzLnB1Ymxpc2hSZXN1bHQocHVibGlzaE1lc3NhZ2UuaWQsIHJlc3VsdCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBwdWJsaXNoUmVzdWx0KG1lc3NhZ2VJZDogc3RyaW5nLCByZXN1bHQ6IEV2ZW50UHVibGlzaFJlc3VsdCkge1xuICAgIGNvbnN0IHJlc3VsdE1lc3NhZ2U6IFdvcmtlclB1Ymxpc2hSZXN1bHRNZXNzYWdlID0ge1xuICAgICAgaWQ6IG1lc3NhZ2VJZCxcbiAgICAgIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVzdWx0LFxuICAgICAgcmVzdWx0LFxuICAgIH07XG4gICAgdGhpcy5wb3N0UmVzcG9uc2UocmVzdWx0TWVzc2FnZSk7XG4gIH1cblxuICBwcml2YXRlIHBvc3RSZXNwb25zZShtZXNzYWdlOiBXb3JrZXJNZXNzYWdlKSB7XG4gICAgdGhpcy53b3JrZXJDb250ZXh0LnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xuICB9XG5cbiAgcHJveHlNZXNzYWdlKG1lc3NhZ2U6IE1lc3NhZ2VFdmVudCkge1xuICAgIGNvbnN0IHdvcmtlck1lc3NhZ2UgPSBtZXNzYWdlLmRhdGEgYXNcbiAgICAgIHwgV29ya2VyQ29uZmlndXJhdGlvblJlcXVlc3RNZXNzYWdlXG4gICAgICB8IFdvcmtlclB1Ymxpc2hSZXF1ZXN0TWVzc2FnZTtcblxuICAgIGlmICh3b3JrZXJNZXNzYWdlLm1lc3NhZ2VUeXBlID09IFdvcmtlck1lc3NhZ2VUeXBlLkNvbmZpZ3VyZVJlcXVlc3QpIHtcbiAgICAgIHRoaXMuY29uZmlndXJlUHVibGlzaGVyKHdvcmtlck1lc3NhZ2UpO1xuICAgIH0gZWxzZSBpZiAod29ya2VyTWVzc2FnZS5tZXNzYWdlVHlwZSA9PSBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVxdWVzdCkge1xuICAgICAgdGhpcy5wdWJsaXNoRXZlbnRzKHdvcmtlck1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIkV2ZW50UHVibGlzaEVycm9yIiwiRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUiLCJXb3JrZXJNZXNzYWdlVHlwZSIsIkh0dHBFdmVudFB1Ymxpc2hlciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiYXBpX2tleSIsInRyaW0iLCJsZW5ndGgiLCJJbnZhbGlkQXBpS2V5IiwiaG9zdCIsIlVSTCIsInBhcnNlIiwicGF0aG5hbWUiLCJzZWFyY2giLCJoYXNoIiwiSW52YWxpZEhvc3QiLCJTdWNjZXNzIiwidmFsaWRhdGVFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24iLCJFcnJvciIsInRoaXMiLCJlbmRwb2ludCIsInB1Ymxpc2giLCJldmVudHMiLCJyZXNwb25zZSIsImZldGNoIiwiY3JlYXRlUmVxdWVzdCIsIm9rIiwiY291bnQiLCJzdGF0dXMiLCJJbnRlcm5hbFNlcnZlckVycm9yIiwiQmFkUmVxdWVzdCIsIlRpbWVvdXQiLCJlIiwiRmV0Y2hFcnJvciIsIlJlcXVlc3QiLCJtZXRob2QiLCJtb2RlIiwiaGVhZGVycyIsInByaW9yaXR5Iiwia2VlcGFsaXZlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjdHgiLCJzZWxmIiwicHVibGlzaGVyUHJveHkiLCJ3b3JrZXJDb250ZXh0IiwiaHR0cFB1Ymxpc2hlciIsInVuZGVmaW5lZCIsImNvbmZpZ3VyZVB1Ymxpc2hlciIsImNvbmZpZ01lc3NhZ2UiLCJlcnIiLCJlcnJNZXNzYWdlIiwiY29uZmlndXJhdGlvblN0YXRlIiwiSW52YWxpZCIsImlkIiwibWVzc2FnZVR5cGUiLCJDb25maWd1cmVSZXN1bHQiLCJwb3N0UmVzcG9uc2UiLCJwdWJsaXNoRXZlbnRzIiwicHVibGlzaE1lc3NhZ2UiLCJlcnJvck1lc3NhZ2UiLCJlcnJvclR5cGUiLCJQdWJsaXNoRXJyb3IiLCJ0aGVuIiwicmVzdWx0IiwicHVibGlzaFJlc3VsdCIsIkNvbmZpZ3VyYXRpb25FcnJvciIsIm1lc3NhZ2VJZCIsInJlc3VsdE1lc3NhZ2UiLCJQdWJsaXNoUmVzdWx0IiwibWVzc2FnZSIsInBvc3RNZXNzYWdlIiwicHJveHlNZXNzYWdlIiwid29ya2VyTWVzc2FnZSIsImRhdGEiLCJDb25maWd1cmVSZXF1ZXN0IiwiUHVibGlzaFJlcXVlc3QiLCJhZGRFdmVudExpc3RlbmVyIl0sInNvdXJjZVJvb3QiOiIifQ==