(()=>{"use strict";var e,t;!function(e){e[e.BadRequest=0]="BadRequest",e[e.ConfigurationError=1]="ConfigurationError",e[e.FetchError=2]="FetchError",e[e.InternalServerError=3]="InternalServerError",e[e.Timeout=4]="Timeout"}(e||(e={})),function(e){e[e.Invalid=0]="Invalid",e[e.InvalidApiKey=1]="InvalidApiKey",e[e.InvalidHost=2]="InvalidHost",e[e.Success=3]="Success"}(t||(t={}));var s;class r{constructor(e){if(function(e){if(e.api_key.trim().length<1)return t.InvalidApiKey;const s=URL.parse(e.host);return null==s||s.pathname.length>1||s.search.length>0||s.hash.length>0?t.InvalidHost:t.Success}(e)!=t.Success)throw new Error("Invalid Event Publisher Configuration");this.api_key=e.api_key,this.endpoint=e.host+"/multi"}publish(t){return s=this,r=void 0,n=function*(){try{const s=yield fetch(this.createRequest(t));return s.ok?{eventCount:t.length}:500==s.status?e.InternalServerError:400==s.status?e.BadRequest:e.Timeout}catch(t){return e.FetchError}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{h(n.next(e))}catch(e){t(e)}}function u(e){try{h(n.throw(e))}catch(e){t(e)}}function h(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(o,u)}h((n=n.apply(s,r||[])).next())}));var s,r,i,n}createRequest(e){return new Request(this.endpoint,{method:"POST",mode:"cors",headers:{"content-type":"application/json","api-key":this.api_key},priority:"low",keepalive:!0,body:JSON.stringify(e)})}}!function(e){e[e.ConfigureRequest=0]="ConfigureRequest",e[e.ConfigureResult=1]="ConfigureResult",e[e.PublishError=2]="PublishError",e[e.PublishRequest=3]="PublishRequest",e[e.PublishResult=4]="PublishResult"}(s||(s={}));const i=self,n=new class{constructor(e){this.httpPublisher=void 0,this.workerContext=e}configurePublisher(e){try{this.httpPublisher=new r(e.config)}catch(r){const i={configurationState:t.Invalid,id:e.id,messageType:s.ConfigureResult};this.postResponse(i)}}publishEvents(t){if(null!=this.httpPublisher)if(t.events.length<1){const r={id:t.id,errorType:e.BadRequest,errorMessage:"Request to publish empty set of events",messageType:s.PublishError};this.postResponse(r)}else this.httpPublisher.publish(t.events).then((e=>this.publishResult(t.id,e)));else{const r={id:t.id,errorType:e.ConfigurationError,errorMessage:"Publish event request received prior to configuration",messageType:s.PublishError};this.postResponse(r)}}publishResult(e,t){const r={id:e,messageType:s.PublishResult,result:t};this.postResponse(r)}postResponse(e){this.workerContext.postMessage(e)}proxyMessage(e){const t=e.data;t.messageType==s.ConfigureRequest?this.configurePublisher(t):t.messageType==s.PublishRequest&&this.publishEvents(t)}}(i);i.addEventListener("message",(e=>n.proxyMessage(e)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDdkMsTUFBTUksRUFBNEMsQ0FDaERkLEdBQUlhLEVBQ0paLFlBQWF2RCxFQUFrQnFFLGNBQy9CTCxVQUVGOUMsS0FBS3VDLGFBQWFXLEVBQ3BCLENBRVEsWUFBQVgsQ0FBYWEsR0FDbkJwRCxLQUFLMkIsY0FBYzBCLFlBQVlELEVBQ2pDLENBRUEsWUFBQUUsQ0FBYUYsR0FDWCxNQUFNRyxFQUFnQkgsRUFBUUksS0FJMUJELEVBQWNsQixhQUFldkQsRUFBa0IyRSxpQkFDakR6RCxLQUFLOEIsbUJBQW1CeUIsR0FDZkEsRUFBY2xCLGFBQWV2RCxFQUFrQjRFLGdCQUN4RDFELEtBQUt3QyxjQUFjZSxFQUV2QixHRHBGOEMvQixHQUNoREEsRUFBSW1DLGlCQUFpQixXQUFZOUMsR0FBTWEsRUFBZTRCLGFBQWF6QyxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9FdmVudFB1Ymxpc2hlci50cyIsIndlYnBhY2s6Ly9pbmdlc3QtY2xpZW50Ly4vc3JjL0V2ZW50UHVibGlzaGVyL1dvcmtlck1lc3NhZ2UudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9IdHRwRXZlbnRQdWJsaXNoZXIudHMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9Xb3JrZXJQdWJsaXNoZXIuanMiLCJ3ZWJwYWNrOi8vaW5nZXN0LWNsaWVudC8uL3NyYy9FdmVudFB1Ymxpc2hlci9Xb3JrZXJQdWJsaXNoZXJQcm94eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudFB1Ymxpc2hTdWNjZXNzIHtcbiAgZXZlbnRDb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBFdmVudFB1Ymxpc2hFcnJvciB7XG4gIEJhZFJlcXVlc3QsXG4gIENvbmZpZ3VyYXRpb25FcnJvcixcbiAgRmV0Y2hFcnJvcixcbiAgSW50ZXJuYWxTZXJ2ZXJFcnJvcixcbiAgVGltZW91dCxcbn1cblxuZXhwb3J0IHR5cGUgRXZlbnRQdWJsaXNoUmVzdWx0ID0gRXZlbnRQdWJsaXNoU3VjY2VzcyB8IEV2ZW50UHVibGlzaEVycm9yO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNFdmVudFB1Ymxpc2hSZXN1bHRFcnJvcihcbiAgcmVzdWx0OiBFdmVudFB1Ymxpc2hSZXN1bHQsXG4pOiByZXN1bHQgaXMgRXZlbnRQdWJsaXNoRXJyb3Ige1xuICByZXR1cm4gdHlwZW9mIHJlc3VsdCA9PSBcIm51bWJlclwiO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UHVibGlzaGVyIHtcbiAgcHVibGlzaChldmVudHM6IFB1Ymxpc2hFdmVudFtdKTogUHJvbWlzZTxFdmVudFB1Ymxpc2hSZXN1bHQ+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbiB7XG4gIGFwaV9rZXk6IHN0cmluZztcbiAgaG9zdDogc3RyaW5nO1xufVxuXG5leHBvcnQgZW51bSBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZSB7XG4gIEludmFsaWQsXG4gIEludmFsaWRBcGlLZXksXG4gIEludmFsaWRIb3N0LFxuICBTdWNjZXNzLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24oXG4gIGNvbmZpZzogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uLFxuKTogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUge1xuICBpZiAoY29uZmlnLmFwaV9rZXkudHJpbSgpLmxlbmd0aCA8IDEpIHtcbiAgICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZEFwaUtleTtcbiAgfVxuICBjb25zdCBob3N0ID0gVVJMLnBhcnNlKGNvbmZpZy5ob3N0KTtcbiAgaWYgKGhvc3QgPT0gbnVsbCkge1xuICAgIHJldHVybiBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZS5JbnZhbGlkSG9zdDtcbiAgfVxuICBpZiAoXG4gICAgaG9zdC5wYXRobmFtZS5sZW5ndGggPiAxIHx8XG4gICAgaG9zdC5zZWFyY2gubGVuZ3RoID4gMCB8fFxuICAgIGhvc3QuaGFzaC5sZW5ndGggPiAwXG4gICkge1xuICAgIHJldHVybiBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZS5JbnZhbGlkSG9zdDtcbiAgfVxuICByZXR1cm4gRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuU3VjY2Vzcztcbn1cbiIsImltcG9ydCB7XG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbixcbiAgRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUsXG4gIEV2ZW50UHVibGlzaEVycm9yLFxuICBFdmVudFB1Ymxpc2hSZXN1bHQsXG59IGZyb20gXCIuL0V2ZW50UHVibGlzaGVyXCI7XG5pbXBvcnQgeyBQdWJsaXNoRXZlbnQgfSBmcm9tIFwiLi9QdWJsaXNoRXZlbnRcIjtcblxuZXhwb3J0IGVudW0gV29ya2VyTWVzc2FnZVR5cGUge1xuICBDb25maWd1cmVSZXF1ZXN0LFxuICBDb25maWd1cmVSZXN1bHQsXG4gIFB1Ymxpc2hFcnJvcixcbiAgUHVibGlzaFJlcXVlc3QsXG4gIFB1Ymxpc2hSZXN1bHQsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyTWVzc2FnZSB7XG4gIGlkOiBzdHJpbmc7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJDb25maWd1cmF0aW9uUmVxdWVzdE1lc3NhZ2UgZXh0ZW5kcyBXb3JrZXJNZXNzYWdlIHtcbiAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLkNvbmZpZ3VyZVJlcXVlc3Q7XG4gIGNvbmZpZzogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlckNvbmZpZ3VyYXRpb25SZXN1bHRNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5Db25maWd1cmVSZXN1bHQ7XG4gIGNvbmZpZ3VyYXRpb25TdGF0ZTogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyUHVibGlzaEVycm9yTWVzc2FnZSBleHRlbmRzIFdvcmtlck1lc3NhZ2Uge1xuICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaEVycm9yO1xuICBlcnJvclR5cGU6IEV2ZW50UHVibGlzaEVycm9yO1xuICBlcnJvck1lc3NhZ2U6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrZXJQdWJsaXNoUmVxdWVzdE1lc3NhZ2UgZXh0ZW5kcyBXb3JrZXJNZXNzYWdlIHtcbiAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLlB1Ymxpc2hSZXF1ZXN0O1xuICBldmVudHM6IFB1Ymxpc2hFdmVudFtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtlclB1Ymxpc2hSZXN1bHRNZXNzYWdlIGV4dGVuZHMgV29ya2VyTWVzc2FnZSB7XG4gIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5QdWJsaXNoUmVzdWx0O1xuICByZXN1bHQ6IEV2ZW50UHVibGlzaFJlc3VsdDtcbn1cbiIsImltcG9ydCB7IFB1Ymxpc2hFdmVudCB9IGZyb20gXCIuL1B1Ymxpc2hFdmVudFwiO1xuaW1wb3J0IHtcbiAgRXZlbnRQdWJsaXNoZXIsXG4gIEV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvbixcbiAgRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUsXG4gIEV2ZW50UHVibGlzaEVycm9yLFxuICBFdmVudFB1Ymxpc2hSZXN1bHQsXG4gIHZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uLFxufSBmcm9tIFwiLi9FdmVudFB1Ymxpc2hlclwiO1xuXG5leHBvcnQgY2xhc3MgSHR0cEV2ZW50UHVibGlzaGVyIGltcGxlbWVudHMgRXZlbnRQdWJsaXNoZXIge1xuICBwcml2YXRlIGFwaV9rZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBlbmRwb2ludDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uKSB7XG4gICAgaWYgKFxuICAgICAgdmFsaWRhdGVFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb24oY29uZmlnKSAhPVxuICAgICAgRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuU3VjY2Vzc1xuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBFdmVudCBQdWJsaXNoZXIgQ29uZmlndXJhdGlvblwiKTtcbiAgICB9XG4gICAgdGhpcy5hcGlfa2V5ID0gY29uZmlnLmFwaV9rZXk7XG4gICAgdGhpcy5lbmRwb2ludCA9IGNvbmZpZy5ob3N0ICsgXCIvbXVsdGlcIjtcbiAgfVxuXG4gIGFzeW5jIHB1Ymxpc2goZXZlbnRzOiBQdWJsaXNoRXZlbnRbXSk6IFByb21pc2U8RXZlbnRQdWJsaXNoUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5jcmVhdGVSZXF1ZXN0KGV2ZW50cykpO1xuXG4gICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgcmV0dXJuIHsgZXZlbnRDb3VudDogZXZlbnRzLmxlbmd0aCB9O1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDUwMCkge1xuICAgICAgICByZXR1cm4gRXZlbnRQdWJsaXNoRXJyb3IuSW50ZXJuYWxTZXJ2ZXJFcnJvcjtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSA0MDApIHtcbiAgICAgICAgcmV0dXJuIEV2ZW50UHVibGlzaEVycm9yLkJhZFJlcXVlc3Q7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5UaW1lb3V0O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBFdmVudFB1Ymxpc2hFcnJvci5GZXRjaEVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUmVxdWVzdChldmVudHM6IFB1Ymxpc2hFdmVudFtdKTogUmVxdWVzdCB7XG4gICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHRoaXMuZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBtb2RlOiBcImNvcnNcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiYXBpLWtleVwiOiB0aGlzLmFwaV9rZXksXG4gICAgICB9LFxuICAgICAgcHJpb3JpdHk6IFwibG93XCIsXG4gICAgICBrZWVwYWxpdmU6IHRydWUsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShldmVudHMpLFxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBXb3JrZXJQdWJsaXNoZXJQcm94eSB9IGZyb20gXCIuL1dvcmtlclB1Ymxpc2hlclByb3h5XCI7XG5cbi8qKkB0eXBlIHtEZWRpY2F0ZWRXb3JrZXJHbG9iYWxTY29wZX0gKi9cbmNvbnN0IGN0eCA9IHNlbGY7XG5jb25zdCBwdWJsaXNoZXJQcm94eSA9IG5ldyBXb3JrZXJQdWJsaXNoZXJQcm94eShjdHgpO1xuY3R4LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIChlKSA9PiBwdWJsaXNoZXJQcm94eS5wcm94eU1lc3NhZ2UoZSkpO1xuIiwiaW1wb3J0IHsgSHR0cEV2ZW50UHVibGlzaGVyIH0gZnJvbSBcIi4vSHR0cEV2ZW50UHVibGlzaGVyXCI7XG5pbXBvcnQge1xuICBFdmVudFB1Ymxpc2hlckNvbmZpZ3VyYXRpb25TdGF0ZSxcbiAgRXZlbnRQdWJsaXNoRXJyb3IsXG4gIEV2ZW50UHVibGlzaFJlc3VsdCxcbn0gZnJvbSBcIi4vRXZlbnRQdWJsaXNoZXJcIjtcbmltcG9ydCB7XG4gIFdvcmtlckNvbmZpZ3VyYXRpb25SZXF1ZXN0TWVzc2FnZSxcbiAgV29ya2VyQ29uZmlndXJhdGlvblJlc3VsdE1lc3NhZ2UsXG4gIFdvcmtlclB1Ymxpc2hFcnJvck1lc3NhZ2UsXG4gIFdvcmtlck1lc3NhZ2UsXG4gIFdvcmtlck1lc3NhZ2VUeXBlLFxuICBXb3JrZXJQdWJsaXNoUmVxdWVzdE1lc3NhZ2UsXG4gIFdvcmtlclB1Ymxpc2hSZXN1bHRNZXNzYWdlLFxufSBmcm9tIFwiLi9Xb3JrZXJNZXNzYWdlXCI7XG5cbmV4cG9ydCBjbGFzcyBXb3JrZXJQdWJsaXNoZXJQcm94eSB7XG4gIHByaXZhdGUgaHR0cFB1Ymxpc2hlcjogSHR0cEV2ZW50UHVibGlzaGVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIHdvcmtlckNvbnRleHQ6IERlZGljYXRlZFdvcmtlckdsb2JhbFNjb3BlO1xuXG4gIGNvbnN0cnVjdG9yKHdvcmtlckNvbnRleHQ6IERlZGljYXRlZFdvcmtlckdsb2JhbFNjb3BlKSB7XG4gICAgdGhpcy53b3JrZXJDb250ZXh0ID0gd29ya2VyQ29udGV4dDtcbiAgfVxuXG4gIHByaXZhdGUgY29uZmlndXJlUHVibGlzaGVyKFxuICAgIGNvbmZpZ01lc3NhZ2U6IFdvcmtlckNvbmZpZ3VyYXRpb25SZXF1ZXN0TWVzc2FnZSxcbiAgKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuaHR0cFB1Ymxpc2hlciA9IG5ldyBIdHRwRXZlbnRQdWJsaXNoZXIoY29uZmlnTWVzc2FnZS5jb25maWcpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc3QgZXJyTWVzc2FnZTogV29ya2VyQ29uZmlndXJhdGlvblJlc3VsdE1lc3NhZ2UgPSB7XG4gICAgICAgIGNvbmZpZ3VyYXRpb25TdGF0ZTogRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uU3RhdGUuSW52YWxpZCxcbiAgICAgICAgaWQ6IGNvbmZpZ01lc3NhZ2UuaWQsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiBXb3JrZXJNZXNzYWdlVHlwZS5Db25maWd1cmVSZXN1bHQsXG4gICAgICB9O1xuICAgICAgdGhpcy5wb3N0UmVzcG9uc2UoZXJyTWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBwdWJsaXNoRXZlbnRzKHB1Ymxpc2hNZXNzYWdlOiBXb3JrZXJQdWJsaXNoUmVxdWVzdE1lc3NhZ2UpIHtcbiAgICBpZiAodGhpcy5odHRwUHVibGlzaGVyID09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlOiBXb3JrZXJQdWJsaXNoRXJyb3JNZXNzYWdlID0ge1xuICAgICAgICBpZDogcHVibGlzaE1lc3NhZ2UuaWQsXG4gICAgICAgIGVycm9yVHlwZTogRXZlbnRQdWJsaXNoRXJyb3IuQ29uZmlndXJhdGlvbkVycm9yLFxuICAgICAgICBlcnJvck1lc3NhZ2U6IFwiUHVibGlzaCBldmVudCByZXF1ZXN0IHJlY2VpdmVkIHByaW9yIHRvIGNvbmZpZ3VyYXRpb25cIixcbiAgICAgICAgbWVzc2FnZVR5cGU6IFdvcmtlck1lc3NhZ2VUeXBlLlB1Ymxpc2hFcnJvcixcbiAgICAgIH07XG4gICAgICB0aGlzLnBvc3RSZXNwb25zZShlcnJvck1lc3NhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocHVibGlzaE1lc3NhZ2UuZXZlbnRzLmxlbmd0aCA8IDEpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZTogV29ya2VyUHVibGlzaEVycm9yTWVzc2FnZSA9IHtcbiAgICAgICAgaWQ6IHB1Ymxpc2hNZXNzYWdlLmlkLFxuICAgICAgICBlcnJvclR5cGU6IEV2ZW50UHVibGlzaEVycm9yLkJhZFJlcXVlc3QsXG4gICAgICAgIGVycm9yTWVzc2FnZTogXCJSZXF1ZXN0IHRvIHB1Ymxpc2ggZW1wdHkgc2V0IG9mIGV2ZW50c1wiLFxuICAgICAgICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaEVycm9yLFxuICAgICAgfTtcbiAgICAgIHRoaXMucG9zdFJlc3BvbnNlKGVycm9yTWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaHR0cFB1Ymxpc2hlclxuICAgICAgLnB1Ymxpc2gocHVibGlzaE1lc3NhZ2UuZXZlbnRzKVxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4gdGhpcy5wdWJsaXNoUmVzdWx0KHB1Ymxpc2hNZXNzYWdlLmlkLCByZXN1bHQpKTtcbiAgfVxuXG4gIHByaXZhdGUgcHVibGlzaFJlc3VsdChtZXNzYWdlSWQ6IHN0cmluZywgcmVzdWx0OiBFdmVudFB1Ymxpc2hSZXN1bHQpIHtcbiAgICBjb25zdCByZXN1bHRNZXNzYWdlOiBXb3JrZXJQdWJsaXNoUmVzdWx0TWVzc2FnZSA9IHtcbiAgICAgIGlkOiBtZXNzYWdlSWQsXG4gICAgICBtZXNzYWdlVHlwZTogV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaFJlc3VsdCxcbiAgICAgIHJlc3VsdCxcbiAgICB9O1xuICAgIHRoaXMucG9zdFJlc3BvbnNlKHJlc3VsdE1lc3NhZ2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBwb3N0UmVzcG9uc2UobWVzc2FnZTogV29ya2VyTWVzc2FnZSkge1xuICAgIHRoaXMud29ya2VyQ29udGV4dC5wb3N0TWVzc2FnZShtZXNzYWdlKTtcbiAgfVxuXG4gIHByb3h5TWVzc2FnZShtZXNzYWdlOiBNZXNzYWdlRXZlbnQpIHtcbiAgICBjb25zdCB3b3JrZXJNZXNzYWdlID0gbWVzc2FnZS5kYXRhIGFzXG4gICAgICB8IFdvcmtlckNvbmZpZ3VyYXRpb25SZXF1ZXN0TWVzc2FnZVxuICAgICAgfCBXb3JrZXJQdWJsaXNoUmVxdWVzdE1lc3NhZ2U7XG5cbiAgICBpZiAod29ya2VyTWVzc2FnZS5tZXNzYWdlVHlwZSA9PSBXb3JrZXJNZXNzYWdlVHlwZS5Db25maWd1cmVSZXF1ZXN0KSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyZVB1Ymxpc2hlcih3b3JrZXJNZXNzYWdlKTtcbiAgICB9IGVsc2UgaWYgKHdvcmtlck1lc3NhZ2UubWVzc2FnZVR5cGUgPT0gV29ya2VyTWVzc2FnZVR5cGUuUHVibGlzaFJlcXVlc3QpIHtcbiAgICAgIHRoaXMucHVibGlzaEV2ZW50cyh3b3JrZXJNZXNzYWdlKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJFdmVudFB1Ymxpc2hFcnJvciIsIkV2ZW50UHVibGlzaGVyQ29uZmlndXJhdGlvblN0YXRlIiwiV29ya2VyTWVzc2FnZVR5cGUiLCJIdHRwRXZlbnRQdWJsaXNoZXIiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImFwaV9rZXkiLCJ0cmltIiwibGVuZ3RoIiwiSW52YWxpZEFwaUtleSIsImhvc3QiLCJVUkwiLCJwYXJzZSIsInBhdGhuYW1lIiwic2VhcmNoIiwiaGFzaCIsIkludmFsaWRIb3N0IiwiU3VjY2VzcyIsInZhbGlkYXRlRXZlbnRQdWJsaXNoZXJDb25maWd1cmF0aW9uIiwiRXJyb3IiLCJ0aGlzIiwiZW5kcG9pbnQiLCJwdWJsaXNoIiwiZXZlbnRzIiwicmVzcG9uc2UiLCJmZXRjaCIsImNyZWF0ZVJlcXVlc3QiLCJvayIsImV2ZW50Q291bnQiLCJzdGF0dXMiLCJJbnRlcm5hbFNlcnZlckVycm9yIiwiQmFkUmVxdWVzdCIsIlRpbWVvdXQiLCJlIiwiRmV0Y2hFcnJvciIsIlJlcXVlc3QiLCJtZXRob2QiLCJtb2RlIiwiaGVhZGVycyIsInByaW9yaXR5Iiwia2VlcGFsaXZlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjdHgiLCJzZWxmIiwicHVibGlzaGVyUHJveHkiLCJ3b3JrZXJDb250ZXh0IiwiaHR0cFB1Ymxpc2hlciIsInVuZGVmaW5lZCIsImNvbmZpZ3VyZVB1Ymxpc2hlciIsImNvbmZpZ01lc3NhZ2UiLCJlcnIiLCJlcnJNZXNzYWdlIiwiY29uZmlndXJhdGlvblN0YXRlIiwiSW52YWxpZCIsImlkIiwibWVzc2FnZVR5cGUiLCJDb25maWd1cmVSZXN1bHQiLCJwb3N0UmVzcG9uc2UiLCJwdWJsaXNoRXZlbnRzIiwicHVibGlzaE1lc3NhZ2UiLCJlcnJvck1lc3NhZ2UiLCJlcnJvclR5cGUiLCJQdWJsaXNoRXJyb3IiLCJ0aGVuIiwicmVzdWx0IiwicHVibGlzaFJlc3VsdCIsIkNvbmZpZ3VyYXRpb25FcnJvciIsIm1lc3NhZ2VJZCIsInJlc3VsdE1lc3NhZ2UiLCJQdWJsaXNoUmVzdWx0IiwibWVzc2FnZSIsInBvc3RNZXNzYWdlIiwicHJveHlNZXNzYWdlIiwid29ya2VyTWVzc2FnZSIsImRhdGEiLCJDb25maWd1cmVSZXF1ZXN0IiwiUHVibGlzaFJlcXVlc3QiLCJhZGRFdmVudExpc3RlbmVyIl0sInNvdXJjZVJvb3QiOiIifQ==